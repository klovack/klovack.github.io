import{r as re,v as aa}from"./react-C5riNp3s.js";import{f as br,L as We,C as Re,g as na,O as ia,h as Kr,F as Xr,i as Gt,P as It,W as kt,j as wr,k as oa,D as la,l as Qr,m as Wt,n as je,I as fa,o as sa,p as ua,q as ca,r as Jr,s as da,t as _r,v as va,w as ha,x as Lt,y as ga,V as $e,N as ma}from"./three-DZPUity1.js";function pa(i){let e;const a=new Set,r=(x,T)=>{const M=typeof x=="function"?x(e):x;if(M!==e){const d=e;e=T?M:Object.assign({},e,M),a.forEach(k=>k(e,d))}},u=()=>e,h=(x,T=u,M=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let d=T(e);function k(){const N=T(e);if(!M(d,N)){const j=d;x(d=N,j)}}return a.add(k),()=>a.delete(k)},y={setState:r,getState:u,subscribe:(x,T,M)=>T||M?h(x,T,M):(a.add(x),()=>a.delete(x)),destroy:()=>a.clear()};return e=i(r,u,y),y}const _a=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),Dt=_a?re.useEffect:re.useLayoutEffect;function Ga(i){const e=typeof i=="function"?pa(i):i,a=(r=e.getState,u=Object.is)=>{const[,h]=re.useReducer(Q=>Q+1,0),E=e.getState(),b=re.useRef(E),y=re.useRef(r),x=re.useRef(u),T=re.useRef(!1),M=re.useRef();M.current===void 0&&(M.current=r(E));let d,k=!1;(b.current!==E||y.current!==r||x.current!==u||T.current)&&(d=r(E),k=!u(M.current,d)),Dt(()=>{k&&(M.current=d),b.current=E,y.current=r,x.current=u,T.current=!1});const N=re.useRef(E);Dt(()=>{const Q=()=>{try{const ie=e.getState(),ee=y.current(ie);x.current(M.current,ee)||(b.current=ie,M.current=ee,h())}catch{T.current=!0,h()}},H=e.subscribe(Q);return e.getState()!==N.current&&Q(),H},[]);const j=k?d:M.current;return re.useDebugValue(j),j};return Object.assign(a,e),a[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const r=[a,e];return{next(){const u=r.length<=0;return{value:r.shift(),done:u}}}},a}var jt={exports:{}},zt={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function e(g,n){var o=g.length;g.push(n);e:for(;0<o;){var t=o-1>>>1,l=g[t];if(0<u(l,n))g[t]=n,g[o]=l,o=t;else break e}}function a(g){return g.length===0?null:g[0]}function r(g){if(g.length===0)return null;var n=g[0],o=g.pop();if(o!==n){g[0]=o;e:for(var t=0,l=g.length,A=l>>>1;t<A;){var m=2*(t+1)-1,c=g[m],p=m+1,f=g[p];if(0>u(c,o))p<l&&0>u(f,c)?(g[t]=f,g[p]=o,t=p):(g[t]=c,g[m]=o,t=m);else if(p<l&&0>u(f,o))g[t]=f,g[p]=o,t=p;else break e}}return n}function u(g,n){var o=g.sortIndex-n.sortIndex;return o!==0?o:g.id-n.id}if(typeof performance=="object"&&typeof performance.now=="function"){var h=performance;i.unstable_now=function(){return h.now()}}else{var E=Date,b=E.now();i.unstable_now=function(){return E.now()-b}}var y=[],x=[],T=1,M=null,d=3,k=!1,N=!1,j=!1,Q=typeof setTimeout=="function"?setTimeout:null,H=typeof clearTimeout=="function"?clearTimeout:null,ie=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ee(g){for(var n=a(x);n!==null;){if(n.callback===null)r(x);else if(n.startTime<=g)r(x),n.sortIndex=n.expirationTime,e(y,n);else break;n=a(x)}}function ue(g){if(j=!1,ee(g),!N)if(a(y)!==null)N=!0,be(J);else{var n=a(x);n!==null&&Pe(ue,n.startTime-g)}}function J(g,n){N=!1,j&&(j=!1,H(V),V=-1),k=!0;var o=d;try{for(ee(n),M=a(y);M!==null&&(!(M.expirationTime>n)||g&&!_e());){var t=M.callback;if(typeof t=="function"){M.callback=null,d=M.priorityLevel;var l=t(M.expirationTime<=n);n=i.unstable_now(),typeof l=="function"?M.callback=l:M===a(y)&&r(y),ee(n)}else r(y);M=a(y)}if(M!==null)var A=!0;else{var m=a(x);m!==null&&Pe(ue,m.startTime-n),A=!1}return A}finally{M=null,d=o,k=!1}}var z=!1,W=null,V=-1,L=5,ve=-1;function _e(){return!(i.unstable_now()-ve<L)}function he(){if(W!==null){var g=i.unstable_now();ve=g;var n=!0;try{n=W(!0,g)}finally{n?ge():(z=!1,W=null)}}else z=!1}var ge;if(typeof ie=="function")ge=function(){ie(he)};else if(typeof MessageChannel<"u"){var me=new MessageChannel,Oe=me.port2;me.port1.onmessage=he,ge=function(){Oe.postMessage(null)}}else ge=function(){Q(he,0)};function be(g){W=g,z||(z=!0,ge())}function Pe(g,n){V=Q(function(){g(i.unstable_now())},n)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(g){g.callback=null},i.unstable_continueExecution=function(){N||k||(N=!0,be(J))},i.unstable_forceFrameRate=function(g){0>g||125<g?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):L=0<g?Math.floor(1e3/g):5},i.unstable_getCurrentPriorityLevel=function(){return d},i.unstable_getFirstCallbackNode=function(){return a(y)},i.unstable_next=function(g){switch(d){case 1:case 2:case 3:var n=3;break;default:n=d}var o=d;d=n;try{return g()}finally{d=o}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(g,n){switch(g){case 1:case 2:case 3:case 4:case 5:break;default:g=3}var o=d;d=g;try{return n()}finally{d=o}},i.unstable_scheduleCallback=function(g,n,o){var t=i.unstable_now();switch(typeof o=="object"&&o!==null?(o=o.delay,o=typeof o=="number"&&0<o?t+o:t):o=t,g){case 1:var l=-1;break;case 2:l=250;break;case 5:l=1073741823;break;case 4:l=1e4;break;default:l=5e3}return l=o+l,g={id:T++,callback:n,priorityLevel:g,startTime:o,expirationTime:l,sortIndex:-1},o>t?(g.sortIndex=o,e(x,g),a(y)===null&&g===a(x)&&(j?(H(V),V=-1):j=!0,Pe(ue,o-t))):(g.sortIndex=l,e(y,g),N||k||(N=!0,be(J))),g},i.unstable_shouldYield=_e,i.unstable_wrapCallback=function(g){var n=d;return function(){var o=d;d=n;try{return g.apply(this,arguments)}finally{d=o}}}})(zt);jt.exports=zt;var Ia=jt.exports;function Zr(i,e,a){var r,u,h,E,b;e==null&&(e=100);function y(){var T=Date.now()-E;T<e&&T>=0?r=setTimeout(y,e-T):(r=null,a||(b=i.apply(h,u),h=u=null))}var x=function(){h=this,u=arguments,E=Date.now();var T=a&&!r;return r||(r=setTimeout(y,e)),T&&(b=i.apply(h,u),h=u=null),b};return x.clear=function(){r&&(clearTimeout(r),r=null)},x.flush=function(){r&&(b=i.apply(h,u),h=u=null,clearTimeout(r),r=null)},x}Zr.debounce=Zr;var ba=Zr;const ka=aa(ba);var wa=Object.defineProperty,ya=Object.defineProperties,Ma=Object.getOwnPropertyDescriptors,Rt=Object.getOwnPropertySymbols,Ea=Object.prototype.hasOwnProperty,xa=Object.prototype.propertyIsEnumerable,Pt=(i,e,a)=>e in i?wa(i,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[e]=a,St=(i,e)=>{for(var a in e||(e={}))Ea.call(e,a)&&Pt(i,a,e[a]);if(Rt)for(var a of Rt(e))xa.call(e,a)&&Pt(i,a,e[a]);return i},Ta=(i,e)=>ya(i,Ma(e)),Ct,Ot;typeof window<"u"&&((Ct=window.document)!=null&&Ct.createElement||((Ot=window.navigator)==null?void 0:Ot.product)==="ReactNative")?re.useLayoutEffect:re.useEffect;function Ht(i,e,a){if(!i)return;if(a(i)===!0)return i;let r=i.child;for(;r;){const u=Ht(r,e,a);if(u)return u;r=r.sibling}}function Vt(i){try{return Object.defineProperties(i,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return i}}const Bt=console.error;console.error=function(){const i=[...arguments].join("");if(i!=null&&i.startsWith("Warning:")&&i.includes("useContext")){console.error=Bt;return}return Bt.apply(this,arguments)};const qr=Vt(re.createContext(null));class Fa extends re.Component{render(){return re.createElement(qr.Provider,{value:this._reactInternals},this.props.children)}}function Aa(){const i=re.useContext(qr);if(i===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=re.useId();return re.useMemo(()=>{for(const r of[i,i==null?void 0:i.alternate]){if(!r)continue;const u=Ht(r,!1,h=>{let E=h.memoizedState;for(;E;){if(E.memoizedState===e)return!0;E=E.next}});if(u)return u}},[i,e])}function La(){const i=Aa(),[e]=re.useState(()=>new Map);e.clear();let a=i;for(;a;){if(a.type&&typeof a.type=="object"){const u=a.type._context===void 0&&a.type.Provider===a.type?a.type:a.type._context;u&&u!==qr&&!e.has(u)&&e.set(u,re.useContext(Vt(u)))}a=a.return}return e}function Wa(){const i=La();return re.useMemo(()=>Array.from(i.keys()).reduce((e,a)=>r=>re.createElement(e,null,re.createElement(a.Provider,Ta(St({},r),{value:i.get(a)}))),e=>re.createElement(Fa,St({},e))),[i])}function Ut(){return Ut=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var r in a)({}).hasOwnProperty.call(a,r)&&(i[r]=a[r])}return i},Ut.apply(null,arguments)}function ja(){var i=function(e){function a(n,o,t,l,A,m,c,p){var f=1-c;p.x=f*f*n+2*f*c*t+c*c*A,p.y=f*f*o+2*f*c*l+c*c*m}function r(n,o,t,l,A,m,c,p,f,_){var P=1-f;_.x=P*P*P*n+3*P*P*f*t+3*P*f*f*A+f*f*f*c,_.y=P*P*P*o+3*P*P*f*l+3*P*f*f*m+f*f*f*p}function u(n,o){for(var t=/([MLQCZ])([^MLQCZ]*)/g,l,A,m,c,p;l=t.exec(n);){var f=l[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(_){return parseFloat(_)});switch(l[1]){case"M":c=A=f[0],p=m=f[1];break;case"L":(f[0]!==c||f[1]!==p)&&o("L",c,p,c=f[0],p=f[1]);break;case"Q":{o("Q",c,p,c=f[2],p=f[3],f[0],f[1]);break}case"C":{o("C",c,p,c=f[4],p=f[5],f[0],f[1],f[2],f[3]);break}case"Z":(c!==A||p!==m)&&o("L",c,p,A,m);break}}}function h(n,o,t){t===void 0&&(t=16);var l={x:0,y:0};u(n,function(A,m,c,p,f,_,P,Y,X){switch(A){case"L":o(m,c,p,f);break;case"Q":{for(var w=m,te=c,le=1;le<t;le++)a(m,c,_,P,p,f,le/(t-1),l),o(w,te,l.x,l.y),w=l.x,te=l.y;break}case"C":{for(var O=m,G=c,I=1;I<t;I++)r(m,c,_,P,Y,X,p,f,I/(t-1),l),o(O,G,l.x,l.y),O=l.x,G=l.y;break}}})}var E="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",b="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",y=new WeakMap,x={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function T(n,o){var t=n.getContext?n.getContext("webgl",x):n,l=y.get(t);if(!l){let P=function(O){var G=m[O];if(!G&&(G=m[O]=t.getExtension(O),!G))throw new Error(O+" not supported");return G},Y=function(O,G){var I=t.createShader(G);return t.shaderSource(I,O),t.compileShader(I),I},X=function(O,G,I,v){if(!c[O]){var S={},C={},s=t.createProgram();t.attachShader(s,Y(G,t.VERTEX_SHADER)),t.attachShader(s,Y(I,t.FRAGMENT_SHADER)),t.linkProgram(s),c[O]={program:s,transaction:function(D){t.useProgram(s),D({setUniform:function(R,q){for(var ae=[],U=arguments.length-2;U-- >0;)ae[U]=arguments[U+2];var $=C[q]||(C[q]=t.getUniformLocation(s,q));t["uniform"+R].apply(t,[$].concat(ae))},setAttribute:function(R,q,ae,U,$){var oe=S[R];oe||(oe=S[R]={buf:t.createBuffer(),loc:t.getAttribLocation(s,R),data:null}),t.bindBuffer(t.ARRAY_BUFFER,oe.buf),t.vertexAttribPointer(oe.loc,q,t.FLOAT,!1,0,0),t.enableVertexAttribArray(oe.loc),A?t.vertexAttribDivisor(oe.loc,U):P("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(oe.loc,U),$!==oe.data&&(t.bufferData(t.ARRAY_BUFFER,$,ae),oe.data=$)}})}}}c[O].transaction(v)},w=function(O,G){f++;try{t.activeTexture(t.TEXTURE0+f);var I=p[O];I||(I=p[O]=t.createTexture(),t.bindTexture(t.TEXTURE_2D,I),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST)),t.bindTexture(t.TEXTURE_2D,I),G(I,f)}finally{f--}},te=function(O,G,I){var v=t.createFramebuffer();_.push(v),t.bindFramebuffer(t.FRAMEBUFFER,v),t.activeTexture(t.TEXTURE0+G),t.bindTexture(t.TEXTURE_2D,O),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,O,0);try{I(v)}finally{t.deleteFramebuffer(v),t.bindFramebuffer(t.FRAMEBUFFER,_[--_.length-1]||null)}},le=function(){m={},c={},p={},f=-1,_.length=0};var A=typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext,m={},c={},p={},f=-1,_=[];t.canvas.addEventListener("webglcontextlost",function(O){le(),O.preventDefault()},!1),y.set(t,l={gl:t,isWebGL2:A,getExtension:P,withProgram:X,withTexture:w,withTextureFramebuffer:te,handleContextLoss:le})}o(l)}function M(n,o,t,l,A,m,c,p){c===void 0&&(c=15),p===void 0&&(p=null),T(n,function(f){var _=f.gl,P=f.withProgram,Y=f.withTexture;Y("copy",function(X,w){_.texImage2D(_.TEXTURE_2D,0,_.RGBA,A,m,0,_.RGBA,_.UNSIGNED_BYTE,o),P("copy",E,b,function(te){var le=te.setUniform,O=te.setAttribute;O("aUV",2,_.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),le("1i","image",w),_.bindFramebuffer(_.FRAMEBUFFER,p||null),_.disable(_.BLEND),_.colorMask(c&8,c&4,c&2,c&1),_.viewport(t,l,A,m),_.scissor(t,l,A,m),_.drawArrays(_.TRIANGLES,0,3)})})})}function d(n,o,t){var l=n.width,A=n.height;T(n,function(m){var c=m.gl,p=new Uint8Array(l*A*4);c.readPixels(0,0,l,A,c.RGBA,c.UNSIGNED_BYTE,p),n.width=o,n.height=t,M(c,p,0,0,l,A)})}var k=Object.freeze({__proto__:null,withWebGLContext:T,renderImageData:M,resizeWebGLCanvasWithoutClearing:d});function N(n,o,t,l,A,m){m===void 0&&(m=1);var c=new Uint8Array(n*o),p=l[2]-l[0],f=l[3]-l[1],_=[];h(t,function(O,G,I,v){_.push({x1:O,y1:G,x2:I,y2:v,minX:Math.min(O,I),minY:Math.min(G,v),maxX:Math.max(O,I),maxY:Math.max(G,v)})}),_.sort(function(O,G){return O.maxX-G.maxX});for(var P=0;P<n;P++)for(var Y=0;Y<o;Y++){var X=te(l[0]+p*(P+.5)/n,l[1]+f*(Y+.5)/o),w=Math.pow(1-Math.abs(X)/A,m)/2;X<0&&(w=1-w),w=Math.max(0,Math.min(255,Math.round(w*255))),c[Y*n+P]=w}return c;function te(O,G){for(var I=1/0,v=1/0,S=_.length;S--;){var C=_[S];if(C.maxX+v<=O)break;if(O+v>C.minX&&G-v<C.maxY&&G+v>C.minY){var s=H(O,G,C.x1,C.y1,C.x2,C.y2);s<I&&(I=s,v=Math.sqrt(I))}}return le(O,G)&&(v=-v),v}function le(O,G){for(var I=0,v=_.length;v--;){var S=_[v];if(S.maxX<=O)break;var C=S.y1>G!=S.y2>G&&O<(S.x2-S.x1)*(G-S.y1)/(S.y2-S.y1)+S.x1;C&&(I+=S.y1<S.y2?1:-1)}return I!==0}}function j(n,o,t,l,A,m,c,p,f,_){m===void 0&&(m=1),p===void 0&&(p=0),f===void 0&&(f=0),_===void 0&&(_=0),Q(n,o,t,l,A,m,c,null,p,f,_)}function Q(n,o,t,l,A,m,c,p,f,_,P){m===void 0&&(m=1),f===void 0&&(f=0),_===void 0&&(_=0),P===void 0&&(P=0);for(var Y=N(n,o,t,l,A,m),X=new Uint8Array(Y.length*4),w=0;w<Y.length;w++)X[w*4+P]=Y[w];M(c,X,f,_,n,o,1<<3-P,p)}function H(n,o,t,l,A,m){var c=A-t,p=m-l,f=c*c+p*p,_=f?Math.max(0,Math.min(1,((n-t)*c+(o-l)*p)/f)):0,P=n-(t+_*c),Y=o-(l+_*p);return P*P+Y*Y}var ie=Object.freeze({__proto__:null,generate:N,generateIntoCanvas:j,generateIntoFramebuffer:Q}),ee="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",ue="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",J="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",z=new Float32Array([0,0,2,0,0,2]),W=null,V=!1,L={},ve=new WeakMap;function _e(n){if(!V&&!Oe(n))throw new Error("WebGL generation not supported")}function he(n,o,t,l,A,m,c){if(m===void 0&&(m=1),c===void 0&&(c=null),!c&&(c=W,!c)){var p=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!p)throw new Error("OffscreenCanvas or DOM canvas not supported");c=W=p.getContext("webgl",{depth:!1})}_e(c);var f=new Uint8Array(n*o*4);T(c,function(X){var w=X.gl,te=X.withTexture,le=X.withTextureFramebuffer;te("readable",function(O,G){w.texImage2D(w.TEXTURE_2D,0,w.RGBA,n,o,0,w.RGBA,w.UNSIGNED_BYTE,null),le(O,G,function(I){me(n,o,t,l,A,m,w,I,0,0,0),w.readPixels(0,0,n,o,w.RGBA,w.UNSIGNED_BYTE,f)})})});for(var _=new Uint8Array(n*o),P=0,Y=0;P<f.length;P+=4)_[Y++]=f[P];return _}function ge(n,o,t,l,A,m,c,p,f,_){m===void 0&&(m=1),p===void 0&&(p=0),f===void 0&&(f=0),_===void 0&&(_=0),me(n,o,t,l,A,m,c,null,p,f,_)}function me(n,o,t,l,A,m,c,p,f,_,P){m===void 0&&(m=1),f===void 0&&(f=0),_===void 0&&(_=0),P===void 0&&(P=0),_e(c);var Y=[];h(t,function(X,w,te,le){Y.push(X,w,te,le)}),Y=new Float32Array(Y),T(c,function(X){var w=X.gl,te=X.isWebGL2,le=X.getExtension,O=X.withProgram,G=X.withTexture,I=X.withTextureFramebuffer,v=X.handleContextLoss;if(G("rawDistances",function(S,C){(n!==S._lastWidth||o!==S._lastHeight)&&w.texImage2D(w.TEXTURE_2D,0,w.RGBA,S._lastWidth=n,S._lastHeight=o,0,w.RGBA,w.UNSIGNED_BYTE,null),O("main",ee,ue,function(s){var K=s.setAttribute,D=s.setUniform,B=!te&&le("ANGLE_instanced_arrays"),R=!te&&le("EXT_blend_minmax");K("aUV",2,w.STATIC_DRAW,0,z),K("aLineSegment",4,w.DYNAMIC_DRAW,1,Y),D.apply(void 0,["4f","uGlyphBounds"].concat(l)),D("1f","uMaxDistance",A),D("1f","uExponent",m),I(S,C,function(q){w.enable(w.BLEND),w.colorMask(!0,!0,!0,!0),w.viewport(0,0,n,o),w.scissor(0,0,n,o),w.blendFunc(w.ONE,w.ONE),w.blendEquationSeparate(w.FUNC_ADD,te?w.MAX:R.MAX_EXT),w.clear(w.COLOR_BUFFER_BIT),te?w.drawArraysInstanced(w.TRIANGLES,0,3,Y.length/4):B.drawArraysInstancedANGLE(w.TRIANGLES,0,3,Y.length/4)})}),O("post",E,J,function(s){s.setAttribute("aUV",2,w.STATIC_DRAW,0,z),s.setUniform("1i","tex",C),w.bindFramebuffer(w.FRAMEBUFFER,p),w.disable(w.BLEND),w.colorMask(P===0,P===1,P===2,P===3),w.viewport(f,_,n,o),w.scissor(f,_,n,o),w.drawArrays(w.TRIANGLES,0,3)})}),w.isContextLost())throw v(),new Error("webgl context lost")})}function Oe(n){var o=!n||n===W?L:n.canvas||n,t=ve.get(o);if(t===void 0){V=!0;var l=null;try{var A=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],m=he(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,n);t=m&&A.length===m.length&&m.every(function(c,p){return c===A[p]}),t||(l="bad trial run results",console.info(A,m))}catch(c){t=!1,l=c.message}l&&console.warn("WebGL SDF generation not supported:",l),V=!1,ve.set(o,t)}return t}var be=Object.freeze({__proto__:null,generate:he,generateIntoCanvas:ge,generateIntoFramebuffer:me,isSupported:Oe});function Pe(n,o,t,l,A,m){A===void 0&&(A=Math.max(l[2]-l[0],l[3]-l[1])/2),m===void 0&&(m=1);try{return he.apply(be,arguments)}catch(c){return console.info("WebGL SDF generation failed, falling back to JS",c),N.apply(ie,arguments)}}function g(n,o,t,l,A,m,c,p,f,_){A===void 0&&(A=Math.max(l[2]-l[0],l[3]-l[1])/2),m===void 0&&(m=1),p===void 0&&(p=0),f===void 0&&(f=0),_===void 0&&(_=0);try{return ge.apply(be,arguments)}catch(P){return console.info("WebGL SDF generation failed, falling back to JS",P),j.apply(ie,arguments)}}return e.forEachPathCommand=u,e.generate=Pe,e.generateIntoCanvas=g,e.javascript=ie,e.pathToLineSegments=h,e.webgl=be,e.webglUtils=k,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return i}function za(){var i=function(e){var a={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},r={},u={};r.L=1,u[1]="L",Object.keys(a).forEach(function(v,S){r[v]=1<<S+1,u[r[v]]=v}),Object.freeze(r);var h=r.LRI|r.RLI|r.FSI,E=r.L|r.R|r.AL,b=r.B|r.S|r.WS|r.ON|r.FSI|r.LRI|r.RLI|r.PDI,y=r.BN|r.RLE|r.LRE|r.RLO|r.LRO|r.PDF,x=r.S|r.WS|r.B|h|r.PDI|y,T=null;function M(){if(!T){T=new Map;var v=function(C){if(a.hasOwnProperty(C)){var s=0;a[C].split(",").forEach(function(K){var D=K.split("+"),B=D[0],R=D[1];B=parseInt(B,36),R=R?parseInt(R,36):0,T.set(s+=B,r[C]);for(var q=0;q<R;q++)T.set(++s,r[C])})}};for(var S in a)v(S)}}function d(v){return M(),T.get(v.codePointAt(0))||r.L}function k(v){return u[d(v)]}var N={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function j(v,S){var C=36,s=0,K=new Map,D=S&&new Map,B;return v.split(",").forEach(function R(q){if(q.indexOf("+")!==-1)for(var ae=+q;ae--;)R(B);else{B=q;var U=q.split(">"),$=U[0],oe=U[1];$=String.fromCodePoint(s+=parseInt($,C)),oe=String.fromCodePoint(s+=parseInt(oe,C)),K.set($,oe),S&&D.set(oe,$)}}),{map:K,reverseMap:D}}var Q,H,ie;function ee(){if(!Q){var v=j(N.pairs,!0),S=v.map,C=v.reverseMap;Q=S,H=C,ie=j(N.canonical,!1).map}}function ue(v){return ee(),Q.get(v)||null}function J(v){return ee(),H.get(v)||null}function z(v){return ee(),ie.get(v)||null}var W=r.L,V=r.R,L=r.EN,ve=r.ES,_e=r.ET,he=r.AN,ge=r.CS,me=r.B,Oe=r.S,be=r.ON,Pe=r.BN,g=r.NSM,n=r.AL,o=r.LRO,t=r.RLO,l=r.LRE,A=r.RLE,m=r.PDF,c=r.LRI,p=r.RLI,f=r.FSI,_=r.PDI;function P(v,S){for(var C=125,s=new Uint32Array(v.length),K=0;K<v.length;K++)s[K]=d(v[K]);var D=new Map;function B(ce,ye){var de=s[ce];s[ce]=ye,D.set(de,D.get(de)-1),de&b&&D.set(b,D.get(b)-1),D.set(ye,(D.get(ye)||0)+1),ye&b&&D.set(b,(D.get(b)||0)+1)}for(var R=new Uint8Array(v.length),q=new Map,ae=[],U=null,$=0;$<v.length;$++)U||ae.push(U={start:$,end:v.length-1,level:S==="rtl"?1:S==="ltr"?0:Ft($,!1)}),s[$]&me&&(U.end=$,U=null);for(var oe=A|l|t|o|h|_|m|me,Se=function(ce){return ce+(ce&1?1:2)},Te=function(ce){return ce+(ce&1?2:1)},Fe=0;Fe<ae.length;Fe++){U=ae[Fe];var Z=[{_level:U.level,_override:0,_isolate:0}],ne=void 0,xe=0,Ae=0,yr=0;D.clear();for(var fe=U.start;fe<=U.end;fe++){var se=s[fe];if(ne=Z[Z.length-1],D.set(se,(D.get(se)||0)+1),se&b&&D.set(b,(D.get(b)||0)+1),se&oe)if(se&(A|l)){R[fe]=ne._level;var et=(se===A?Te:Se)(ne._level);et<=C&&!xe&&!Ae?Z.push({_level:et,_override:0,_isolate:0}):xe||Ae++}else if(se&(t|o)){R[fe]=ne._level;var rt=(se===t?Te:Se)(ne._level);rt<=C&&!xe&&!Ae?Z.push({_level:rt,_override:se&t?V:W,_isolate:0}):xe||Ae++}else if(se&h){se&f&&(se=Ft(fe+1,!0)===1?p:c),R[fe]=ne._level,ne._override&&B(fe,ne._override);var tt=(se===p?Te:Se)(ne._level);tt<=C&&xe===0&&Ae===0?(yr++,Z.push({_level:tt,_override:0,_isolate:1,_isolInitIndex:fe})):xe++}else if(se&_){if(xe>0)xe--;else if(yr>0){for(Ae=0;!Z[Z.length-1]._isolate;)Z.pop();var Mr=Z[Z.length-1]._isolInitIndex;Mr!=null&&(q.set(Mr,fe),q.set(fe,Mr)),Z.pop(),yr--}ne=Z[Z.length-1],R[fe]=ne._level,ne._override&&B(fe,ne._override)}else se&m?(xe===0&&(Ae>0?Ae--:!ne._isolate&&Z.length>1&&(Z.pop(),ne=Z[Z.length-1])),R[fe]=ne._level):se&me&&(R[fe]=U.level);else R[fe]=ne._level,ne._override&&se!==Pe&&B(fe,ne._override)}for(var Be=[],Me=null,Ce=U.start;Ce<=U.end;Ce++){var Er=s[Ce];if(!(Er&y)){var at=R[Ce],nt=Er&h,Zt=Er===_;Me&&at===Me._level?(Me._end=Ce,Me._endsWithIsolInit=nt):Be.push(Me={_start:Ce,_end:Ce,_level:at,_startsWithPDI:Zt,_endsWithIsolInit:nt})}}for(var xr=[],rr=0;rr<Be.length;rr++){var tr=Be[rr];if(!tr._startsWithPDI||tr._startsWithPDI&&!q.has(tr._start)){for(var Tr=[Me=tr],it=void 0;Me&&Me._endsWithIsolInit&&(it=q.get(Me._end))!=null;)for(var ar=rr+1;ar<Be.length;ar++)if(Be[ar]._start===it){Tr.push(Me=Be[ar]);break}for(var Ue=[],Fr=0;Fr<Tr.length;Fr++)for(var ot=Tr[Fr],Ar=ot._start;Ar<=ot._end;Ar++)Ue.push(Ar);for(var Kt=R[Ue[0]],lt=U.level,nr=Ue[0]-1;nr>=0;nr--)if(!(s[nr]&y)){lt=R[nr];break}var Lr=Ue[Ue.length-1],qt=R[Lr],ft=U.level;if(!(s[Lr]&h)){for(var ir=Lr+1;ir<=U.end;ir++)if(!(s[ir]&y)){ft=R[ir];break}}xr.push({_seqIndices:Ue,_sosType:Math.max(lt,Kt)%2?V:W,_eosType:Math.max(ft,qt)%2?V:W})}}for(var Dr=0;Dr<xr.length;Dr++){var Rr=xr[Dr],F=Rr._seqIndices,ze=Rr._sosType,$t=Rr._eosType,Ne=R[F[0]]&1?V:W;if(D.get(g))for(var or=0;or<F.length;or++){var st=F[or];if(s[st]&g){for(var Pr=ze,lr=or-1;lr>=0;lr--)if(!(s[F[lr]]&y)){Pr=s[F[lr]];break}B(st,Pr&(h|_)?be:Pr)}}if(D.get(L))for(var fr=0;fr<F.length;fr++){var ut=F[fr];if(s[ut]&L)for(var sr=fr-1;sr>=-1;sr--){var ct=sr===-1?ze:s[F[sr]];if(ct&E){ct===n&&B(ut,he);break}}}if(D.get(n))for(var Sr=0;Sr<F.length;Sr++){var dt=F[Sr];s[dt]&n&&B(dt,V)}if(D.get(ve)||D.get(ge))for(var He=1;He<F.length-1;He++){var Cr=F[He];if(s[Cr]&(ve|ge)){for(var Ge=0,Or=0,Br=He-1;Br>=0&&(Ge=s[F[Br]],!!(Ge&y));Br--);for(var Ur=He+1;Ur<F.length&&(Or=s[F[Ur]],!!(Or&y));Ur++);Ge===Or&&(s[Cr]===ve?Ge===L:Ge&(L|he))&&B(Cr,Ge)}}if(D.get(L))for(var Ee=0;Ee<F.length;Ee++){var ea=F[Ee];if(s[ea]&L){for(var ur=Ee-1;ur>=0&&s[F[ur]]&(_e|y);ur--)B(F[ur],L);for(Ee++;Ee<F.length&&s[F[Ee]]&(_e|y|L);Ee++)s[F[Ee]]!==L&&B(F[Ee],L)}}if(D.get(_e)||D.get(ve)||D.get(ge))for(var Ve=0;Ve<F.length;Ve++){var vt=F[Ve];if(s[vt]&(_e|ve|ge)){B(vt,be);for(var cr=Ve-1;cr>=0&&s[F[cr]]&y;cr--)B(F[cr],be);for(var dr=Ve+1;dr<F.length&&s[F[dr]]&y;dr++)B(F[dr],be)}}if(D.get(L))for(var Nr=0,ht=ze;Nr<F.length;Nr++){var gt=F[Nr],Gr=s[gt];Gr&L?ht===W&&B(gt,W):Gr&E&&(ht=Gr)}if(D.get(b)){var Ye=V|L|he,mt=Ye|W,vr=[];{for(var Ie=[],ke=0;ke<F.length;ke++)if(s[F[ke]]&b){var Xe=v[F[ke]],pt=void 0;if(ue(Xe)!==null)if(Ie.length<63)Ie.push({char:Xe,seqIndex:ke});else break;else if((pt=J(Xe))!==null)for(var Qe=Ie.length-1;Qe>=0;Qe--){var Ir=Ie[Qe].char;if(Ir===pt||Ir===J(z(Xe))||ue(z(Ir))===Xe){vr.push([Ie[Qe].seqIndex,ke]),Ie.length=Qe;break}}}vr.sort(function(ce,ye){return ce[0]-ye[0]})}for(var kr=0;kr<vr.length;kr++){for(var _t=vr[kr],hr=_t[0],Wr=_t[1],bt=!1,we=0,jr=hr+1;jr<Wr;jr++){var wt=F[jr];if(s[wt]&mt){bt=!0;var yt=s[wt]&Ye?V:W;if(yt===Ne){we=yt;break}}}if(bt&&!we){we=ze;for(var zr=hr-1;zr>=0;zr--){var Mt=F[zr];if(s[Mt]&mt){var Et=s[Mt]&Ye?V:W;Et!==Ne?we=Et:we=Ne;break}}}if(we){if(s[F[hr]]=s[F[Wr]]=we,we!==Ne){for(var Je=hr+1;Je<F.length;Je++)if(!(s[F[Je]]&y)){d(v[F[Je]])&g&&(s[F[Je]]=we);break}}if(we!==Ne){for(var Ze=Wr+1;Ze<F.length;Ze++)if(!(s[F[Ze]]&y)){d(v[F[Ze]])&g&&(s[F[Ze]]=we);break}}}}for(var Le=0;Le<F.length;Le++)if(s[F[Le]]&b){for(var xt=Le,Hr=Le,Vr=ze,Ke=Le-1;Ke>=0;Ke--)if(s[F[Ke]]&y)xt=Ke;else{Vr=s[F[Ke]]&Ye?V:W;break}for(var Tt=$t,qe=Le+1;qe<F.length;qe++)if(s[F[qe]]&(b|y))Hr=qe;else{Tt=s[F[qe]]&Ye?V:W;break}for(var Yr=xt;Yr<=Hr;Yr++)s[F[Yr]]=Vr===Tt?Vr:Ne;Le=Hr}}}for(var pe=U.start;pe<=U.end;pe++){var ra=R[pe],gr=s[pe];if(ra&1?gr&(W|L|he)&&R[pe]++:gr&V?R[pe]++:gr&(he|L)&&(R[pe]+=2),gr&y&&(R[pe]=pe===0?U.level:R[pe-1]),pe===U.end||d(v[pe])&(Oe|me))for(var mr=pe;mr>=0&&d(v[mr])&x;mr--)R[mr]=U.level}}return{levels:R,paragraphs:ae};function Ft(ce,ye){for(var de=ce;de<v.length;de++){var De=s[de];if(De&(V|n))return 1;if(De&(me|W)||ye&&De===_)return 0;if(De&h){var At=ta(de);de=At===-1?v.length:At}}return 0}function ta(ce){for(var ye=1,de=ce+1;de<v.length;de++){var De=s[de];if(De&me)break;if(De&_){if(--ye===0)return de}else De&h&&ye++}return-1}}var Y="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",X;function w(){if(!X){var v=j(Y,!0),S=v.map,C=v.reverseMap;C.forEach(function(s,K){S.set(K,s)}),X=S}}function te(v){return w(),X.get(v)||null}function le(v,S,C,s){var K=v.length;C=Math.max(0,C==null?0:+C),s=Math.min(K-1,s==null?K-1:+s);for(var D=new Map,B=C;B<=s;B++)if(S[B]&1){var R=te(v[B]);R!==null&&D.set(B,R)}return D}function O(v,S,C,s){var K=v.length;C=Math.max(0,C==null?0:+C),s=Math.min(K-1,s==null?K-1:+s);var D=[];return S.paragraphs.forEach(function(B){var R=Math.max(C,B.start),q=Math.min(s,B.end);if(R<q){for(var ae=S.levels.slice(R,q+1),U=q;U>=R&&d(v[U])&x;U--)ae[U]=B.level;for(var $=B.level,oe=1/0,Se=0;Se<ae.length;Se++){var Te=ae[Se];Te>$&&($=Te),Te<oe&&(oe=Te|1)}for(var Fe=$;Fe>=oe;Fe--)for(var Z=0;Z<ae.length;Z++)if(ae[Z]>=Fe){for(var ne=Z;Z+1<ae.length&&ae[Z+1]>=Fe;)Z++;Z>ne&&D.push([ne+R,Z+R])}}}),D}function G(v,S,C,s){var K=I(v,S,C,s),D=[].concat(v);return K.forEach(function(B,R){D[R]=(S.levels[B]&1?te(v[B]):null)||v[B]}),D.join("")}function I(v,S,C,s){for(var K=O(v,S,C,s),D=[],B=0;B<v.length;B++)D[B]=B;return K.forEach(function(R){for(var q=R[0],ae=R[1],U=D.slice(q,ae+1),$=U.length;$--;)D[ae-$]=U[$]}),D}return e.closingToOpeningBracket=J,e.getBidiCharType=d,e.getBidiCharTypeName=k,e.getCanonicalBracket=z,e.getEmbeddingLevels=P,e.getMirroredCharacter=te,e.getMirroredCharactersMap=le,e.getReorderSegments=O,e.getReorderedIndices=I,e.getReorderedString=G,e.openingToClosingBracket=ue,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return i}const Yt=(i,e,a)=>{let r;switch(i){case Jr:r=new Uint8ClampedArray(e*a*4);break;case Kr:r=new Uint16Array(e*a*4);break;case ca:r=new Uint32Array(e*a*4);break;case ua:r=new Int8Array(e*a*4);break;case sa:r=new Int16Array(e*a*4);break;case fa:r=new Int32Array(e*a*4);break;case Xr:r=new Float32Array(e*a*4);break;default:throw new Error("Unsupported data type")}return r};let pr;const Da=(i,e,a,r)=>{if(pr!==void 0)return pr;const u=new kt(1,1,r);e.setRenderTarget(u);const h=new Gt(new It,new da({color:16777215}));e.render(h,a),e.setRenderTarget(null);const E=Yt(i,u.width,u.height);return e.readRenderTargetPixels(u,0,0,u.width,u.height,E),u.dispose(),h.geometry.dispose(),h.material.dispose(),pr=E[0]!==0,pr};class $r{constructor(e){var a,r,u,h,E,b,y,x,T,M,d,k,N,j,Q,H;this._rendererIsDisposable=!1,this._supportsReadPixels=!0,this.render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(ee){throw this._renderer.setRenderTarget(null),ee}this._renderer.setRenderTarget(null)},this._width=e.width,this._height=e.height,this._type=e.type,this._colorSpace=e.colorSpace;const ie={format:br,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:((a=e.renderTargetOptions)===null||a===void 0?void 0:a.anisotropy)!==void 0?(r=e.renderTargetOptions)===null||r===void 0?void 0:r.anisotropy:1,generateMipmaps:((u=e.renderTargetOptions)===null||u===void 0?void 0:u.generateMipmaps)!==void 0?(h=e.renderTargetOptions)===null||h===void 0?void 0:h.generateMipmaps:!1,magFilter:((E=e.renderTargetOptions)===null||E===void 0?void 0:E.magFilter)!==void 0?(b=e.renderTargetOptions)===null||b===void 0?void 0:b.magFilter:We,minFilter:((y=e.renderTargetOptions)===null||y===void 0?void 0:y.minFilter)!==void 0?(x=e.renderTargetOptions)===null||x===void 0?void 0:x.minFilter:We,samples:((T=e.renderTargetOptions)===null||T===void 0?void 0:T.samples)!==void 0?(M=e.renderTargetOptions)===null||M===void 0?void 0:M.samples:void 0,wrapS:((d=e.renderTargetOptions)===null||d===void 0?void 0:d.wrapS)!==void 0?(k=e.renderTargetOptions)===null||k===void 0?void 0:k.wrapS:Re,wrapT:((N=e.renderTargetOptions)===null||N===void 0?void 0:N.wrapT)!==void 0?(j=e.renderTargetOptions)===null||j===void 0?void 0:j.wrapT:Re};if(this._material=e.material,e.renderer?this._renderer=e.renderer:(this._renderer=$r.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new na,this._camera=new ia,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!Da(this._type,this._renderer,this._camera,ie)){let ee;switch(this._type){case Kr:ee=this._renderer.extensions.has("EXT_color_buffer_float")?Xr:void 0;break}ee!==void 0?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${Xr}`),this._type=ee):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new Gt(new It,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new kt(this.width,this.height,ie),this._renderTarget.texture.mapping=((Q=e.renderTargetOptions)===null||Q===void 0?void 0:Q.mapping)!==void 0?(H=e.renderTargetOptions)===null||H===void 0?void 0:H.mapping:wr}static instantiateRenderer(){const e=new oa;return e.setSize(128,128),e}toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const e=Yt(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,e),e}toDataTexture(e){const a=new la(this.toArray(),this.width,this.height,br,this._type,(e==null?void 0:e.mapping)||wr,(e==null?void 0:e.wrapS)||Re,(e==null?void 0:e.wrapT)||Re,(e==null?void 0:e.magFilter)||We,(e==null?void 0:e.minFilter)||We,(e==null?void 0:e.anisotropy)||1,Qr);return a.generateMipmaps=(e==null?void 0:e.generateMipmaps)!==void 0?e==null?void 0:e.generateMipmaps:!1,a}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(e){this.disposeOnDemandRenderer(),e&&this.renderTarget.dispose(),this.material instanceof Wt&&Object.values(this.material.uniforms).forEach(a=>{a.value instanceof je&&a.value.dispose()}),Object.values(this.material).forEach(a=>{a instanceof je&&a.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(e){this._width=e,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(e){this._height=e,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(e){this._renderTarget=e,this._width=e.width,this._height=e.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}const Ra=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,Pa=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class Sa extends Wt{constructor({gamma:e,offsetHdr:a,offsetSdr:r,gainMapMin:u,gainMapMax:h,maxDisplayBoost:E,hdrCapacityMin:b,hdrCapacityMax:y,sdr:x,gainMap:T}){super({name:"GainMapDecoderMaterial",vertexShader:Ra,fragmentShader:Pa,uniforms:{sdr:{value:x},gainMap:{value:T},gamma:{value:new $e(1/e[0],1/e[1],1/e[2])},offsetHdr:{value:new $e().fromArray(a)},offsetSdr:{value:new $e().fromArray(r)},gainMapMin:{value:new $e().fromArray(u)},gainMapMax:{value:new $e().fromArray(h)},weightFactor:{value:(Math.log2(E)-b)/(y-b)}},blending:ma,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=E,this._hdrCapacityMin=b,this._hdrCapacityMax=y,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(e){this.uniforms.sdr.value=e}get gainMap(){return this.uniforms.gainMap.value}set gainMap(e){this.uniforms.gainMap.value=e}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(e){this.uniforms.offsetHdr.value.fromArray(e)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(e){this.uniforms.offsetSdr.value.fromArray(e)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(e){this.uniforms.gainMapMin.value.fromArray(e)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(e){this.uniforms.gainMapMax.value.fromArray(e)}get gamma(){const e=this.uniforms.gamma.value;return[1/e.x,1/e.y,1/e.z]}set gamma(e){const a=this.uniforms.gamma.value;a.x=1/e[0],a.y=1/e[1],a.z=1/e[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(e){this._hdrCapacityMin=e,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(e){this._hdrCapacityMax=e,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(e){this._maxDisplayBoost=Math.max(1,Math.min(65504,e)),this.calculateWeight()}calculateWeight(){const e=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,e))}}class Xt extends Error{}class Qt extends Error{}const er=(i,e,a)=>{var r;let u;const h=(r=i.attributes.getNamedItem(e))===null||r===void 0?void 0:r.nodeValue;if(h)u=h;else{const E=i.getElementsByTagName(e)[0];if(E){const b=E.getElementsByTagName("rdf:li");if(b.length===3)u=Array.from(b).map(y=>y.innerHTML);else throw new Error(`Gainmap metadata contains an array of items for ${e} but its length is not 3`)}else{if(a)return a;throw new Error(`Can't find ${e} in gainmap metadata`)}}return u},Ca=i=>{var e,a;let r;typeof TextDecoder<"u"?r=new TextDecoder().decode(i):r=i.toString();let u=r.indexOf("<x:xmpmeta");const h=new DOMParser;for(;u!==-1;){const E=r.indexOf("x:xmpmeta>",u);r.slice(u,E+10);const b=r.slice(u,E+10);try{const x=h.parseFromString(b,"text/xml").getElementsByTagName("rdf:Description")[0],T=er(x,"hdrgm:GainMapMin","0"),M=er(x,"hdrgm:GainMapMax"),d=er(x,"hdrgm:Gamma","1"),k=er(x,"hdrgm:OffsetSDR","0.015625"),N=er(x,"hdrgm:OffsetHDR","0.015625");let j=(e=x.attributes.getNamedItem("hdrgm:HDRCapacityMin"))===null||e===void 0?void 0:e.nodeValue;j||(j="0");const Q=(a=x.attributes.getNamedItem("hdrgm:HDRCapacityMax"))===null||a===void 0?void 0:a.nodeValue;if(!Q)throw new Error("Incomplete gainmap metadata");return{gainMapMin:Array.isArray(T)?T.map(H=>parseFloat(H)):[parseFloat(T),parseFloat(T),parseFloat(T)],gainMapMax:Array.isArray(M)?M.map(H=>parseFloat(H)):[parseFloat(M),parseFloat(M),parseFloat(M)],gamma:Array.isArray(d)?d.map(H=>parseFloat(H)):[parseFloat(d),parseFloat(d),parseFloat(d)],offsetSdr:Array.isArray(k)?k.map(H=>parseFloat(H)):[parseFloat(k),parseFloat(k),parseFloat(k)],offsetHdr:Array.isArray(N)?N.map(H=>parseFloat(H)):[parseFloat(N),parseFloat(N),parseFloat(N)],hdrCapacityMin:parseFloat(j),hdrCapacityMax:parseFloat(Q)}}catch{}u=r.indexOf("<x:xmpmeta",E)}};class Oa{constructor(e){this.options={debug:e&&e.debug!==void 0?e.debug:!1,extractFII:e&&e.extractFII!==void 0?e.extractFII:!0,extractNonFII:e&&e.extractNonFII!==void 0?e.extractNonFII:!0}}extract(e){return new Promise((a,r)=>{const u=this.options.debug,h=new DataView(e.buffer);if(h.getUint16(0)!==65496){r(new Error("Not a valid jpeg"));return}const E=h.byteLength;let b=2,y=0,x;for(;b<E;){if(++y>250){r(new Error(`Found no marker after ${y} loops ðŸ˜µ`));return}if(h.getUint8(b)!==255){r(new Error(`Not a valid marker at offset 0x${b.toString(16)}, found: 0x${h.getUint8(b).toString(16)}`));return}if(x=h.getUint8(b+1),u&&console.log(`Marker: ${x.toString(16)}`),x===226){u&&console.log("Found APP2 marker (0xffe2)");const T=b+4;if(h.getUint32(T)===1297106432){const M=T+4;let d;if(h.getUint16(M)===18761)d=!1;else if(h.getUint16(M)===19789)d=!0;else{r(new Error("No valid endianness marker found in TIFF header"));return}if(h.getUint16(M+2,!d)!==42){r(new Error("Not valid TIFF data! (no 0x002A marker)"));return}const k=h.getUint32(M+4,!d);if(k<8){r(new Error("Not valid TIFF data! (First offset less than 8)"));return}const N=M+k,j=h.getUint16(N,!d),Q=N+2;let H=0;for(let J=Q;J<Q+12*j;J+=12)h.getUint16(J,!d)===45057&&(H=h.getUint32(J+8,!d));const ee=N+2+j*12+4,ue=[];for(let J=ee;J<ee+H*16;J+=16){const z={MPType:h.getUint32(J,!d),size:h.getUint32(J+4,!d),dataOffset:h.getUint32(J+8,!d),dependantImages:h.getUint32(J+12,!d),start:-1,end:-1,isFII:!1};z.dataOffset?(z.start=M+z.dataOffset,z.isFII=!1):(z.start=0,z.isFII=!0),z.end=z.start+z.size,ue.push(z)}if(this.options.extractNonFII&&ue.length){const J=new Blob([h]),z=[];for(const W of ue){if(W.isFII&&!this.options.extractFII)continue;const V=J.slice(W.start,W.end+1,"image/jpeg");z.push(V)}a(z)}}}b+=2+h.getUint16(b+2)}})}}const Ba=async i=>{const e=Ca(i);if(!e)throw new Qt("Gain map XMP metadata not found");const r=await new Oa({extractFII:!0,extractNonFII:!0}).extract(i);if(r.length!==2)throw new Xt("Gain map recovery image not found");return{sdr:new Uint8Array(await r[0].arrayBuffer()),gainMap:new Uint8Array(await r[1].arrayBuffer()),metadata:e}},Nt=i=>new Promise((e,a)=>{const r=document.createElement("img");r.onload=()=>{e(r)},r.onerror=u=>{a(u)},r.src=URL.createObjectURL(i)});class Jt extends va{constructor(e,a){super(a),e&&(this._renderer=e),this._internalLoadingManager=new ha}setRenderer(e){return this._renderer=e,this}setRenderTargetOptions(e){return this._renderTargetOptions=e,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: An existing WebGL Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const e=new Sa({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new je,sdr:new je});return new $r({width:16,height:16,type:Kr,colorSpace:Qr,material:e,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async render(e,a,r,u){const h=u?new Blob([u],{type:"image/jpeg"}):void 0,E=new Blob([r],{type:"image/jpeg"});let b,y,x=!1;if(typeof createImageBitmap>"u"){const d=await Promise.all([h?Nt(h):Promise.resolve(void 0),Nt(E)]);y=d[0],b=d[1],x=!0}else{const d=await Promise.all([h?createImageBitmap(h,{imageOrientation:"flipY"}):Promise.resolve(void 0),createImageBitmap(E,{imageOrientation:"flipY"})]);y=d[0],b=d[1]}const T=new je(y||new ImageData(2,2),wr,Re,Re,We,Lt,br,Jr,1,Qr);T.flipY=x,T.needsUpdate=!0;const M=new je(b,wr,Re,Re,We,Lt,br,Jr,1,ga);M.flipY=x,M.needsUpdate=!0,e.width=b.width,e.height=b.height,e.material.gainMap=T,e.material.sdr=M,e.material.gainMapMin=a.gainMapMin,e.material.gainMapMax=a.gainMapMax,e.material.offsetHdr=a.offsetHdr,e.material.offsetSdr=a.offsetSdr,e.material.gamma=a.gamma,e.material.hdrCapacityMin=a.hdrCapacityMin,e.material.hdrCapacityMax=a.hdrCapacityMax,e.material.maxDisplayBoost=Math.pow(2,a.hdrCapacityMax),e.material.needsUpdate=!0,e.render()}}class Ha extends Jt{load([e,a,r],u,h,E){const b=this.prepareQuadRenderer();let y,x,T;const M=async()=>{if(y&&x&&T){try{await this.render(b,T,y,x)}catch(L){this.manager.itemError(e),this.manager.itemError(a),this.manager.itemError(r),typeof E=="function"&&E(L),b.disposeOnDemandRenderer();return}typeof u=="function"&&u(b),this.manager.itemEnd(e),this.manager.itemEnd(a),this.manager.itemEnd(r),b.disposeOnDemandRenderer()}};let d=!0,k=0,N=0,j=!0,Q=0,H=0,ie=!0,ee=0,ue=0;const J=()=>{if(typeof h=="function"){const L=k+Q+ee,ve=N+H+ue,_e=d&&j&&ie;h(new ProgressEvent("progress",{lengthComputable:_e,loaded:ve,total:L}))}};this.manager.itemStart(e),this.manager.itemStart(a),this.manager.itemStart(r);const z=new _r(this._internalLoadingManager);z.setResponseType("arraybuffer"),z.setRequestHeader(this.requestHeader),z.setPath(this.path),z.setWithCredentials(this.withCredentials),z.load(e,async L=>{if(typeof L=="string")throw new Error("Invalid sdr buffer");y=L,await M()},L=>{d=L.lengthComputable,N=L.loaded,k=L.total,J()},L=>{this.manager.itemError(e),typeof E=="function"&&E(L)});const W=new _r(this._internalLoadingManager);W.setResponseType("arraybuffer"),W.setRequestHeader(this.requestHeader),W.setPath(this.path),W.setWithCredentials(this.withCredentials),W.load(a,async L=>{if(typeof L=="string")throw new Error("Invalid gainmap buffer");x=L,await M()},L=>{j=L.lengthComputable,H=L.loaded,Q=L.total,J()},L=>{this.manager.itemError(a),typeof E=="function"&&E(L)});const V=new _r(this._internalLoadingManager);return V.setRequestHeader(this.requestHeader),V.setPath(this.path),V.setWithCredentials(this.withCredentials),V.load(r,async L=>{if(typeof L!="string")throw new Error("Invalid metadata string");T=JSON.parse(L),await M()},L=>{ie=L.lengthComputable,ue=L.loaded,ee=L.total,J()},L=>{this.manager.itemError(r),typeof E=="function"&&E(L)}),b}}class Va extends Jt{load(e,a,r,u){const h=this.prepareQuadRenderer(),E=new _r(this._internalLoadingManager);return E.setResponseType("arraybuffer"),E.setRequestHeader(this.requestHeader),E.setPath(this.path),E.setWithCredentials(this.withCredentials),this.manager.itemStart(e),E.load(e,async b=>{if(typeof b=="string")throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const y=new Uint8Array(b);let x,T,M;try{const d=await Ba(y);x=d.sdr,T=d.gainMap,M=d.metadata}catch(d){if(d instanceof Qt||d instanceof Xt)console.warn(`Failure to reconstruct an HDR image from ${e}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),M={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},x=y;else throw d}try{await this.render(h,M,x,T)}catch(d){this.manager.itemError(e),typeof u=="function"&&u(d),h.disposeOnDemandRenderer();return}typeof a=="function"&&a(h),this.manager.itemEnd(e),h.disposeOnDemandRenderer()},r,b=>{this.manager.itemError(e),typeof u=="function"&&u(b)}),h}}export{Fa as F,Ha as G,Va as H,ja as S,Ut as _,Ga as a,za as b,ka as c,Ia as s,Wa as u};
//# sourceMappingURL=vendor-BlFGQ96q.js.map
