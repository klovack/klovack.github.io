{"version":3,"file":"vendor-BlFGQ96q.js","sources":["../../node_modules/zustand/esm/index.js","../../node_modules/scheduler/cjs/scheduler.production.min.js","../../node_modules/scheduler/index.js","../../node_modules/debounce/index.js","../../node_modules/its-fine/dist/index.js","../../node_modules/@babel/runtime/helpers/esm/extends.js","../../node_modules/webgl-sdf-generator/dist/webgl-sdf-generator.mjs","../../node_modules/bidi-js/dist/bidi.mjs","../../node_modules/@monogrid/gainmap-js/dist/QuadRenderer-6HrRQdJM.js","../../node_modules/@monogrid/gainmap-js/dist/decode.js"],"sourcesContent":["import { useReducer, useRef, useDebugValue, useEffect, useLayoutEffect } from 'react';\n\nfunction createStore(createState) {\n  let state;\n  const listeners = /* @__PURE__ */ new Set();\n  const setState = (partial, replace) => {\n    const nextState = typeof partial === \"function\" ? partial(state) : partial;\n    if (nextState !== state) {\n      const previousState = state;\n      state = replace ? nextState : Object.assign({}, state, nextState);\n      listeners.forEach((listener) => listener(state, previousState));\n    }\n  };\n  const getState = () => state;\n  const subscribeWithSelector = (listener, selector = getState, equalityFn = Object.is) => {\n    console.warn(\"[DEPRECATED] Please use `subscribeWithSelector` middleware\");\n    let currentSlice = selector(state);\n    function listenerToAdd() {\n      const nextSlice = selector(state);\n      if (!equalityFn(currentSlice, nextSlice)) {\n        const previousSlice = currentSlice;\n        listener(currentSlice = nextSlice, previousSlice);\n      }\n    }\n    listeners.add(listenerToAdd);\n    return () => listeners.delete(listenerToAdd);\n  };\n  const subscribe = (listener, selector, equalityFn) => {\n    if (selector || equalityFn) {\n      return subscribeWithSelector(listener, selector, equalityFn);\n    }\n    listeners.add(listener);\n    return () => listeners.delete(listener);\n  };\n  const destroy = () => listeners.clear();\n  const api = { setState, getState, subscribe, destroy };\n  state = createState(setState, getState, api);\n  return api;\n}\n\nconst isSSR = typeof window === \"undefined\" || !window.navigator || /ServerSideRendering|^Deno\\//.test(window.navigator.userAgent);\nconst useIsomorphicLayoutEffect = isSSR ? useEffect : useLayoutEffect;\nfunction create(createState) {\n  const api = typeof createState === \"function\" ? createStore(createState) : createState;\n  const useStore = (selector = api.getState, equalityFn = Object.is) => {\n    const [, forceUpdate] = useReducer((c) => c + 1, 0);\n    const state = api.getState();\n    const stateRef = useRef(state);\n    const selectorRef = useRef(selector);\n    const equalityFnRef = useRef(equalityFn);\n    const erroredRef = useRef(false);\n    const currentSliceRef = useRef();\n    if (currentSliceRef.current === void 0) {\n      currentSliceRef.current = selector(state);\n    }\n    let newStateSlice;\n    let hasNewStateSlice = false;\n    if (stateRef.current !== state || selectorRef.current !== selector || equalityFnRef.current !== equalityFn || erroredRef.current) {\n      newStateSlice = selector(state);\n      hasNewStateSlice = !equalityFn(currentSliceRef.current, newStateSlice);\n    }\n    useIsomorphicLayoutEffect(() => {\n      if (hasNewStateSlice) {\n        currentSliceRef.current = newStateSlice;\n      }\n      stateRef.current = state;\n      selectorRef.current = selector;\n      equalityFnRef.current = equalityFn;\n      erroredRef.current = false;\n    });\n    const stateBeforeSubscriptionRef = useRef(state);\n    useIsomorphicLayoutEffect(() => {\n      const listener = () => {\n        try {\n          const nextState = api.getState();\n          const nextStateSlice = selectorRef.current(nextState);\n          if (!equalityFnRef.current(currentSliceRef.current, nextStateSlice)) {\n            stateRef.current = nextState;\n            currentSliceRef.current = nextStateSlice;\n            forceUpdate();\n          }\n        } catch (error) {\n          erroredRef.current = true;\n          forceUpdate();\n        }\n      };\n      const unsubscribe = api.subscribe(listener);\n      if (api.getState() !== stateBeforeSubscriptionRef.current) {\n        listener();\n      }\n      return unsubscribe;\n    }, []);\n    const sliceToReturn = hasNewStateSlice ? newStateSlice : currentSliceRef.current;\n    useDebugValue(sliceToReturn);\n    return sliceToReturn;\n  };\n  Object.assign(useStore, api);\n  useStore[Symbol.iterator] = function() {\n    console.warn(\"[useStore, api] = create() is deprecated and will be removed in v4\");\n    const items = [useStore, api];\n    return {\n      next() {\n        const done = items.length <= 0;\n        return { value: items.shift(), done };\n      }\n    };\n  };\n  return useStore;\n}\n\nexport { create as default };\n","/**\n * @license React\n * scheduler.production.min.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n'use strict';function f(a,b){var c=a.length;a.push(b);a:for(;0<c;){var d=c-1>>>1,e=a[d];if(0<g(e,b))a[d]=b,a[c]=e,c=d;else break a}}function h(a){return 0===a.length?null:a[0]}function k(a){if(0===a.length)return null;var b=a[0],c=a.pop();if(c!==b){a[0]=c;a:for(var d=0,e=a.length,w=e>>>1;d<w;){var m=2*(d+1)-1,C=a[m],n=m+1,x=a[n];if(0>g(C,c))n<e&&0>g(x,C)?(a[d]=x,a[n]=c,d=n):(a[d]=C,a[m]=c,d=m);else if(n<e&&0>g(x,c))a[d]=x,a[n]=c,d=n;else break a}}return b}\nfunction g(a,b){var c=a.sortIndex-b.sortIndex;return 0!==c?c:a.id-b.id}if(\"object\"===typeof performance&&\"function\"===typeof performance.now){var l=performance;exports.unstable_now=function(){return l.now()}}else{var p=Date,q=p.now();exports.unstable_now=function(){return p.now()-q}}var r=[],t=[],u=1,v=null,y=3,z=!1,A=!1,B=!1,D=\"function\"===typeof setTimeout?setTimeout:null,E=\"function\"===typeof clearTimeout?clearTimeout:null,F=\"undefined\"!==typeof setImmediate?setImmediate:null;\n\"undefined\"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function G(a){for(var b=h(t);null!==b;){if(null===b.callback)k(t);else if(b.startTime<=a)k(t),b.sortIndex=b.expirationTime,f(r,b);else break;b=h(t)}}function H(a){B=!1;G(a);if(!A)if(null!==h(r))A=!0,I(J);else{var b=h(t);null!==b&&K(H,b.startTime-a)}}\nfunction J(a,b){A=!1;B&&(B=!1,E(L),L=-1);z=!0;var c=y;try{G(b);for(v=h(r);null!==v&&(!(v.expirationTime>b)||a&&!M());){var d=v.callback;if(\"function\"===typeof d){v.callback=null;y=v.priorityLevel;var e=d(v.expirationTime<=b);b=exports.unstable_now();\"function\"===typeof e?v.callback=e:v===h(r)&&k(r);G(b)}else k(r);v=h(r)}if(null!==v)var w=!0;else{var m=h(t);null!==m&&K(H,m.startTime-b);w=!1}return w}finally{v=null,y=c,z=!1}}var N=!1,O=null,L=-1,P=5,Q=-1;\nfunction M(){return exports.unstable_now()-Q<P?!1:!0}function R(){if(null!==O){var a=exports.unstable_now();Q=a;var b=!0;try{b=O(!0,a)}finally{b?S():(N=!1,O=null)}}else N=!1}var S;if(\"function\"===typeof F)S=function(){F(R)};else if(\"undefined\"!==typeof MessageChannel){var T=new MessageChannel,U=T.port2;T.port1.onmessage=R;S=function(){U.postMessage(null)}}else S=function(){D(R,0)};function I(a){O=a;N||(N=!0,S())}function K(a,b){L=D(function(){a(exports.unstable_now())},b)}\nexports.unstable_IdlePriority=5;exports.unstable_ImmediatePriority=1;exports.unstable_LowPriority=4;exports.unstable_NormalPriority=3;exports.unstable_Profiling=null;exports.unstable_UserBlockingPriority=2;exports.unstable_cancelCallback=function(a){a.callback=null};exports.unstable_continueExecution=function(){A||z||(A=!0,I(J))};\nexports.unstable_forceFrameRate=function(a){0>a||125<a?console.error(\"forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported\"):P=0<a?Math.floor(1E3/a):5};exports.unstable_getCurrentPriorityLevel=function(){return y};exports.unstable_getFirstCallbackNode=function(){return h(r)};exports.unstable_next=function(a){switch(y){case 1:case 2:case 3:var b=3;break;default:b=y}var c=y;y=b;try{return a()}finally{y=c}};exports.unstable_pauseExecution=function(){};\nexports.unstable_requestPaint=function(){};exports.unstable_runWithPriority=function(a,b){switch(a){case 1:case 2:case 3:case 4:case 5:break;default:a=3}var c=y;y=a;try{return b()}finally{y=c}};\nexports.unstable_scheduleCallback=function(a,b,c){var d=exports.unstable_now();\"object\"===typeof c&&null!==c?(c=c.delay,c=\"number\"===typeof c&&0<c?d+c:d):c=d;switch(a){case 1:var e=-1;break;case 2:e=250;break;case 5:e=1073741823;break;case 4:e=1E4;break;default:e=5E3}e=c+e;a={id:u++,callback:b,priorityLevel:a,startTime:c,expirationTime:e,sortIndex:-1};c>d?(a.sortIndex=c,f(t,a),null===h(r)&&a===h(t)&&(B?(E(L),L=-1):B=!0,K(H,c-d))):(a.sortIndex=e,f(r,a),A||z||(A=!0,I(J)));return a};\nexports.unstable_shouldYield=M;exports.unstable_wrapCallback=function(a){var b=y;return function(){var c=y;y=b;try{return a.apply(this,arguments)}finally{y=c}}};\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('./cjs/scheduler.production.min.js');\n} else {\n  module.exports = require('./cjs/scheduler.development.js');\n}\n","/**\n * Returns a function, that, as long as it continues to be invoked, will not\n * be triggered. The function will be called after it stops being called for\n * N milliseconds. If `immediate` is passed, trigger the function on the\n * leading edge, instead of the trailing. The function also has a property 'clear' \n * that is a function which will clear the timer to prevent previously scheduled executions. \n *\n * @source underscore.js\n * @see http://unscriptable.com/2009/03/20/debouncing-javascript-methods/\n * @param {Function} function to wrap\n * @param {Number} timeout in ms (`100`)\n * @param {Boolean} whether to execute at the beginning (`false`)\n * @api public\n */\nfunction debounce(func, wait, immediate){\n  var timeout, args, context, timestamp, result;\n  if (null == wait) wait = 100;\n\n  function later() {\n    var last = Date.now() - timestamp;\n\n    if (last < wait && last >= 0) {\n      timeout = setTimeout(later, wait - last);\n    } else {\n      timeout = null;\n      if (!immediate) {\n        result = func.apply(context, args);\n        context = args = null;\n      }\n    }\n  };\n\n  var debounced = function(){\n    context = this;\n    args = arguments;\n    timestamp = Date.now();\n    var callNow = immediate && !timeout;\n    if (!timeout) timeout = setTimeout(later, wait);\n    if (callNow) {\n      result = func.apply(context, args);\n      context = args = null;\n    }\n\n    return result;\n  };\n\n  debounced.clear = function() {\n    if (timeout) {\n      clearTimeout(timeout);\n      timeout = null;\n    }\n  };\n  \n  debounced.flush = function() {\n    if (timeout) {\n      result = func.apply(context, args);\n      context = args = null;\n      \n      clearTimeout(timeout);\n      timeout = null;\n    }\n  };\n\n  return debounced;\n};\n\n// Adds compatibility for ES modules\ndebounce.debounce = debounce;\n\nmodule.exports = debounce;\n","import * as React from \"react\";\nvar __defProp = Object.defineProperty;\nvar __defProps = Object.defineProperties;\nvar __getOwnPropDescs = Object.getOwnPropertyDescriptors;\nvar __getOwnPropSymbols = Object.getOwnPropertySymbols;\nvar __hasOwnProp = Object.prototype.hasOwnProperty;\nvar __propIsEnum = Object.prototype.propertyIsEnumerable;\nvar __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;\nvar __spreadValues = (a, b) => {\n  for (var prop in b || (b = {}))\n    if (__hasOwnProp.call(b, prop))\n      __defNormalProp(a, prop, b[prop]);\n  if (__getOwnPropSymbols)\n    for (var prop of __getOwnPropSymbols(b)) {\n      if (__propIsEnum.call(b, prop))\n        __defNormalProp(a, prop, b[prop]);\n    }\n  return a;\n};\nvar __spreadProps = (a, b) => __defProps(a, __getOwnPropDescs(b));\nvar _a, _b;\nconst useIsomorphicLayoutEffect = typeof window !== \"undefined\" && (((_a = window.document) == null ? void 0 : _a.createElement) || ((_b = window.navigator) == null ? void 0 : _b.product) === \"ReactNative\") ? React.useLayoutEffect : React.useEffect;\nfunction traverseFiber(fiber, ascending, selector) {\n  if (!fiber)\n    return;\n  if (selector(fiber) === true)\n    return fiber;\n  let child = ascending ? fiber.return : fiber.child;\n  while (child) {\n    const match = traverseFiber(child, ascending, selector);\n    if (match)\n      return match;\n    child = ascending ? null : child.sibling;\n  }\n}\nfunction wrapContext(context) {\n  try {\n    return Object.defineProperties(context, {\n      _currentRenderer: {\n        get() {\n          return null;\n        },\n        set() {\n        }\n      },\n      _currentRenderer2: {\n        get() {\n          return null;\n        },\n        set() {\n        }\n      }\n    });\n  } catch (_) {\n    return context;\n  }\n}\nconst error = console.error;\nconsole.error = function() {\n  const message = [...arguments].join(\"\");\n  if ((message == null ? void 0 : message.startsWith(\"Warning:\")) && message.includes(\"useContext\")) {\n    console.error = error;\n    return;\n  }\n  return error.apply(this, arguments);\n};\nconst FiberContext = wrapContext(React.createContext(null));\nclass FiberProvider extends React.Component {\n  render() {\n    return /* @__PURE__ */ React.createElement(FiberContext.Provider, {\n      value: this._reactInternals\n    }, this.props.children);\n  }\n}\nfunction useFiber() {\n  const root = React.useContext(FiberContext);\n  if (root === null)\n    throw new Error(\"its-fine: useFiber must be called within a <FiberProvider />!\");\n  const id = React.useId();\n  const fiber = React.useMemo(() => {\n    for (const maybeFiber of [root, root == null ? void 0 : root.alternate]) {\n      if (!maybeFiber)\n        continue;\n      const fiber2 = traverseFiber(maybeFiber, false, (node) => {\n        let state = node.memoizedState;\n        while (state) {\n          if (state.memoizedState === id)\n            return true;\n          state = state.next;\n        }\n      });\n      if (fiber2)\n        return fiber2;\n    }\n  }, [root, id]);\n  return fiber;\n}\nfunction useContainer() {\n  const fiber = useFiber();\n  const root = React.useMemo(\n    () => traverseFiber(fiber, true, (node) => {\n      var _a2;\n      return ((_a2 = node.stateNode) == null ? void 0 : _a2.containerInfo) != null;\n    }),\n    [fiber]\n  );\n  return root == null ? void 0 : root.stateNode.containerInfo;\n}\nfunction useNearestChild(type) {\n  const fiber = useFiber();\n  const childRef = React.useRef();\n  useIsomorphicLayoutEffect(() => {\n    var _a2;\n    childRef.current = (_a2 = traverseFiber(\n      fiber,\n      false,\n      (node) => typeof node.type === \"string\" && (type === void 0 || node.type === type)\n    )) == null ? void 0 : _a2.stateNode;\n  }, [fiber]);\n  return childRef;\n}\nfunction useNearestParent(type) {\n  const fiber = useFiber();\n  const parentRef = React.useRef();\n  useIsomorphicLayoutEffect(() => {\n    var _a2;\n    parentRef.current = (_a2 = traverseFiber(\n      fiber,\n      true,\n      (node) => typeof node.type === \"string\" && (type === void 0 || node.type === type)\n    )) == null ? void 0 : _a2.stateNode;\n  }, [fiber]);\n  return parentRef;\n}\nfunction useContextMap() {\n  const fiber = useFiber();\n  const [contextMap] = React.useState(() => /* @__PURE__ */ new Map());\n  contextMap.clear();\n  let node = fiber;\n  while (node) {\n    if (node.type && typeof node.type === \"object\") {\n      const enableRenderableContext = node.type._context === void 0 && node.type.Provider === node.type;\n      const context = enableRenderableContext ? node.type : node.type._context;\n      if (context && context !== FiberContext && !contextMap.has(context)) {\n        contextMap.set(context, React.useContext(wrapContext(context)));\n      }\n    }\n    node = node.return;\n  }\n  return contextMap;\n}\nfunction useContextBridge() {\n  const contextMap = useContextMap();\n  return React.useMemo(\n    () => Array.from(contextMap.keys()).reduce(\n      (Prev, context) => (props) => /* @__PURE__ */ React.createElement(Prev, null, /* @__PURE__ */ React.createElement(context.Provider, __spreadProps(__spreadValues({}, props), {\n        value: contextMap.get(context)\n      }))),\n      (props) => /* @__PURE__ */ React.createElement(FiberProvider, __spreadValues({}, props))\n    ),\n    [contextMap]\n  );\n}\nexport {\n  FiberProvider,\n  traverseFiber,\n  useContainer,\n  useContextBridge,\n  useContextMap,\n  useFiber,\n  useNearestChild,\n  useNearestParent\n};\n//# sourceMappingURL=index.js.map\n","function _extends() {\n  return _extends = Object.assign ? Object.assign.bind() : function (n) {\n    for (var e = 1; e < arguments.length; e++) {\n      var t = arguments[e];\n      for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]);\n    }\n    return n;\n  }, _extends.apply(null, arguments);\n}\nexport { _extends as default };","function SDFGenerator() {\nvar exports = (function (exports) {\n\n  /**\n   * Find the point on a quadratic bezier curve at t where t is in the range [0, 1]\n   */\n  function pointOnQuadraticBezier (x0, y0, x1, y1, x2, y2, t, pointOut) {\n    var t2 = 1 - t;\n    pointOut.x = t2 * t2 * x0 + 2 * t2 * t * x1 + t * t * x2;\n    pointOut.y = t2 * t2 * y0 + 2 * t2 * t * y1 + t * t * y2;\n  }\n\n  /**\n   * Find the point on a cubic bezier curve at t where t is in the range [0, 1]\n   */\n  function pointOnCubicBezier (x0, y0, x1, y1, x2, y2, x3, y3, t, pointOut) {\n    var t2 = 1 - t;\n    pointOut.x = t2 * t2 * t2 * x0 + 3 * t2 * t2 * t * x1 + 3 * t2 * t * t * x2 + t * t * t * x3;\n    pointOut.y = t2 * t2 * t2 * y0 + 3 * t2 * t2 * t * y1 + 3 * t2 * t * t * y2 + t * t * t * y3;\n  }\n\n  /**\n   * Parse a path string into its constituent line/curve commands, invoking a callback for each.\n   * @param {string} pathString - An SVG-like path string to parse; should only contain commands: M/L/Q/C/Z\n   * @param {function(\n   *   command: 'L'|'Q'|'C',\n   *   startX: number,\n   *   startY: number,\n   *   endX: number,\n   *   endY: number,\n   *   ctrl1X?: number,\n   *   ctrl1Y?: number,\n   *   ctrl2X?: number,\n   *   ctrl2Y?: number\n   * )} commandCallback - A callback function that will be called once for each parsed path command, passing the\n   *                      command identifier (only L/Q/C commands) and its numeric arguments.\n   */\n  function forEachPathCommand(pathString, commandCallback) {\n    var segmentRE = /([MLQCZ])([^MLQCZ]*)/g;\n    var match, firstX, firstY, prevX, prevY;\n    while ((match = segmentRE.exec(pathString))) {\n      var args = match[2]\n        .replace(/^\\s*|\\s*$/g, '')\n        .split(/[,\\s]+/)\n        .map(function (v) { return parseFloat(v); });\n      switch (match[1]) {\n        case 'M':\n          prevX = firstX = args[0];\n          prevY = firstY = args[1];\n          break\n        case 'L':\n          if (args[0] !== prevX || args[1] !== prevY) { // yup, some fonts have zero-length line commands\n            commandCallback('L', prevX, prevY, (prevX = args[0]), (prevY = args[1]));\n          }\n          break\n        case 'Q': {\n          commandCallback('Q', prevX, prevY, (prevX = args[2]), (prevY = args[3]), args[0], args[1]);\n          break\n        }\n        case 'C': {\n          commandCallback('C', prevX, prevY, (prevX = args[4]), (prevY = args[5]), args[0], args[1], args[2], args[3]);\n          break\n        }\n        case 'Z':\n          if (prevX !== firstX || prevY !== firstY) {\n            commandCallback('L', prevX, prevY, firstX, firstY);\n          }\n          break\n      }\n    }\n  }\n\n  /**\n   * Convert a path string to a series of straight line segments\n   * @param {string} pathString - An SVG-like path string to parse; should only contain commands: M/L/Q/C/Z\n   * @param {function(x1:number, y1:number, x2:number, y2:number)} segmentCallback - A callback\n   *        function that will be called once for every line segment\n   * @param {number} [curvePoints] - How many straight line segments to use when approximating a\n   *        bezier curve in the path. Defaults to 16.\n   */\n  function pathToLineSegments (pathString, segmentCallback, curvePoints) {\n    if ( curvePoints === void 0 ) curvePoints = 16;\n\n    var tempPoint = { x: 0, y: 0 };\n    forEachPathCommand(pathString, function (command, startX, startY, endX, endY, ctrl1X, ctrl1Y, ctrl2X, ctrl2Y) {\n      switch (command) {\n        case 'L':\n          segmentCallback(startX, startY, endX, endY);\n          break\n        case 'Q': {\n          var prevCurveX = startX;\n          var prevCurveY = startY;\n          for (var i = 1; i < curvePoints; i++) {\n            pointOnQuadraticBezier(\n              startX, startY,\n              ctrl1X, ctrl1Y,\n              endX, endY,\n              i / (curvePoints - 1),\n              tempPoint\n            );\n            segmentCallback(prevCurveX, prevCurveY, tempPoint.x, tempPoint.y);\n            prevCurveX = tempPoint.x;\n            prevCurveY = tempPoint.y;\n          }\n          break\n        }\n        case 'C': {\n          var prevCurveX$1 = startX;\n          var prevCurveY$1 = startY;\n          for (var i$1 = 1; i$1 < curvePoints; i$1++) {\n            pointOnCubicBezier(\n              startX, startY,\n              ctrl1X, ctrl1Y,\n              ctrl2X, ctrl2Y,\n              endX, endY,\n              i$1 / (curvePoints - 1),\n              tempPoint\n            );\n            segmentCallback(prevCurveX$1, prevCurveY$1, tempPoint.x, tempPoint.y);\n            prevCurveX$1 = tempPoint.x;\n            prevCurveY$1 = tempPoint.y;\n          }\n          break\n        }\n      }\n    });\n  }\n\n  var viewportQuadVertex = \"precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}\";\n\n  var copyTexFragment = \"precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}\";\n\n  var cache = new WeakMap();\n\n  var glContextParams = {\n    premultipliedAlpha: false,\n    preserveDrawingBuffer: true,\n    antialias: false,\n    depth: false,\n  };\n\n  /**\n   * This is a little helper library for WebGL. It assists with state management for a GL context.\n   * It's pretty tightly wrapped to the needs of this package, not very general-purpose.\n   *\n   * @param { WebGLRenderingContext | HTMLCanvasElement | OffscreenCanvas } glOrCanvas - the GL context to wrap\n   * @param { ({gl, getExtension, withProgram, withTexture, withTextureFramebuffer, handleContextLoss}) => void } callback\n   */\n  function withWebGLContext (glOrCanvas, callback) {\n    var gl = glOrCanvas.getContext ? glOrCanvas.getContext('webgl', glContextParams) : glOrCanvas;\n    var wrapper = cache.get(gl);\n    if (!wrapper) {\n      var isWebGL2 = typeof WebGL2RenderingContext !== 'undefined' && gl instanceof WebGL2RenderingContext;\n      var extensions = {};\n      var programs = {};\n      var textures = {};\n      var textureUnit = -1;\n      var framebufferStack = [];\n\n      gl.canvas.addEventListener('webglcontextlost', function (e) {\n        handleContextLoss();\n        e.preventDefault();\n      }, false);\n\n      function getExtension (name) {\n        var ext = extensions[name];\n        if (!ext) {\n          ext = extensions[name] = gl.getExtension(name);\n          if (!ext) {\n            throw new Error((name + \" not supported\"))\n          }\n        }\n        return ext\n      }\n\n      function compileShader (src, type) {\n        var shader = gl.createShader(type);\n        gl.shaderSource(shader, src);\n        gl.compileShader(shader);\n        // const status = gl.getShaderParameter(shader, gl.COMPILE_STATUS)\n        // if (!status && !gl.isContextLost()) {\n        //   throw new Error(gl.getShaderInfoLog(shader).trim())\n        // }\n        return shader\n      }\n\n      function withProgram (name, vert, frag, func) {\n        if (!programs[name]) {\n          var attributes = {};\n          var uniforms = {};\n          var program = gl.createProgram();\n          gl.attachShader(program, compileShader(vert, gl.VERTEX_SHADER));\n          gl.attachShader(program, compileShader(frag, gl.FRAGMENT_SHADER));\n          gl.linkProgram(program);\n\n          programs[name] = {\n            program: program,\n            transaction: function transaction (func) {\n              gl.useProgram(program);\n              func({\n                setUniform: function setUniform (type, name) {\n                  var values = [], len = arguments.length - 2;\n                  while ( len-- > 0 ) values[ len ] = arguments[ len + 2 ];\n\n                  var uniformLoc = uniforms[name] || (uniforms[name] = gl.getUniformLocation(program, name));\n                  gl[(\"uniform\" + type)].apply(gl, [ uniformLoc ].concat( values ));\n                },\n\n                setAttribute: function setAttribute (name, size, usage, instancingDivisor, data) {\n                  var attr = attributes[name];\n                  if (!attr) {\n                    attr = attributes[name] = {\n                      buf: gl.createBuffer(), // TODO should we destroy our buffers?\n                      loc: gl.getAttribLocation(program, name),\n                      data: null\n                    };\n                  }\n                  gl.bindBuffer(gl.ARRAY_BUFFER, attr.buf);\n                  gl.vertexAttribPointer(attr.loc, size, gl.FLOAT, false, 0, 0);\n                  gl.enableVertexAttribArray(attr.loc);\n                  if (isWebGL2) {\n                    gl.vertexAttribDivisor(attr.loc, instancingDivisor);\n                  } else {\n                    getExtension('ANGLE_instanced_arrays').vertexAttribDivisorANGLE(attr.loc, instancingDivisor);\n                  }\n                  if (data !== attr.data) {\n                    gl.bufferData(gl.ARRAY_BUFFER, data, usage);\n                    attr.data = data;\n                  }\n                }\n              });\n            }\n          };\n        }\n\n        programs[name].transaction(func);\n      }\n\n      function withTexture (name, func) {\n        textureUnit++;\n        try {\n          gl.activeTexture(gl.TEXTURE0 + textureUnit);\n          var texture = textures[name];\n          if (!texture) {\n            texture = textures[name] = gl.createTexture();\n            gl.bindTexture(gl.TEXTURE_2D, texture);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n          }\n          gl.bindTexture(gl.TEXTURE_2D, texture);\n          func(texture, textureUnit);\n        } finally {\n          textureUnit--;\n        }\n      }\n\n      function withTextureFramebuffer (texture, textureUnit, func) {\n        var framebuffer = gl.createFramebuffer();\n        framebufferStack.push(framebuffer);\n        gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n        gl.activeTexture(gl.TEXTURE0 + textureUnit);\n        gl.bindTexture(gl.TEXTURE_2D, texture);\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\n        try {\n          func(framebuffer);\n        } finally {\n          gl.deleteFramebuffer(framebuffer);\n          gl.bindFramebuffer(gl.FRAMEBUFFER, framebufferStack[--framebufferStack.length - 1] || null);\n        }\n      }\n\n      function handleContextLoss () {\n        extensions = {};\n        programs = {};\n        textures = {};\n        textureUnit = -1;\n        framebufferStack.length = 0;\n      }\n\n      cache.set(gl, wrapper = {\n        gl: gl,\n        isWebGL2: isWebGL2,\n        getExtension: getExtension,\n        withProgram: withProgram,\n        withTexture: withTexture,\n        withTextureFramebuffer: withTextureFramebuffer,\n        handleContextLoss: handleContextLoss,\n      });\n    }\n    callback(wrapper);\n  }\n\n\n  function renderImageData(glOrCanvas, imageData, x, y, width, height, channels, framebuffer) {\n    if ( channels === void 0 ) channels = 15;\n    if ( framebuffer === void 0 ) framebuffer = null;\n\n    withWebGLContext(glOrCanvas, function (ref) {\n      var gl = ref.gl;\n      var withProgram = ref.withProgram;\n      var withTexture = ref.withTexture;\n\n      withTexture('copy', function (tex, texUnit) {\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, gl.UNSIGNED_BYTE, imageData);\n        withProgram('copy', viewportQuadVertex, copyTexFragment, function (ref) {\n          var setUniform = ref.setUniform;\n          var setAttribute = ref.setAttribute;\n\n          setAttribute('aUV', 2, gl.STATIC_DRAW, 0, new Float32Array([0, 0, 2, 0, 0, 2]));\n          setUniform('1i', 'image', texUnit);\n          gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer || null);\n          gl.disable(gl.BLEND);\n          gl.colorMask(channels & 8, channels & 4, channels & 2, channels & 1);\n          gl.viewport(x, y, width, height);\n          gl.scissor(x, y, width, height);\n          gl.drawArrays(gl.TRIANGLES, 0, 3);\n        });\n      });\n    });\n  }\n\n  /**\n   * Resizing a canvas clears its contents; this utility copies the previous contents over.\n   * @param canvas\n   * @param newWidth\n   * @param newHeight\n   */\n  function resizeWebGLCanvasWithoutClearing(canvas, newWidth, newHeight) {\n    var width = canvas.width;\n    var height = canvas.height;\n    withWebGLContext(canvas, function (ref) {\n      var gl = ref.gl;\n\n      var data = new Uint8Array(width * height * 4);\n      gl.readPixels(0, 0, width, height, gl.RGBA, gl.UNSIGNED_BYTE, data);\n      canvas.width = newWidth;\n      canvas.height = newHeight;\n      renderImageData(gl, data, 0, 0, width, height);\n    });\n  }\n\n  var webglUtils = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    withWebGLContext: withWebGLContext,\n    renderImageData: renderImageData,\n    resizeWebGLCanvasWithoutClearing: resizeWebGLCanvasWithoutClearing\n  });\n\n  function generate$2 (sdfWidth, sdfHeight, path, viewBox, maxDistance, sdfExponent) {\n    if ( sdfExponent === void 0 ) sdfExponent = 1;\n\n    var textureData = new Uint8Array(sdfWidth * sdfHeight);\n\n    var viewBoxWidth = viewBox[2] - viewBox[0];\n    var viewBoxHeight = viewBox[3] - viewBox[1];\n\n    // Decompose all paths into straight line segments and add them to an index\n    var segments = [];\n    pathToLineSegments(path, function (x1, y1, x2, y2) {\n      segments.push({\n        x1: x1, y1: y1, x2: x2, y2: y2,\n        minX: Math.min(x1, x2),\n        minY: Math.min(y1, y2),\n        maxX: Math.max(x1, x2),\n        maxY: Math.max(y1, y2)\n      });\n    });\n\n    // Sort segments by maxX, this will let us short-circuit some loops below\n    segments.sort(function (a, b) { return a.maxX - b.maxX; });\n\n    // For each target SDF texel, find the distance from its center to its nearest line segment,\n    // map that distance to an alpha value, and write that alpha to the texel\n    for (var sdfX = 0; sdfX < sdfWidth; sdfX++) {\n      for (var sdfY = 0; sdfY < sdfHeight; sdfY++) {\n        var signedDist = findNearestSignedDistance(\n          viewBox[0] + viewBoxWidth * (sdfX + 0.5) / sdfWidth,\n          viewBox[1] + viewBoxHeight * (sdfY + 0.5) / sdfHeight\n        );\n\n        // Use an exponential scale to ensure the texels very near the glyph path have adequate\n        // precision, while allowing the distance field to cover the entire texture, given that\n        // there are only 8 bits available. Formula visualized: https://www.desmos.com/calculator/uiaq5aqiam\n        var alpha = Math.pow((1 - Math.abs(signedDist) / maxDistance), sdfExponent) / 2;\n        if (signedDist < 0) {\n          alpha = 1 - alpha;\n        }\n\n        alpha = Math.max(0, Math.min(255, Math.round(alpha * 255))); //clamp\n        textureData[sdfY * sdfWidth + sdfX] = alpha;\n      }\n    }\n\n    return textureData\n\n    /**\n     * For a given x/y, search the index for the closest line segment and return\n     * its signed distance. Negative = inside, positive = outside, zero = on edge\n     * @param x\n     * @param y\n     * @returns {number}\n     */\n    function findNearestSignedDistance (x, y) {\n      var closestDistSq = Infinity;\n      var closestDist = Infinity;\n\n      for (var i = segments.length; i--;) {\n        var seg = segments[i];\n        if (seg.maxX + closestDist <= x) { break } //sorting by maxX means no more can be closer, so we can short-circuit\n        if (x + closestDist > seg.minX && y - closestDist < seg.maxY && y + closestDist > seg.minY) {\n          var distSq = absSquareDistanceToLineSegment(x, y, seg.x1, seg.y1, seg.x2, seg.y2);\n          if (distSq < closestDistSq) {\n            closestDistSq = distSq;\n            closestDist = Math.sqrt(closestDistSq);\n          }\n        }\n      }\n\n      // Flip to negative distance if inside the poly\n      if (isPointInPoly(x, y)) {\n        closestDist = -closestDist;\n      }\n      return closestDist\n    }\n\n    /**\n     * Determine whether the given point lies inside or outside the glyph. Uses a simple\n     * winding-number ray casting algorithm using a ray pointing east from the point.\n     */\n    function isPointInPoly (x, y) {\n      var winding = 0;\n      for (var i = segments.length; i--;) {\n        var seg = segments[i];\n        if (seg.maxX <= x) { break } //sorting by maxX means no more can cross, so we can short-circuit\n        var intersects = ((seg.y1 > y) !== (seg.y2 > y)) && (x < (seg.x2 - seg.x1) * (y - seg.y1) / (seg.y2 - seg.y1) + seg.x1);\n        if (intersects) {\n          winding += seg.y1 < seg.y2 ? 1 : -1;\n        }\n      }\n      return winding !== 0\n    }\n  }\n\n  function generateIntoCanvas$2(sdfWidth, sdfHeight, path, viewBox, maxDistance, sdfExponent, canvas, x, y, channel) {\n    if ( sdfExponent === void 0 ) sdfExponent = 1;\n    if ( x === void 0 ) x = 0;\n    if ( y === void 0 ) y = 0;\n    if ( channel === void 0 ) channel = 0;\n\n    generateIntoFramebuffer$1(sdfWidth, sdfHeight, path, viewBox, maxDistance, sdfExponent, canvas, null, x, y, channel);\n  }\n\n  function generateIntoFramebuffer$1 (sdfWidth, sdfHeight, path, viewBox, maxDistance, sdfExponent, glOrCanvas, framebuffer, x, y, channel) {\n    if ( sdfExponent === void 0 ) sdfExponent = 1;\n    if ( x === void 0 ) x = 0;\n    if ( y === void 0 ) y = 0;\n    if ( channel === void 0 ) channel = 0;\n\n    var data = generate$2(sdfWidth, sdfHeight, path, viewBox, maxDistance, sdfExponent);\n    // Expand single-channel data to rbga\n    var rgbaData = new Uint8Array(data.length * 4);\n    for (var i = 0; i < data.length; i++) {\n      rgbaData[i * 4 + channel] = data[i];\n    }\n    renderImageData(glOrCanvas, rgbaData, x, y, sdfWidth, sdfHeight, 1 << (3 - channel), framebuffer);\n  }\n\n  /**\n   * Find the absolute distance from a point to a line segment at closest approach\n   */\n  function absSquareDistanceToLineSegment (x, y, lineX0, lineY0, lineX1, lineY1) {\n    var ldx = lineX1 - lineX0;\n    var ldy = lineY1 - lineY0;\n    var lengthSq = ldx * ldx + ldy * ldy;\n    var t = lengthSq ? Math.max(0, Math.min(1, ((x - lineX0) * ldx + (y - lineY0) * ldy) / lengthSq)) : 0;\n    var dx = x - (lineX0 + t * ldx);\n    var dy = y - (lineY0 + t * ldy);\n    return dx * dx + dy * dy\n  }\n\n  var javascript = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    generate: generate$2,\n    generateIntoCanvas: generateIntoCanvas$2,\n    generateIntoFramebuffer: generateIntoFramebuffer$1\n  });\n\n  var mainVertex = \"precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}\";\n\n  var mainFragment = \"precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}\";\n\n  var postFragment = \"precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}\";\n\n  // Single triangle covering viewport\n  var viewportUVs = new Float32Array([0, 0, 2, 0, 0, 2]);\n\n  var implicitContext = null;\n  var isTestingSupport = false;\n  var NULL_OBJECT = {};\n  var supportByCanvas = new WeakMap(); // canvas -> bool\n\n  function validateSupport (glOrCanvas) {\n    if (!isTestingSupport && !isSupported(glOrCanvas)) {\n      throw new Error('WebGL generation not supported')\n    }\n  }\n\n  function generate$1 (sdfWidth, sdfHeight, path, viewBox, maxDistance, sdfExponent, glOrCanvas) {\n    if ( sdfExponent === void 0 ) sdfExponent = 1;\n    if ( glOrCanvas === void 0 ) glOrCanvas = null;\n\n    if (!glOrCanvas) {\n      glOrCanvas = implicitContext;\n      if (!glOrCanvas) {\n        var canvas = typeof OffscreenCanvas === 'function'\n          ? new OffscreenCanvas(1, 1)\n          : typeof document !== 'undefined'\n            ? document.createElement('canvas')\n            : null;\n        if (!canvas) {\n          throw new Error('OffscreenCanvas or DOM canvas not supported')\n        }\n        glOrCanvas = implicitContext = canvas.getContext('webgl', { depth: false });\n      }\n    }\n\n    validateSupport(glOrCanvas);\n\n    var rgbaData = new Uint8Array(sdfWidth * sdfHeight * 4); //not Uint8ClampedArray, cuz Safari\n\n    // Render into a background texture framebuffer\n    withWebGLContext(glOrCanvas, function (ref) {\n      var gl = ref.gl;\n      var withTexture = ref.withTexture;\n      var withTextureFramebuffer = ref.withTextureFramebuffer;\n\n      withTexture('readable', function (texture, textureUnit) {\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, sdfWidth, sdfHeight, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n\n        withTextureFramebuffer(texture, textureUnit, function (framebuffer) {\n          generateIntoFramebuffer(\n            sdfWidth,\n            sdfHeight,\n            path,\n            viewBox,\n            maxDistance,\n            sdfExponent,\n            gl,\n            framebuffer,\n            0,\n            0,\n            0 // red channel\n          );\n          gl.readPixels(0, 0, sdfWidth, sdfHeight, gl.RGBA, gl.UNSIGNED_BYTE, rgbaData);\n        });\n      });\n    });\n\n    // Throw away all but the red channel\n    var data = new Uint8Array(sdfWidth * sdfHeight);\n    for (var i = 0, j = 0; i < rgbaData.length; i += 4) {\n      data[j++] = rgbaData[i];\n    }\n\n    return data\n  }\n\n  function generateIntoCanvas$1(sdfWidth, sdfHeight, path, viewBox, maxDistance, sdfExponent, canvas, x, y, channel) {\n    if ( sdfExponent === void 0 ) sdfExponent = 1;\n    if ( x === void 0 ) x = 0;\n    if ( y === void 0 ) y = 0;\n    if ( channel === void 0 ) channel = 0;\n\n    generateIntoFramebuffer(sdfWidth, sdfHeight, path, viewBox, maxDistance, sdfExponent, canvas, null, x, y, channel);\n  }\n\n  function generateIntoFramebuffer (sdfWidth, sdfHeight, path, viewBox, maxDistance, sdfExponent, glOrCanvas, framebuffer, x, y, channel) {\n    if ( sdfExponent === void 0 ) sdfExponent = 1;\n    if ( x === void 0 ) x = 0;\n    if ( y === void 0 ) y = 0;\n    if ( channel === void 0 ) channel = 0;\n\n    // Verify support\n    validateSupport(glOrCanvas);\n\n    // Compute path segments\n    var lineSegmentCoords = [];\n    pathToLineSegments(path, function (x1, y1, x2, y2) {\n      lineSegmentCoords.push(x1, y1, x2, y2);\n    });\n    lineSegmentCoords = new Float32Array(lineSegmentCoords);\n\n    withWebGLContext(glOrCanvas, function (ref) {\n      var gl = ref.gl;\n      var isWebGL2 = ref.isWebGL2;\n      var getExtension = ref.getExtension;\n      var withProgram = ref.withProgram;\n      var withTexture = ref.withTexture;\n      var withTextureFramebuffer = ref.withTextureFramebuffer;\n      var handleContextLoss = ref.handleContextLoss;\n\n      withTexture('rawDistances', function (intermediateTexture, intermediateTextureUnit) {\n        if (sdfWidth !== intermediateTexture._lastWidth || sdfHeight !== intermediateTexture._lastHeight) {\n          gl.texImage2D(\n            gl.TEXTURE_2D, 0, gl.RGBA,\n            intermediateTexture._lastWidth = sdfWidth,\n            intermediateTexture._lastHeight = sdfHeight,\n            0, gl.RGBA, gl.UNSIGNED_BYTE, null\n          );\n        }\n\n        // Unsigned distance pass\n        withProgram('main', mainVertex, mainFragment, function (ref) {\n          var setAttribute = ref.setAttribute;\n          var setUniform = ref.setUniform;\n\n          // Init extensions\n          var instancingExtension = !isWebGL2 && getExtension('ANGLE_instanced_arrays');\n          var blendMinMaxExtension = !isWebGL2 && getExtension('EXT_blend_minmax');\n\n          // Init/update attributes\n          setAttribute('aUV', 2, gl.STATIC_DRAW, 0, viewportUVs);\n          setAttribute('aLineSegment', 4, gl.DYNAMIC_DRAW, 1, lineSegmentCoords);\n\n          // Init/update uniforms\n          setUniform.apply(void 0, [ '4f', 'uGlyphBounds' ].concat( viewBox ));\n          setUniform('1f', 'uMaxDistance', maxDistance);\n          setUniform('1f', 'uExponent', sdfExponent);\n\n          // Render initial unsigned distance / winding number info to a texture\n          withTextureFramebuffer(intermediateTexture, intermediateTextureUnit, function (framebuffer) {\n            gl.enable(gl.BLEND);\n            gl.colorMask(true, true, true, true);\n            gl.viewport(0, 0, sdfWidth, sdfHeight);\n            gl.scissor(0, 0, sdfWidth, sdfHeight);\n            gl.blendFunc(gl.ONE, gl.ONE);\n            // Red+Green channels are incremented (FUNC_ADD) for segment-ray crossings to give a \"winding number\".\n            // Alpha holds the closest (MAX) unsigned distance.\n            gl.blendEquationSeparate(gl.FUNC_ADD, isWebGL2 ? gl.MAX : blendMinMaxExtension.MAX_EXT);\n            gl.clear(gl.COLOR_BUFFER_BIT);\n            if (isWebGL2) {\n              gl.drawArraysInstanced(gl.TRIANGLES, 0, 3, lineSegmentCoords.length / 4);\n            } else {\n              instancingExtension.drawArraysInstancedANGLE(gl.TRIANGLES, 0, 3, lineSegmentCoords.length / 4);\n            }\n            // Debug\n            // const debug = new Uint8Array(sdfWidth * sdfHeight * 4)\n            // gl.readPixels(0, 0, sdfWidth, sdfHeight, gl.RGBA, gl.UNSIGNED_BYTE, debug)\n            // console.log('intermediate texture data: ', debug)\n          });\n        });\n\n        // Use the data stored in the texture to apply inside/outside and write to the output framebuffer rect+channel.\n        withProgram('post', viewportQuadVertex, postFragment, function (program) {\n          program.setAttribute('aUV', 2, gl.STATIC_DRAW, 0, viewportUVs);\n          program.setUniform('1i', 'tex', intermediateTextureUnit);\n          gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n          gl.disable(gl.BLEND);\n          gl.colorMask(channel === 0, channel === 1, channel === 2, channel === 3);\n          gl.viewport(x, y, sdfWidth, sdfHeight);\n          gl.scissor(x, y, sdfWidth, sdfHeight);\n          gl.drawArrays(gl.TRIANGLES, 0, 3);\n        });\n      });\n\n      // Handle context loss occurring during any of the above calls\n      if (gl.isContextLost()) {\n        handleContextLoss();\n        throw new Error('webgl context lost')\n      }\n    });\n  }\n\n  function isSupported (glOrCanvas) {\n    var key = (!glOrCanvas || glOrCanvas === implicitContext) ? NULL_OBJECT : (glOrCanvas.canvas || glOrCanvas);\n    var supported = supportByCanvas.get(key);\n    if (supported === undefined) {\n      isTestingSupport = true;\n      var failReason = null;\n      try {\n        // Since we can't detect all failure modes up front, let's just do a trial run of a\n        // simple path and compare what we get back to the correct expected result. This will\n        // also serve to prime the shader compilation.\n        var expectedResult = [\n          97, 106, 97, 61,\n          99, 137, 118, 80,\n          80, 118, 137, 99,\n          61, 97, 106, 97\n        ];\n        var testResult = generate$1(\n          4,\n          4,\n          'M8,8L16,8L24,24L16,24Z',\n          [0, 0, 32, 32],\n          24,\n          1,\n          glOrCanvas\n        );\n        supported = testResult && expectedResult.length === testResult.length &&\n          testResult.every(function (val, i) { return val === expectedResult[i]; });\n        if (!supported) {\n          failReason = 'bad trial run results';\n          console.info(expectedResult, testResult);\n        }\n      } catch (err) {\n        // TODO if it threw due to webgl context loss, should we maybe leave isSupported as null and try again later?\n        supported = false;\n        failReason = err.message;\n      }\n      if (failReason) {\n        console.warn('WebGL SDF generation not supported:', failReason);\n      }\n      isTestingSupport = false;\n      supportByCanvas.set(key, supported);\n    }\n    return supported\n  }\n\n  var webgl = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    generate: generate$1,\n    generateIntoCanvas: generateIntoCanvas$1,\n    generateIntoFramebuffer: generateIntoFramebuffer,\n    isSupported: isSupported\n  });\n\n  /**\n   * Generate an SDF texture image for a 2D path.\n   *\n   * @param {number} sdfWidth - width of the SDF output image in pixels.\n   * @param {number} sdfHeight - height of the SDF output image in pixels.\n   * @param {string} path - an SVG-like path string describing the glyph; should only contain commands: M/L/Q/C/Z.\n   * @param {number[]} viewBox - [minX, minY, maxX, maxY] in font units aligning with the texture's edges.\n   * @param {number} maxDistance - the maximum distance from the glyph path in font units that will be encoded; defaults\n   *        to half the maximum viewBox dimension.\n   * @param {number} [sdfExponent] - specifies an exponent for encoding the SDF's distance values; higher exponents\n   *        will give greater precision nearer the glyph's path.\n   * @return {Uint8Array}\n   */\n  function generate(\n    sdfWidth,\n    sdfHeight,\n    path,\n    viewBox,\n    maxDistance,\n    sdfExponent\n  ) {\n    if ( maxDistance === void 0 ) maxDistance = Math.max(viewBox[2] - viewBox[0], viewBox[3] - viewBox[1]) / 2;\n    if ( sdfExponent === void 0 ) sdfExponent = 1;\n\n    try {\n      return generate$1.apply(webgl, arguments)\n    } catch(e) {\n      console.info('WebGL SDF generation failed, falling back to JS', e);\n      return generate$2.apply(javascript, arguments)\n    }\n  }\n\n  /**\n   * Generate an SDF texture image for a 2D path, inserting the result into a WebGL `canvas` at a given x/y position\n   * and color channel. This is generally much faster than calling `generate` because it does not require reading pixels\n   * back from the GPU->CPU -- the `canvas` can be used directly as a WebGL texture image, so it all stays on the GPU.\n   *\n   * @param {number} sdfWidth - width of the SDF output image in pixels.\n   * @param {number} sdfHeight - height of the SDF output image in pixels.\n   * @param {string} path - an SVG-like path string describing the glyph; should only contain commands: M/L/Q/C/Z.\n   * @param {number[]} viewBox - [minX, minY, maxX, maxY] in font units aligning with the texture's edges.\n   * @param {number} maxDistance - the maximum distance from the glyph path in font units that will be encoded; defaults\n   *        to half the maximum viewBox dimension.\n   * @param {number} [sdfExponent] - specifies an exponent for encoding the SDF's distance values; higher exponents\n   *        will give greater precision nearer the glyph's path.\n   * @param {HTMLCanvasElement|OffscreenCanvas} canvas - a WebGL-enabled canvas into which the SDF will be rendered.\n   *        Only the relevant rect/channel will be modified, the rest will be preserved. To avoid unpredictable results\n   *        due to shared GL context state, this canvas should be dedicated to use by this library alone.\n   * @param {number} x - the x position at which to render the SDF.\n   * @param {number} y - the y position at which to render the SDF.\n   * @param {number} channel - the color channel index (0-4) into which the SDF will be rendered.\n   * @return {Uint8Array}\n   */\n  function generateIntoCanvas(\n    sdfWidth,\n    sdfHeight,\n    path,\n    viewBox,\n    maxDistance,\n    sdfExponent,\n    canvas,\n    x,\n    y,\n    channel\n  ) {\n    if ( maxDistance === void 0 ) maxDistance = Math.max(viewBox[2] - viewBox[0], viewBox[3] - viewBox[1]) / 2;\n    if ( sdfExponent === void 0 ) sdfExponent = 1;\n    if ( x === void 0 ) x = 0;\n    if ( y === void 0 ) y = 0;\n    if ( channel === void 0 ) channel = 0;\n\n    try {\n      return generateIntoCanvas$1.apply(webgl, arguments)\n    } catch(e) {\n      console.info('WebGL SDF generation failed, falling back to JS', e);\n      return generateIntoCanvas$2.apply(javascript, arguments)\n    }\n  }\n\n  exports.forEachPathCommand = forEachPathCommand;\n  exports.generate = generate;\n  exports.generateIntoCanvas = generateIntoCanvas;\n  exports.javascript = javascript;\n  exports.pathToLineSegments = pathToLineSegments;\n  exports.webgl = webgl;\n  exports.webglUtils = webglUtils;\n\n  Object.defineProperty(exports, '__esModule', { value: true });\n\n  return exports;\n\n}({}));\nreturn exports\n}\n\nexport { SDFGenerator as default };\n","function bidiFactory() {\nvar bidi = (function (exports) {\n\n  // Bidi character types data, auto generated\n  var DATA = {\n    \"R\": \"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73\",\n    \"EN\": \"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9\",\n    \"ES\": \"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2\",\n    \"ET\": \"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj\",\n    \"AN\": \"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u\",\n    \"CS\": \"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b\",\n    \"B\": \"a,3,f+2,2v,690\",\n    \"S\": \"9,2,k\",\n    \"WS\": \"c,k,4f4,1vk+a,u,1j,335\",\n    \"ON\": \"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i\",\n    \"BN\": \"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1\",\n    \"NSM\": \"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n\",\n    \"AL\": \"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d\",\n    \"LRO\": \"6ct\",\n    \"RLO\": \"6cu\",\n    \"LRE\": \"6cq\",\n    \"RLE\": \"6cr\",\n    \"PDF\": \"6cs\",\n    \"LRI\": \"6ee\",\n    \"RLI\": \"6ef\",\n    \"FSI\": \"6eg\",\n    \"PDI\": \"6eh\"\n  };\n\n  var TYPES = {};\n  var TYPES_TO_NAMES = {};\n  TYPES.L = 1; //L is the default\n  TYPES_TO_NAMES[1] = 'L';\n  Object.keys(DATA).forEach(function (type, i) {\n    TYPES[type] = 1 << (i + 1);\n    TYPES_TO_NAMES[TYPES[type]] = type;\n  });\n  Object.freeze(TYPES);\n\n  var ISOLATE_INIT_TYPES = TYPES.LRI | TYPES.RLI | TYPES.FSI;\n  var STRONG_TYPES = TYPES.L | TYPES.R | TYPES.AL;\n  var NEUTRAL_ISOLATE_TYPES = TYPES.B | TYPES.S | TYPES.WS | TYPES.ON | TYPES.FSI | TYPES.LRI | TYPES.RLI | TYPES.PDI;\n  var BN_LIKE_TYPES = TYPES.BN | TYPES.RLE | TYPES.LRE | TYPES.RLO | TYPES.LRO | TYPES.PDF;\n  var TRAILING_TYPES = TYPES.S | TYPES.WS | TYPES.B | ISOLATE_INIT_TYPES | TYPES.PDI | BN_LIKE_TYPES;\n\n  var map = null;\n\n  function parseData () {\n    if (!map) {\n      //const start = performance.now()\n      map = new Map();\n      var loop = function ( type ) {\n        if (DATA.hasOwnProperty(type)) {\n          var lastCode = 0;\n          DATA[type].split(',').forEach(function (range) {\n            var ref = range.split('+');\n            var skip = ref[0];\n            var step = ref[1];\n            skip = parseInt(skip, 36);\n            step = step ? parseInt(step, 36) : 0;\n            map.set(lastCode += skip, TYPES[type]);\n            for (var i = 0; i < step; i++) {\n              map.set(++lastCode, TYPES[type]);\n            }\n          });\n        }\n      };\n\n      for (var type in DATA) loop( type );\n      //console.log(`char types parsed in ${performance.now() - start}ms`)\n    }\n  }\n\n  /**\n   * @param {string} char\n   * @return {number}\n   */\n  function getBidiCharType (char) {\n    parseData();\n    return map.get(char.codePointAt(0)) || TYPES.L\n  }\n\n  function getBidiCharTypeName(char) {\n    return TYPES_TO_NAMES[getBidiCharType(char)]\n  }\n\n  // Bidi bracket pairs data, auto generated\n  var data$1 = {\n    \"pairs\": \"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1\",\n    \"canonical\": \"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye\"\n  };\n\n  /**\n   * Parses an string that holds encoded codepoint mappings, e.g. for bracket pairs or\n   * mirroring characters, as encoded by scripts/generateBidiData.js. Returns an object\n   * holding the `map`, and optionally a `reverseMap` if `includeReverse:true`.\n   * @param {string} encodedString\n   * @param {boolean} includeReverse - true if you want reverseMap in the output\n   * @return {{map: Map<number, number>, reverseMap?: Map<number, number>}}\n   */\n  function parseCharacterMap (encodedString, includeReverse) {\n    var radix = 36;\n    var lastCode = 0;\n    var map = new Map();\n    var reverseMap = includeReverse && new Map();\n    var prevPair;\n    encodedString.split(',').forEach(function visit(entry) {\n      if (entry.indexOf('+') !== -1) {\n        for (var i = +entry; i--;) {\n          visit(prevPair);\n        }\n      } else {\n        prevPair = entry;\n        var ref = entry.split('>');\n        var a = ref[0];\n        var b = ref[1];\n        a = String.fromCodePoint(lastCode += parseInt(a, radix));\n        b = String.fromCodePoint(lastCode += parseInt(b, radix));\n        map.set(a, b);\n        includeReverse && reverseMap.set(b, a);\n      }\n    });\n    return { map: map, reverseMap: reverseMap }\n  }\n\n  var openToClose, closeToOpen, canonical;\n\n  function parse$1 () {\n    if (!openToClose) {\n      //const start = performance.now()\n      var ref = parseCharacterMap(data$1.pairs, true);\n      var map = ref.map;\n      var reverseMap = ref.reverseMap;\n      openToClose = map;\n      closeToOpen = reverseMap;\n      canonical = parseCharacterMap(data$1.canonical, false).map;\n      //console.log(`brackets parsed in ${performance.now() - start}ms`)\n    }\n  }\n\n  function openingToClosingBracket (char) {\n    parse$1();\n    return openToClose.get(char) || null\n  }\n\n  function closingToOpeningBracket (char) {\n    parse$1();\n    return closeToOpen.get(char) || null\n  }\n\n  function getCanonicalBracket (char) {\n    parse$1();\n    return canonical.get(char) || null\n  }\n\n  // Local type aliases\n  var TYPE_L = TYPES.L;\n  var TYPE_R = TYPES.R;\n  var TYPE_EN = TYPES.EN;\n  var TYPE_ES = TYPES.ES;\n  var TYPE_ET = TYPES.ET;\n  var TYPE_AN = TYPES.AN;\n  var TYPE_CS = TYPES.CS;\n  var TYPE_B = TYPES.B;\n  var TYPE_S = TYPES.S;\n  var TYPE_ON = TYPES.ON;\n  var TYPE_BN = TYPES.BN;\n  var TYPE_NSM = TYPES.NSM;\n  var TYPE_AL = TYPES.AL;\n  var TYPE_LRO = TYPES.LRO;\n  var TYPE_RLO = TYPES.RLO;\n  var TYPE_LRE = TYPES.LRE;\n  var TYPE_RLE = TYPES.RLE;\n  var TYPE_PDF = TYPES.PDF;\n  var TYPE_LRI = TYPES.LRI;\n  var TYPE_RLI = TYPES.RLI;\n  var TYPE_FSI = TYPES.FSI;\n  var TYPE_PDI = TYPES.PDI;\n\n  /**\n   * @typedef {object} GetEmbeddingLevelsResult\n   * @property {{start, end, level}[]} paragraphs\n   * @property {Uint8Array} levels\n   */\n\n  /**\n   * This function applies the Bidirectional Algorithm to a string, returning the resolved embedding levels\n   * in a single Uint8Array plus a list of objects holding each paragraph's start and end indices and resolved\n   * base embedding level.\n   *\n   * @param {string} string - The input string\n   * @param {\"ltr\"|\"rtl\"|\"auto\"} [baseDirection] - Use \"ltr\" or \"rtl\" to force a base paragraph direction,\n   *        otherwise a direction will be chosen automatically from each paragraph's contents.\n   * @return {GetEmbeddingLevelsResult}\n   */\n  function getEmbeddingLevels (string, baseDirection) {\n    var MAX_DEPTH = 125;\n\n    // Start by mapping all characters to their unicode type, as a bitmask integer\n    var charTypes = new Uint32Array(string.length);\n    for (var i = 0; i < string.length; i++) {\n      charTypes[i] = getBidiCharType(string[i]);\n    }\n\n    var charTypeCounts = new Map(); //will be cleared at start of each paragraph\n    function changeCharType(i, type) {\n      var oldType = charTypes[i];\n      charTypes[i] = type;\n      charTypeCounts.set(oldType, charTypeCounts.get(oldType) - 1);\n      if (oldType & NEUTRAL_ISOLATE_TYPES) {\n        charTypeCounts.set(NEUTRAL_ISOLATE_TYPES, charTypeCounts.get(NEUTRAL_ISOLATE_TYPES) - 1);\n      }\n      charTypeCounts.set(type, (charTypeCounts.get(type) || 0) + 1);\n      if (type & NEUTRAL_ISOLATE_TYPES) {\n        charTypeCounts.set(NEUTRAL_ISOLATE_TYPES, (charTypeCounts.get(NEUTRAL_ISOLATE_TYPES) || 0) + 1);\n      }\n    }\n\n    var embedLevels = new Uint8Array(string.length);\n    var isolationPairs = new Map(); //init->pdi and pdi->init\n\n    // === 3.3.1 The Paragraph Level ===\n    // 3.3.1 P1: Split the text into paragraphs\n    var paragraphs = []; // [{start, end, level}, ...]\n    var paragraph = null;\n    for (var i$1 = 0; i$1 < string.length; i$1++) {\n      if (!paragraph) {\n        paragraphs.push(paragraph = {\n          start: i$1,\n          end: string.length - 1,\n          // 3.3.1 P2-P3: Determine the paragraph level\n          level: baseDirection === 'rtl' ? 1 : baseDirection === 'ltr' ? 0 : determineAutoEmbedLevel(i$1, false)\n        });\n      }\n      if (charTypes[i$1] & TYPE_B) {\n        paragraph.end = i$1;\n        paragraph = null;\n      }\n    }\n\n    var FORMATTING_TYPES = TYPE_RLE | TYPE_LRE | TYPE_RLO | TYPE_LRO | ISOLATE_INIT_TYPES | TYPE_PDI | TYPE_PDF | TYPE_B;\n    var nextEven = function (n) { return n + ((n & 1) ? 1 : 2); };\n    var nextOdd = function (n) { return n + ((n & 1) ? 2 : 1); };\n\n    // Everything from here on will operate per paragraph.\n    for (var paraIdx = 0; paraIdx < paragraphs.length; paraIdx++) {\n      paragraph = paragraphs[paraIdx];\n      var statusStack = [{\n        _level: paragraph.level,\n        _override: 0, //0=neutral, 1=L, 2=R\n        _isolate: 0 //bool\n      }];\n      var stackTop = (void 0);\n      var overflowIsolateCount = 0;\n      var overflowEmbeddingCount = 0;\n      var validIsolateCount = 0;\n      charTypeCounts.clear();\n\n      // === 3.3.2 Explicit Levels and Directions ===\n      for (var i$2 = paragraph.start; i$2 <= paragraph.end; i$2++) {\n        var charType = charTypes[i$2];\n        stackTop = statusStack[statusStack.length - 1];\n\n        // Set initial counts\n        charTypeCounts.set(charType, (charTypeCounts.get(charType) || 0) + 1);\n        if (charType & NEUTRAL_ISOLATE_TYPES) {\n          charTypeCounts.set(NEUTRAL_ISOLATE_TYPES, (charTypeCounts.get(NEUTRAL_ISOLATE_TYPES) || 0) + 1);\n        }\n\n        // Explicit Embeddings: 3.3.2 X2 - X3\n        if (charType & FORMATTING_TYPES) { //prefilter all formatters\n          if (charType & (TYPE_RLE | TYPE_LRE)) {\n            embedLevels[i$2] = stackTop._level; // 5.2\n            var level = (charType === TYPE_RLE ? nextOdd : nextEven)(stackTop._level);\n            if (level <= MAX_DEPTH && !overflowIsolateCount && !overflowEmbeddingCount) {\n              statusStack.push({\n                _level: level,\n                _override: 0,\n                _isolate: 0\n              });\n            } else if (!overflowIsolateCount) {\n              overflowEmbeddingCount++;\n            }\n          }\n\n          // Explicit Overrides: 3.3.2 X4 - X5\n          else if (charType & (TYPE_RLO | TYPE_LRO)) {\n            embedLevels[i$2] = stackTop._level; // 5.2\n            var level$1 = (charType === TYPE_RLO ? nextOdd : nextEven)(stackTop._level);\n            if (level$1 <= MAX_DEPTH && !overflowIsolateCount && !overflowEmbeddingCount) {\n              statusStack.push({\n                _level: level$1,\n                _override: (charType & TYPE_RLO) ? TYPE_R : TYPE_L,\n                _isolate: 0\n              });\n            } else if (!overflowIsolateCount) {\n              overflowEmbeddingCount++;\n            }\n          }\n\n          // Isolates: 3.3.2 X5a - X5c\n          else if (charType & ISOLATE_INIT_TYPES) {\n            // X5c - FSI becomes either RLI or LRI\n            if (charType & TYPE_FSI) {\n              charType = determineAutoEmbedLevel(i$2 + 1, true) === 1 ? TYPE_RLI : TYPE_LRI;\n            }\n\n            embedLevels[i$2] = stackTop._level;\n            if (stackTop._override) {\n              changeCharType(i$2, stackTop._override);\n            }\n            var level$2 = (charType === TYPE_RLI ? nextOdd : nextEven)(stackTop._level);\n            if (level$2 <= MAX_DEPTH && overflowIsolateCount === 0 && overflowEmbeddingCount === 0) {\n              validIsolateCount++;\n              statusStack.push({\n                _level: level$2,\n                _override: 0,\n                _isolate: 1,\n                _isolInitIndex: i$2\n              });\n            } else {\n              overflowIsolateCount++;\n            }\n          }\n\n          // Terminating Isolates: 3.3.2 X6a\n          else if (charType & TYPE_PDI) {\n            if (overflowIsolateCount > 0) {\n              overflowIsolateCount--;\n            } else if (validIsolateCount > 0) {\n              overflowEmbeddingCount = 0;\n              while (!statusStack[statusStack.length - 1]._isolate) {\n                statusStack.pop();\n              }\n              // Add to isolation pairs bidirectional mapping:\n              var isolInitIndex = statusStack[statusStack.length - 1]._isolInitIndex;\n              if (isolInitIndex != null) {\n                isolationPairs.set(isolInitIndex, i$2);\n                isolationPairs.set(i$2, isolInitIndex);\n              }\n              statusStack.pop();\n              validIsolateCount--;\n            }\n            stackTop = statusStack[statusStack.length - 1];\n            embedLevels[i$2] = stackTop._level;\n            if (stackTop._override) {\n              changeCharType(i$2, stackTop._override);\n            }\n          }\n\n\n          // Terminating Embeddings and Overrides: 3.3.2 X7\n          else if (charType & TYPE_PDF) {\n            if (overflowIsolateCount === 0) {\n              if (overflowEmbeddingCount > 0) {\n                overflowEmbeddingCount--;\n              } else if (!stackTop._isolate && statusStack.length > 1) {\n                statusStack.pop();\n                stackTop = statusStack[statusStack.length - 1];\n              }\n            }\n            embedLevels[i$2] = stackTop._level; // 5.2\n          }\n\n          // End of Paragraph: 3.3.2 X8\n          else if (charType & TYPE_B) {\n            embedLevels[i$2] = paragraph.level;\n          }\n        }\n\n        // Non-formatting characters: 3.3.2 X6\n        else {\n          embedLevels[i$2] = stackTop._level;\n          // NOTE: This exclusion of BN seems to go against what section 5.2 says, but is required for test passage\n          if (stackTop._override && charType !== TYPE_BN) {\n            changeCharType(i$2, stackTop._override);\n          }\n        }\n      }\n\n      // === 3.3.3 Preparations for Implicit Processing ===\n\n      // Remove all RLE, LRE, RLO, LRO, PDF, and BN characters: 3.3.3 X9\n      // Note: Due to section 5.2, we won't remove them, but we'll use the BN_LIKE_TYPES bitset to\n      // easily ignore them all from here on out.\n\n      // 3.3.3 X10\n      // Compute the set of isolating run sequences as specified by BD13\n      var levelRuns = [];\n      var currentRun = null;\n      for (var i$3 = paragraph.start; i$3 <= paragraph.end; i$3++) {\n        var charType$1 = charTypes[i$3];\n        if (!(charType$1 & BN_LIKE_TYPES)) {\n          var lvl = embedLevels[i$3];\n          var isIsolInit = charType$1 & ISOLATE_INIT_TYPES;\n          var isPDI = charType$1 === TYPE_PDI;\n          if (currentRun && lvl === currentRun._level) {\n            currentRun._end = i$3;\n            currentRun._endsWithIsolInit = isIsolInit;\n          } else {\n            levelRuns.push(currentRun = {\n              _start: i$3,\n              _end: i$3,\n              _level: lvl,\n              _startsWithPDI: isPDI,\n              _endsWithIsolInit: isIsolInit\n            });\n          }\n        }\n      }\n      var isolatingRunSeqs = []; // [{seqIndices: [], sosType: L|R, eosType: L|R}]\n      for (var runIdx = 0; runIdx < levelRuns.length; runIdx++) {\n        var run = levelRuns[runIdx];\n        if (!run._startsWithPDI || (run._startsWithPDI && !isolationPairs.has(run._start))) {\n          var seqRuns = [currentRun = run];\n          for (var pdiIndex = (void 0); currentRun && currentRun._endsWithIsolInit && (pdiIndex = isolationPairs.get(currentRun._end)) != null;) {\n            for (var i$4 = runIdx + 1; i$4 < levelRuns.length; i$4++) {\n              if (levelRuns[i$4]._start === pdiIndex) {\n                seqRuns.push(currentRun = levelRuns[i$4]);\n                break\n              }\n            }\n          }\n          // build flat list of indices across all runs:\n          var seqIndices = [];\n          for (var i$5 = 0; i$5 < seqRuns.length; i$5++) {\n            var run$1 = seqRuns[i$5];\n            for (var j = run$1._start; j <= run$1._end; j++) {\n              seqIndices.push(j);\n            }\n          }\n          // determine the sos/eos types:\n          var firstLevel = embedLevels[seqIndices[0]];\n          var prevLevel = paragraph.level;\n          for (var i$6 = seqIndices[0] - 1; i$6 >= 0; i$6--) {\n            if (!(charTypes[i$6] & BN_LIKE_TYPES)) { //5.2\n              prevLevel = embedLevels[i$6];\n              break\n            }\n          }\n          var lastIndex = seqIndices[seqIndices.length - 1];\n          var lastLevel = embedLevels[lastIndex];\n          var nextLevel = paragraph.level;\n          if (!(charTypes[lastIndex] & ISOLATE_INIT_TYPES)) {\n            for (var i$7 = lastIndex + 1; i$7 <= paragraph.end; i$7++) {\n              if (!(charTypes[i$7] & BN_LIKE_TYPES)) { //5.2\n                nextLevel = embedLevels[i$7];\n                break\n              }\n            }\n          }\n          isolatingRunSeqs.push({\n            _seqIndices: seqIndices,\n            _sosType: Math.max(prevLevel, firstLevel) % 2 ? TYPE_R : TYPE_L,\n            _eosType: Math.max(nextLevel, lastLevel) % 2 ? TYPE_R : TYPE_L\n          });\n        }\n      }\n\n      // The next steps are done per isolating run sequence\n      for (var seqIdx = 0; seqIdx < isolatingRunSeqs.length; seqIdx++) {\n        var ref = isolatingRunSeqs[seqIdx];\n        var seqIndices$1 = ref._seqIndices;\n        var sosType = ref._sosType;\n        var eosType = ref._eosType;\n        /**\n         * All the level runs in an isolating run sequence have the same embedding level.\n         * \n         * DO NOT change any `embedLevels[i]` within the current scope.\n         */\n        var embedDirection = ((embedLevels[seqIndices$1[0]]) & 1) ? TYPE_R : TYPE_L;\n\n        // === 3.3.4 Resolving Weak Types ===\n\n        // W1 + 5.2. Search backward from each NSM to the first character in the isolating run sequence whose\n        // bidirectional type is not BN, and set the NSM to ON if it is an isolate initiator or PDI, and to its\n        // type otherwise. If the NSM is the first non-BN character, change the NSM to the type of sos.\n        if (charTypeCounts.get(TYPE_NSM)) {\n          for (var si = 0; si < seqIndices$1.length; si++) {\n            var i$8 = seqIndices$1[si];\n            if (charTypes[i$8] & TYPE_NSM) {\n              var prevType = sosType;\n              for (var sj = si - 1; sj >= 0; sj--) {\n                if (!(charTypes[seqIndices$1[sj]] & BN_LIKE_TYPES)) { //5.2 scan back to first non-BN\n                  prevType = charTypes[seqIndices$1[sj]];\n                  break\n                }\n              }\n              changeCharType(i$8, (prevType & (ISOLATE_INIT_TYPES | TYPE_PDI)) ? TYPE_ON : prevType);\n            }\n          }\n        }\n\n        // W2. Search backward from each instance of a European number until the first strong type (R, L, AL, or sos)\n        // is found. If an AL is found, change the type of the European number to Arabic number.\n        if (charTypeCounts.get(TYPE_EN)) {\n          for (var si$1 = 0; si$1 < seqIndices$1.length; si$1++) {\n            var i$9 = seqIndices$1[si$1];\n            if (charTypes[i$9] & TYPE_EN) {\n              for (var sj$1 = si$1 - 1; sj$1 >= -1; sj$1--) {\n                var prevCharType = sj$1 === -1 ? sosType : charTypes[seqIndices$1[sj$1]];\n                if (prevCharType & STRONG_TYPES) {\n                  if (prevCharType === TYPE_AL) {\n                    changeCharType(i$9, TYPE_AN);\n                  }\n                  break\n                }\n              }\n            }\n          }\n        }\n\n        // W3. Change all ALs to R\n        if (charTypeCounts.get(TYPE_AL)) {\n          for (var si$2 = 0; si$2 < seqIndices$1.length; si$2++) {\n            var i$10 = seqIndices$1[si$2];\n            if (charTypes[i$10] & TYPE_AL) {\n              changeCharType(i$10, TYPE_R);\n            }\n          }\n        }\n\n        // W4. A single European separator between two European numbers changes to a European number. A single common\n        // separator between two numbers of the same type changes to that type.\n        if (charTypeCounts.get(TYPE_ES) || charTypeCounts.get(TYPE_CS)) {\n          for (var si$3 = 1; si$3 < seqIndices$1.length - 1; si$3++) {\n            var i$11 = seqIndices$1[si$3];\n            if (charTypes[i$11] & (TYPE_ES | TYPE_CS)) {\n              var prevType$1 = 0, nextType = 0;\n              for (var sj$2 = si$3 - 1; sj$2 >= 0; sj$2--) {\n                prevType$1 = charTypes[seqIndices$1[sj$2]];\n                if (!(prevType$1 & BN_LIKE_TYPES)) { //5.2\n                  break\n                }\n              }\n              for (var sj$3 = si$3 + 1; sj$3 < seqIndices$1.length; sj$3++) {\n                nextType = charTypes[seqIndices$1[sj$3]];\n                if (!(nextType & BN_LIKE_TYPES)) { //5.2\n                  break\n                }\n              }\n              if (prevType$1 === nextType && (charTypes[i$11] === TYPE_ES ? prevType$1 === TYPE_EN : (prevType$1 & (TYPE_EN | TYPE_AN)))) {\n                changeCharType(i$11, prevType$1);\n              }\n            }\n          }\n        }\n\n        // W5. A sequence of European terminators adjacent to European numbers changes to all European numbers.\n        if (charTypeCounts.get(TYPE_EN)) {\n          for (var si$4 = 0; si$4 < seqIndices$1.length; si$4++) {\n            var i$12 = seqIndices$1[si$4];\n            if (charTypes[i$12] & TYPE_EN) {\n              for (var sj$4 = si$4 - 1; sj$4 >= 0 && (charTypes[seqIndices$1[sj$4]] & (TYPE_ET | BN_LIKE_TYPES)); sj$4--) {\n                changeCharType(seqIndices$1[sj$4], TYPE_EN);\n              }\n              for (si$4++; si$4 < seqIndices$1.length && (charTypes[seqIndices$1[si$4]] & (TYPE_ET | BN_LIKE_TYPES | TYPE_EN)); si$4++) {\n                if (charTypes[seqIndices$1[si$4]] !== TYPE_EN) {\n                  changeCharType(seqIndices$1[si$4], TYPE_EN);\n                }\n              }\n            }\n          }\n        }\n\n        // W6. Otherwise, separators and terminators change to Other Neutral.\n        if (charTypeCounts.get(TYPE_ET) || charTypeCounts.get(TYPE_ES) || charTypeCounts.get(TYPE_CS)) {\n          for (var si$5 = 0; si$5 < seqIndices$1.length; si$5++) {\n            var i$13 = seqIndices$1[si$5];\n            if (charTypes[i$13] & (TYPE_ET | TYPE_ES | TYPE_CS)) {\n              changeCharType(i$13, TYPE_ON);\n              // 5.2 transform adjacent BNs too:\n              for (var sj$5 = si$5 - 1; sj$5 >= 0 && (charTypes[seqIndices$1[sj$5]] & BN_LIKE_TYPES); sj$5--) {\n                changeCharType(seqIndices$1[sj$5], TYPE_ON);\n              }\n              for (var sj$6 = si$5 + 1; sj$6 < seqIndices$1.length && (charTypes[seqIndices$1[sj$6]] & BN_LIKE_TYPES); sj$6++) {\n                changeCharType(seqIndices$1[sj$6], TYPE_ON);\n              }\n            }\n          }\n        }\n\n        // W7. Search backward from each instance of a European number until the first strong type (R, L, or sos)\n        // is found. If an L is found, then change the type of the European number to L.\n        // NOTE: implemented in single forward pass for efficiency\n        if (charTypeCounts.get(TYPE_EN)) {\n          for (var si$6 = 0, prevStrongType = sosType; si$6 < seqIndices$1.length; si$6++) {\n            var i$14 = seqIndices$1[si$6];\n            var type = charTypes[i$14];\n            if (type & TYPE_EN) {\n              if (prevStrongType === TYPE_L) {\n                changeCharType(i$14, TYPE_L);\n              }\n            } else if (type & STRONG_TYPES) {\n              prevStrongType = type;\n            }\n          }\n        }\n\n        // === 3.3.5 Resolving Neutral and Isolate Formatting Types ===\n\n        if (charTypeCounts.get(NEUTRAL_ISOLATE_TYPES)) {\n          // N0. Process bracket pairs in an isolating run sequence sequentially in the logical order of the text\n          // positions of the opening paired brackets using the logic given below. Within this scope, bidirectional\n          // types EN and AN are treated as R.\n          var R_TYPES_FOR_N_STEPS = (TYPE_R | TYPE_EN | TYPE_AN);\n          var STRONG_TYPES_FOR_N_STEPS = R_TYPES_FOR_N_STEPS | TYPE_L;\n\n          // * Identify the bracket pairs in the current isolating run sequence according to BD16.\n          var bracketPairs = [];\n          {\n            var openerStack = [];\n            for (var si$7 = 0; si$7 < seqIndices$1.length; si$7++) {\n              // NOTE: for any potential bracket character we also test that it still carries a NI\n              // type, as that may have been changed earlier. This doesn't seem to be explicitly\n              // called out in the spec, but is required for passage of certain tests.\n              if (charTypes[seqIndices$1[si$7]] & NEUTRAL_ISOLATE_TYPES) {\n                var char = string[seqIndices$1[si$7]];\n                var oppositeBracket = (void 0);\n                // Opening bracket\n                if (openingToClosingBracket(char) !== null) {\n                  if (openerStack.length < 63) {\n                    openerStack.push({ char: char, seqIndex: si$7 });\n                  } else {\n                    break\n                  }\n                }\n                // Closing bracket\n                else if ((oppositeBracket = closingToOpeningBracket(char)) !== null) {\n                  for (var stackIdx = openerStack.length - 1; stackIdx >= 0; stackIdx--) {\n                    var stackChar = openerStack[stackIdx].char;\n                    if (stackChar === oppositeBracket ||\n                      stackChar === closingToOpeningBracket(getCanonicalBracket(char)) ||\n                      openingToClosingBracket(getCanonicalBracket(stackChar)) === char\n                    ) {\n                      bracketPairs.push([openerStack[stackIdx].seqIndex, si$7]);\n                      openerStack.length = stackIdx; //pop the matching bracket and all following\n                      break\n                    }\n                  }\n                }\n              }\n            }\n            bracketPairs.sort(function (a, b) { return a[0] - b[0]; });\n          }\n          // * For each bracket-pair element in the list of pairs of text positions\n          for (var pairIdx = 0; pairIdx < bracketPairs.length; pairIdx++) {\n            var ref$1 = bracketPairs[pairIdx];\n            var openSeqIdx = ref$1[0];\n            var closeSeqIdx = ref$1[1];\n            // a. Inspect the bidirectional types of the characters enclosed within the bracket pair.\n            // b. If any strong type (either L or R) matching the embedding direction is found, set the type for both\n            // brackets in the pair to match the embedding direction.\n            var foundStrongType = false;\n            var useStrongType = 0;\n            for (var si$8 = openSeqIdx + 1; si$8 < closeSeqIdx; si$8++) {\n              var i$15 = seqIndices$1[si$8];\n              if (charTypes[i$15] & STRONG_TYPES_FOR_N_STEPS) {\n                foundStrongType = true;\n                var lr = (charTypes[i$15] & R_TYPES_FOR_N_STEPS) ? TYPE_R : TYPE_L;\n                if (lr === embedDirection) {\n                  useStrongType = lr;\n                  break\n                }\n              }\n            }\n            // c. Otherwise, if there is a strong type it must be opposite the embedding direction. Therefore, test\n            // for an established context with a preceding strong type by checking backwards before the opening paired\n            // bracket until the first strong type (L, R, or sos) is found.\n            //    1. If the preceding strong type is also opposite the embedding direction, context is established, so\n            //    set the type for both brackets in the pair to that direction.\n            //    2. Otherwise set the type for both brackets in the pair to the embedding direction.\n            if (foundStrongType && !useStrongType) {\n              useStrongType = sosType;\n              for (var si$9 = openSeqIdx - 1; si$9 >= 0; si$9--) {\n                var i$16 = seqIndices$1[si$9];\n                if (charTypes[i$16] & STRONG_TYPES_FOR_N_STEPS) {\n                  var lr$1 = (charTypes[i$16] & R_TYPES_FOR_N_STEPS) ? TYPE_R : TYPE_L;\n                  if (lr$1 !== embedDirection) {\n                    useStrongType = lr$1;\n                  } else {\n                    useStrongType = embedDirection;\n                  }\n                  break\n                }\n              }\n            }\n            if (useStrongType) {\n              charTypes[seqIndices$1[openSeqIdx]] = charTypes[seqIndices$1[closeSeqIdx]] = useStrongType;\n              // * Any number of characters that had original bidirectional character type NSM prior to the application\n              // of W1 that immediately follow a paired bracket which changed to L or R under N0 should change to match\n              // the type of their preceding bracket.\n              if (useStrongType !== embedDirection) {\n                for (var si$10 = openSeqIdx + 1; si$10 < seqIndices$1.length; si$10++) {\n                  if (!(charTypes[seqIndices$1[si$10]] & BN_LIKE_TYPES)) {\n                    if (getBidiCharType(string[seqIndices$1[si$10]]) & TYPE_NSM) {\n                      charTypes[seqIndices$1[si$10]] = useStrongType;\n                    }\n                    break\n                  }\n                }\n              }\n              if (useStrongType !== embedDirection) {\n                for (var si$11 = closeSeqIdx + 1; si$11 < seqIndices$1.length; si$11++) {\n                  if (!(charTypes[seqIndices$1[si$11]] & BN_LIKE_TYPES)) {\n                    if (getBidiCharType(string[seqIndices$1[si$11]]) & TYPE_NSM) {\n                      charTypes[seqIndices$1[si$11]] = useStrongType;\n                    }\n                    break\n                  }\n                }\n              }\n            }\n          }\n\n          // N1. A sequence of NIs takes the direction of the surrounding strong text if the text on both sides has the\n          // same direction.\n          // N2. Any remaining NIs take the embedding direction.\n          for (var si$12 = 0; si$12 < seqIndices$1.length; si$12++) {\n            if (charTypes[seqIndices$1[si$12]] & NEUTRAL_ISOLATE_TYPES) {\n              var niRunStart = si$12, niRunEnd = si$12;\n              var prevType$2 = sosType; //si === 0 ? sosType : (charTypes[seqIndices[si - 1]] & R_TYPES_FOR_N_STEPS) ? TYPE_R : TYPE_L\n              for (var si2 = si$12 - 1; si2 >= 0; si2--) {\n                if (charTypes[seqIndices$1[si2]] & BN_LIKE_TYPES) {\n                  niRunStart = si2; //5.2 treat BNs adjacent to NIs as NIs\n                } else {\n                  prevType$2 = (charTypes[seqIndices$1[si2]] & R_TYPES_FOR_N_STEPS) ? TYPE_R : TYPE_L;\n                  break\n                }\n              }\n              var nextType$1 = eosType;\n              for (var si2$1 = si$12 + 1; si2$1 < seqIndices$1.length; si2$1++) {\n                if (charTypes[seqIndices$1[si2$1]] & (NEUTRAL_ISOLATE_TYPES | BN_LIKE_TYPES)) {\n                  niRunEnd = si2$1;\n                } else {\n                  nextType$1 = (charTypes[seqIndices$1[si2$1]] & R_TYPES_FOR_N_STEPS) ? TYPE_R : TYPE_L;\n                  break\n                }\n              }\n              for (var sj$7 = niRunStart; sj$7 <= niRunEnd; sj$7++) {\n                charTypes[seqIndices$1[sj$7]] = prevType$2 === nextType$1 ? prevType$2 : embedDirection;\n              }\n              si$12 = niRunEnd;\n            }\n          }\n        }\n      }\n\n      // === 3.3.6 Resolving Implicit Levels ===\n\n      for (var i$17 = paragraph.start; i$17 <= paragraph.end; i$17++) {\n        var level$3 = embedLevels[i$17];\n        var type$1 = charTypes[i$17];\n        // I2. For all characters with an odd (right-to-left) embedding level, those of type L, EN or AN go up one level.\n        if (level$3 & 1) {\n          if (type$1 & (TYPE_L | TYPE_EN | TYPE_AN)) {\n            embedLevels[i$17]++;\n          }\n        }\n          // I1. For all characters with an even (left-to-right) embedding level, those of type R go up one level\n        // and those of type AN or EN go up two levels.\n        else {\n          if (type$1 & TYPE_R) {\n            embedLevels[i$17]++;\n          } else if (type$1 & (TYPE_AN | TYPE_EN)) {\n            embedLevels[i$17] += 2;\n          }\n        }\n\n        // 5.2: Resolve any LRE, RLE, LRO, RLO, PDF, or BN to the level of the preceding character if there is one,\n        // and otherwise to the base level.\n        if (type$1 & BN_LIKE_TYPES) {\n          embedLevels[i$17] = i$17 === 0 ? paragraph.level : embedLevels[i$17 - 1];\n        }\n\n        // 3.4 L1.1-4: Reset the embedding level of segment/paragraph separators, and any sequence of whitespace or\n        // isolate formatting characters preceding them or the end of the paragraph, to the paragraph level.\n        // NOTE: this will also need to be applied to each individual line ending after line wrapping occurs.\n        if (i$17 === paragraph.end || getBidiCharType(string[i$17]) & (TYPE_S | TYPE_B)) {\n          for (var j$1 = i$17; j$1 >= 0 && (getBidiCharType(string[j$1]) & TRAILING_TYPES); j$1--) {\n            embedLevels[j$1] = paragraph.level;\n          }\n        }\n      }\n    }\n\n    // DONE! The resolved levels can then be used, after line wrapping, to flip runs of characters\n    // according to section 3.4 Reordering Resolved Levels\n    return {\n      levels: embedLevels,\n      paragraphs: paragraphs\n    }\n\n    function determineAutoEmbedLevel (start, isFSI) {\n      // 3.3.1 P2 - P3\n      for (var i = start; i < string.length; i++) {\n        var charType = charTypes[i];\n        if (charType & (TYPE_R | TYPE_AL)) {\n          return 1\n        }\n        if ((charType & (TYPE_B | TYPE_L)) || (isFSI && charType === TYPE_PDI)) {\n          return 0\n        }\n        if (charType & ISOLATE_INIT_TYPES) {\n          var pdi = indexOfMatchingPDI(i);\n          i = pdi === -1 ? string.length : pdi;\n        }\n      }\n      return 0\n    }\n\n    function indexOfMatchingPDI (isolateStart) {\n      // 3.1.2 BD9\n      var isolationLevel = 1;\n      for (var i = isolateStart + 1; i < string.length; i++) {\n        var charType = charTypes[i];\n        if (charType & TYPE_B) {\n          break\n        }\n        if (charType & TYPE_PDI) {\n          if (--isolationLevel === 0) {\n            return i\n          }\n        } else if (charType & ISOLATE_INIT_TYPES) {\n          isolationLevel++;\n        }\n      }\n      return -1\n    }\n  }\n\n  // Bidi mirrored chars data, auto generated\n  var data = \"14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1\";\n\n  var mirrorMap;\n\n  function parse () {\n    if (!mirrorMap) {\n      //const start = performance.now()\n      var ref = parseCharacterMap(data, true);\n      var map = ref.map;\n      var reverseMap = ref.reverseMap;\n      // Combine both maps into one\n      reverseMap.forEach(function (value, key) {\n        map.set(key, value);\n      });\n      mirrorMap = map;\n      //console.log(`mirrored chars parsed in ${performance.now() - start}ms`)\n    }\n  }\n\n  function getMirroredCharacter (char) {\n    parse();\n    return mirrorMap.get(char) || null\n  }\n\n  /**\n   * Given a string and its resolved embedding levels, build a map of indices to replacement chars\n   * for any characters in right-to-left segments that have defined mirrored characters.\n   * @param string\n   * @param embeddingLevels\n   * @param [start]\n   * @param [end]\n   * @return {Map<number, string>}\n   */\n  function getMirroredCharactersMap(string, embeddingLevels, start, end) {\n    var strLen = string.length;\n    start = Math.max(0, start == null ? 0 : +start);\n    end = Math.min(strLen - 1, end == null ? strLen - 1 : +end);\n\n    var map = new Map();\n    for (var i = start; i <= end; i++) {\n      if (embeddingLevels[i] & 1) { //only odd (rtl) levels\n        var mirror = getMirroredCharacter(string[i]);\n        if (mirror !== null) {\n          map.set(i, mirror);\n        }\n      }\n    }\n    return map\n  }\n\n  /**\n   * Given a start and end denoting a single line within a string, and a set of precalculated\n   * bidi embedding levels, produce a list of segments whose ordering should be flipped, in sequence.\n   * @param {string} string - the full input string\n   * @param {GetEmbeddingLevelsResult} embeddingLevelsResult - the result object from getEmbeddingLevels\n   * @param {number} [start] - first character in a subset of the full string\n   * @param {number} [end] - last character in a subset of the full string\n   * @return {number[][]} - the list of start/end segments that should be flipped, in order.\n   */\n  function getReorderSegments(string, embeddingLevelsResult, start, end) {\n    var strLen = string.length;\n    start = Math.max(0, start == null ? 0 : +start);\n    end = Math.min(strLen - 1, end == null ? strLen - 1 : +end);\n\n    var segments = [];\n    embeddingLevelsResult.paragraphs.forEach(function (paragraph) {\n      var lineStart = Math.max(start, paragraph.start);\n      var lineEnd = Math.min(end, paragraph.end);\n      if (lineStart < lineEnd) {\n        // Local slice for mutation\n        var lineLevels = embeddingLevelsResult.levels.slice(lineStart, lineEnd + 1);\n\n        // 3.4 L1.4: Reset any sequence of whitespace characters and/or isolate formatting characters at the\n        // end of the line to the paragraph level.\n        for (var i = lineEnd; i >= lineStart && (getBidiCharType(string[i]) & TRAILING_TYPES); i--) {\n          lineLevels[i] = paragraph.level;\n        }\n\n        // L2. From the highest level found in the text to the lowest odd level on each line, including intermediate levels\n        // not actually present in the text, reverse any contiguous sequence of characters that are at that level or higher.\n        var maxLevel = paragraph.level;\n        var minOddLevel = Infinity;\n        for (var i$1 = 0; i$1 < lineLevels.length; i$1++) {\n          var level = lineLevels[i$1];\n          if (level > maxLevel) { maxLevel = level; }\n          if (level < minOddLevel) { minOddLevel = level | 1; }\n        }\n        for (var lvl = maxLevel; lvl >= minOddLevel; lvl--) {\n          for (var i$2 = 0; i$2 < lineLevels.length; i$2++) {\n            if (lineLevels[i$2] >= lvl) {\n              var segStart = i$2;\n              while (i$2 + 1 < lineLevels.length && lineLevels[i$2 + 1] >= lvl) {\n                i$2++;\n              }\n              if (i$2 > segStart) {\n                segments.push([segStart + lineStart, i$2 + lineStart]);\n              }\n            }\n          }\n        }\n      }\n    });\n    return segments\n  }\n\n  /**\n   * @param {string} string\n   * @param {GetEmbeddingLevelsResult} embedLevelsResult\n   * @param {number} [start]\n   * @param {number} [end]\n   * @return {string} the new string with bidi segments reordered\n   */\n  function getReorderedString(string, embedLevelsResult, start, end) {\n    var indices = getReorderedIndices(string, embedLevelsResult, start, end);\n    var chars = [].concat( string );\n    indices.forEach(function (charIndex, i) {\n      chars[i] = (\n        (embedLevelsResult.levels[charIndex] & 1) ? getMirroredCharacter(string[charIndex]) : null\n      ) || string[charIndex];\n    });\n    return chars.join('')\n  }\n\n  /**\n   * @param {string} string\n   * @param {GetEmbeddingLevelsResult} embedLevelsResult\n   * @param {number} [start]\n   * @param {number} [end]\n   * @return {number[]} an array with character indices in their new bidi order\n   */\n  function getReorderedIndices(string, embedLevelsResult, start, end) {\n    var segments = getReorderSegments(string, embedLevelsResult, start, end);\n    // Fill an array with indices\n    var indices = [];\n    for (var i = 0; i < string.length; i++) {\n      indices[i] = i;\n    }\n    // Reverse each segment in order\n    segments.forEach(function (ref) {\n      var start = ref[0];\n      var end = ref[1];\n\n      var slice = indices.slice(start, end + 1);\n      for (var i = slice.length; i--;) {\n        indices[end - i] = slice[i];\n      }\n    });\n    return indices\n  }\n\n  exports.closingToOpeningBracket = closingToOpeningBracket;\n  exports.getBidiCharType = getBidiCharType;\n  exports.getBidiCharTypeName = getBidiCharTypeName;\n  exports.getCanonicalBracket = getCanonicalBracket;\n  exports.getEmbeddingLevels = getEmbeddingLevels;\n  exports.getMirroredCharacter = getMirroredCharacter;\n  exports.getMirroredCharactersMap = getMirroredCharactersMap;\n  exports.getReorderSegments = getReorderSegments;\n  exports.getReorderedIndices = getReorderedIndices;\n  exports.getReorderedString = getReorderedString;\n  exports.openingToClosingBracket = openingToClosingBracket;\n\n  Object.defineProperty(exports, '__esModule', { value: true });\n\n  return exports;\n\n}({}));\nreturn bidi}\n\nexport default bidiFactory;\n","/**\n * @monogrid/gainmap-js v3.0.5\n * With ❤️, by MONOGRID <rnd@monogrid.com>\n */\n\nimport { RGBAFormat, LinearFilter, ClampToEdgeWrapping, Scene, OrthographicCamera, HalfFloatType, FloatType, Mesh, PlaneGeometry, WebGLRenderTarget, UVMapping, WebGLRenderer, DataTexture, LinearSRGBColorSpace, ShaderMaterial, Texture, IntType, ShortType, ByteType, UnsignedIntType, UnsignedByteType, MeshBasicMaterial } from 'three';\n\nconst getBufferForType = (type, width, height) => {\n    let out;\n    switch (type) {\n        case UnsignedByteType:\n            out = new Uint8ClampedArray(width * height * 4);\n            break;\n        case HalfFloatType:\n            out = new Uint16Array(width * height * 4);\n            break;\n        case UnsignedIntType:\n            out = new Uint32Array(width * height * 4);\n            break;\n        case ByteType:\n            out = new Int8Array(width * height * 4);\n            break;\n        case ShortType:\n            out = new Int16Array(width * height * 4);\n            break;\n        case IntType:\n            out = new Int32Array(width * height * 4);\n            break;\n        case FloatType:\n            out = new Float32Array(width * height * 4);\n            break;\n        default:\n            throw new Error('Unsupported data type');\n    }\n    return out;\n};\nlet _canReadPixelsResult;\n/**\n * Test if this browser implementation can correctly read pixels from the specified\n * Render target type.\n *\n * Runs only once\n *\n * @param type\n * @param renderer\n * @param camera\n * @param renderTargetOptions\n * @returns\n */\nconst canReadPixels = (type, renderer, camera, renderTargetOptions) => {\n    if (_canReadPixelsResult !== undefined)\n        return _canReadPixelsResult;\n    const testRT = new WebGLRenderTarget(1, 1, renderTargetOptions);\n    renderer.setRenderTarget(testRT);\n    const mesh = new Mesh(new PlaneGeometry(), new MeshBasicMaterial({ color: 0xffffff }));\n    renderer.render(mesh, camera);\n    renderer.setRenderTarget(null);\n    const out = getBufferForType(type, testRT.width, testRT.height);\n    renderer.readRenderTargetPixels(testRT, 0, 0, testRT.width, testRT.height, out);\n    testRT.dispose();\n    mesh.geometry.dispose();\n    mesh.material.dispose();\n    _canReadPixelsResult = out[0] !== 0;\n    return _canReadPixelsResult;\n};\n/**\n * Utility class used for rendering a texture with a material\n *\n * @category Core\n * @group Core\n */\nclass QuadRenderer {\n    /**\n     * Constructs a new QuadRenderer\n     *\n     * @param options Parameters for this QuadRenderer\n     */\n    constructor(options) {\n        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r;\n        this._rendererIsDisposable = false;\n        this._supportsReadPixels = true;\n        /**\n         * Renders the input texture using the specified material\n         */\n        this.render = () => {\n            this._renderer.setRenderTarget(this._renderTarget);\n            try {\n                this._renderer.render(this._scene, this._camera);\n            }\n            catch (e) {\n                this._renderer.setRenderTarget(null);\n                throw e;\n            }\n            this._renderer.setRenderTarget(null);\n        };\n        this._width = options.width;\n        this._height = options.height;\n        this._type = options.type;\n        this._colorSpace = options.colorSpace;\n        const rtOptions = {\n            // fixed options\n            format: RGBAFormat,\n            depthBuffer: false,\n            stencilBuffer: false,\n            // user options\n            type: this._type, // set in class property\n            colorSpace: this._colorSpace, // set in class property\n            anisotropy: ((_a = options.renderTargetOptions) === null || _a === void 0 ? void 0 : _a.anisotropy) !== undefined ? (_b = options.renderTargetOptions) === null || _b === void 0 ? void 0 : _b.anisotropy : 1,\n            generateMipmaps: ((_c = options.renderTargetOptions) === null || _c === void 0 ? void 0 : _c.generateMipmaps) !== undefined ? (_d = options.renderTargetOptions) === null || _d === void 0 ? void 0 : _d.generateMipmaps : false,\n            magFilter: ((_e = options.renderTargetOptions) === null || _e === void 0 ? void 0 : _e.magFilter) !== undefined ? (_f = options.renderTargetOptions) === null || _f === void 0 ? void 0 : _f.magFilter : LinearFilter,\n            minFilter: ((_g = options.renderTargetOptions) === null || _g === void 0 ? void 0 : _g.minFilter) !== undefined ? (_h = options.renderTargetOptions) === null || _h === void 0 ? void 0 : _h.minFilter : LinearFilter,\n            samples: ((_j = options.renderTargetOptions) === null || _j === void 0 ? void 0 : _j.samples) !== undefined ? (_k = options.renderTargetOptions) === null || _k === void 0 ? void 0 : _k.samples : undefined,\n            wrapS: ((_l = options.renderTargetOptions) === null || _l === void 0 ? void 0 : _l.wrapS) !== undefined ? (_m = options.renderTargetOptions) === null || _m === void 0 ? void 0 : _m.wrapS : ClampToEdgeWrapping,\n            wrapT: ((_o = options.renderTargetOptions) === null || _o === void 0 ? void 0 : _o.wrapT) !== undefined ? (_p = options.renderTargetOptions) === null || _p === void 0 ? void 0 : _p.wrapT : ClampToEdgeWrapping\n        };\n        this._material = options.material;\n        if (options.renderer) {\n            this._renderer = options.renderer;\n        }\n        else {\n            this._renderer = QuadRenderer.instantiateRenderer();\n            this._rendererIsDisposable = true;\n        }\n        this._scene = new Scene();\n        this._camera = new OrthographicCamera();\n        this._camera.position.set(0, 0, 10);\n        this._camera.left = -0.5;\n        this._camera.right = 0.5;\n        this._camera.top = 0.5;\n        this._camera.bottom = -0.5;\n        this._camera.updateProjectionMatrix();\n        if (!canReadPixels(this._type, this._renderer, this._camera, rtOptions)) {\n            let alternativeType;\n            switch (this._type) {\n                case HalfFloatType:\n                    alternativeType = this._renderer.extensions.has('EXT_color_buffer_float') ? FloatType : undefined;\n                    break;\n            }\n            if (alternativeType !== undefined) {\n                console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${FloatType}`);\n                this._type = alternativeType;\n            }\n            else {\n                this._supportsReadPixels = false;\n                console.warn('This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown');\n            }\n        }\n        this._quad = new Mesh(new PlaneGeometry(), this._material);\n        this._quad.geometry.computeBoundingBox();\n        this._scene.add(this._quad);\n        this._renderTarget = new WebGLRenderTarget(this.width, this.height, rtOptions);\n        this._renderTarget.texture.mapping = ((_q = options.renderTargetOptions) === null || _q === void 0 ? void 0 : _q.mapping) !== undefined ? (_r = options.renderTargetOptions) === null || _r === void 0 ? void 0 : _r.mapping : UVMapping;\n    }\n    /**\n     * Instantiates a temporary renderer\n     *\n     * @returns\n     */\n    static instantiateRenderer() {\n        const renderer = new WebGLRenderer();\n        renderer.setSize(128, 128);\n        // renderer.outputColorSpace = SRGBColorSpace\n        // renderer.toneMapping = LinearToneMapping\n        // renderer.debug.checkShaderErrors = false\n        // this._rendererIsDisposable = true\n        return renderer;\n    }\n    /**\n     * Obtains a Buffer containing the rendered texture.\n     *\n     * @throws Error if the browser cannot read pixels from this RenderTarget type.\n     * @returns a TypedArray containing RGBA values from this renderer\n     */\n    toArray() {\n        if (!this._supportsReadPixels)\n            throw new Error('Can\\'t read pixels in this browser');\n        const out = getBufferForType(this._type, this._width, this._height);\n        this._renderer.readRenderTargetPixels(this._renderTarget, 0, 0, this._width, this._height, out);\n        return out;\n    }\n    /**\n     * Performs a readPixel operation in the renderTarget\n     * and returns a DataTexture containing the read data\n     *\n     * @params options\n     * @returns\n     */\n    toDataTexture(options) {\n        const returnValue = new DataTexture(\n        // fixed values\n        this.toArray(), this.width, this.height, RGBAFormat, this._type, \n        // user values\n        (options === null || options === void 0 ? void 0 : options.mapping) || UVMapping, (options === null || options === void 0 ? void 0 : options.wrapS) || ClampToEdgeWrapping, (options === null || options === void 0 ? void 0 : options.wrapT) || ClampToEdgeWrapping, (options === null || options === void 0 ? void 0 : options.magFilter) || LinearFilter, (options === null || options === void 0 ? void 0 : options.minFilter) || LinearFilter, (options === null || options === void 0 ? void 0 : options.anisotropy) || 1, \n        // fixed value\n        LinearSRGBColorSpace);\n        // set this afterwards, we can't set it in constructor\n        returnValue.generateMipmaps = (options === null || options === void 0 ? void 0 : options.generateMipmaps) !== undefined ? options === null || options === void 0 ? void 0 : options.generateMipmaps : false;\n        return returnValue;\n    }\n    /**\n     * If using a disposable renderer, it will dispose it.\n     */\n    disposeOnDemandRenderer() {\n        this._renderer.setRenderTarget(null);\n        if (this._rendererIsDisposable) {\n            this._renderer.dispose();\n            this._renderer.forceContextLoss();\n        }\n    }\n    /**\n     * Will dispose of **all** assets used by this renderer.\n     *\n     *\n     * @param disposeRenderTarget will dispose of the renderTarget which will not be usable later\n     * set this to true if you passed the `renderTarget.texture` to a `PMREMGenerator`\n     * or are otherwise done with it.\n     *\n     * @example\n     * ```js\n     * const loader = new HDRJPGLoader(renderer)\n     * const result = await loader.loadAsync('gainmap.jpeg')\n     * const mesh = new Mesh(geometry, new MeshBasicMaterial({ map: result.renderTarget.texture }) )\n     * // DO NOT dispose the renderTarget here,\n     * // it is used directly in the material\n     * result.dispose()\n     * ```\n     *\n     * @example\n     * ```js\n     * const loader = new HDRJPGLoader(renderer)\n     * const pmremGenerator = new PMREMGenerator( renderer );\n     * const result = await loader.loadAsync('gainmap.jpeg')\n     * const envMap = pmremGenerator.fromEquirectangular(result.renderTarget.texture)\n     * const mesh = new Mesh(geometry, new MeshStandardMaterial({ envMap }) )\n     * // renderTarget can be disposed here\n     * // because it was used to generate a PMREM texture\n     * result.dispose(true)\n     * ```\n     */\n    dispose(disposeRenderTarget) {\n        this.disposeOnDemandRenderer();\n        if (disposeRenderTarget) {\n            this.renderTarget.dispose();\n        }\n        // dispose shader material texture uniforms\n        if (this.material instanceof ShaderMaterial) {\n            Object.values(this.material.uniforms).forEach(v => {\n                if (v.value instanceof Texture)\n                    v.value.dispose();\n            });\n        }\n        // dispose other material properties\n        Object.values(this.material).forEach(value => {\n            if (value instanceof Texture)\n                value.dispose();\n        });\n        this.material.dispose();\n        this._quad.geometry.dispose();\n    }\n    /**\n     * Width of the texture\n     */\n    get width() { return this._width; }\n    set width(value) {\n        this._width = value;\n        this._renderTarget.setSize(this._width, this._height);\n    }\n    /**\n     * Height of the texture\n     */\n    get height() { return this._height; }\n    set height(value) {\n        this._height = value;\n        this._renderTarget.setSize(this._width, this._height);\n    }\n    /**\n     * The renderer used\n     */\n    get renderer() { return this._renderer; }\n    /**\n     * The `WebGLRenderTarget` used.\n     */\n    get renderTarget() { return this._renderTarget; }\n    set renderTarget(value) {\n        this._renderTarget = value;\n        this._width = value.width;\n        this._height = value.height;\n        // this._type = value.texture.type\n    }\n    /**\n     * The `Material` used.\n     */\n    get material() { return this._material; }\n    /**\n     *\n     */\n    get type() { return this._type; }\n    get colorSpace() { return this._colorSpace; }\n}\n\nexport { QuadRenderer as Q };\n","/**\n * @monogrid/gainmap-js v3.0.5\n * With ❤️, by MONOGRID <rnd@monogrid.com>\n */\n\nimport { Q as QuadRenderer } from './QuadRenderer-6HrRQdJM.js';\nimport { ShaderMaterial, Vector3, NoBlending, SRGBColorSpace, LinearSRGBColorSpace, HalfFloatType, Loader, LoadingManager, Texture, UVMapping, ClampToEdgeWrapping, LinearFilter, LinearMipMapLinearFilter, RGBAFormat, UnsignedByteType, FileLoader } from 'three';\n\nconst vertexShader = /* glsl */ `\nvarying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n`;\nconst fragmentShader = /* glsl */ `\n// min half float value\n#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )\n// max half float value\n#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )\n\nuniform sampler2D sdr;\nuniform sampler2D gainMap;\nuniform vec3 gamma;\nuniform vec3 offsetHdr;\nuniform vec3 offsetSdr;\nuniform vec3 gainMapMin;\nuniform vec3 gainMapMax;\nuniform float weightFactor;\n\nvarying vec2 vUv;\n\nvoid main() {\n  vec3 rgb = texture2D( sdr, vUv ).rgb;\n  vec3 recovery = texture2D( gainMap, vUv ).rgb;\n  vec3 logRecovery = pow( recovery, gamma );\n  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;\n  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;\n  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));\n  gl_FragColor = vec4( clampedHdrColor , 1.0 );\n}\n`;\n/**\n * A Material which is able to decode the Gainmap into a full HDR Representation\n *\n * @category Materials\n * @group Materials\n */\nclass GainMapDecoderMaterial extends ShaderMaterial {\n    /**\n     *\n     * @param params\n     */\n    constructor({ gamma, offsetHdr, offsetSdr, gainMapMin, gainMapMax, maxDisplayBoost, hdrCapacityMin, hdrCapacityMax, sdr, gainMap }) {\n        super({\n            name: 'GainMapDecoderMaterial',\n            vertexShader,\n            fragmentShader,\n            uniforms: {\n                sdr: { value: sdr },\n                gainMap: { value: gainMap },\n                gamma: { value: new Vector3(1.0 / gamma[0], 1.0 / gamma[1], 1.0 / gamma[2]) },\n                offsetHdr: { value: new Vector3().fromArray(offsetHdr) },\n                offsetSdr: { value: new Vector3().fromArray(offsetSdr) },\n                gainMapMin: { value: new Vector3().fromArray(gainMapMin) },\n                gainMapMax: { value: new Vector3().fromArray(gainMapMax) },\n                weightFactor: {\n                    value: (Math.log2(maxDisplayBoost) - hdrCapacityMin) / (hdrCapacityMax - hdrCapacityMin)\n                }\n            },\n            blending: NoBlending,\n            depthTest: false,\n            depthWrite: false\n        });\n        this._maxDisplayBoost = maxDisplayBoost;\n        this._hdrCapacityMin = hdrCapacityMin;\n        this._hdrCapacityMax = hdrCapacityMax;\n        this.needsUpdate = true;\n        this.uniformsNeedUpdate = true;\n    }\n    get sdr() { return this.uniforms.sdr.value; }\n    set sdr(value) { this.uniforms.sdr.value = value; }\n    get gainMap() { return this.uniforms.gainMap.value; }\n    set gainMap(value) { this.uniforms.gainMap.value = value; }\n    /**\n     * @see {@link GainMapMetadata.offsetHdr}\n     */\n    get offsetHdr() { return this.uniforms.offsetHdr.value.toArray(); }\n    set offsetHdr(value) { this.uniforms.offsetHdr.value.fromArray(value); }\n    /**\n     * @see {@link GainMapMetadata.offsetSdr}\n     */\n    get offsetSdr() { return this.uniforms.offsetSdr.value.toArray(); }\n    set offsetSdr(value) { this.uniforms.offsetSdr.value.fromArray(value); }\n    /**\n     * @see {@link GainMapMetadata.gainMapMin}\n     */\n    get gainMapMin() { return this.uniforms.gainMapMin.value.toArray(); }\n    set gainMapMin(value) { this.uniforms.gainMapMin.value.fromArray(value); }\n    /**\n     * @see {@link GainMapMetadata.gainMapMax}\n     */\n    get gainMapMax() { return this.uniforms.gainMapMax.value.toArray(); }\n    set gainMapMax(value) { this.uniforms.gainMapMax.value.fromArray(value); }\n    /**\n     * @see {@link GainMapMetadata.gamma}\n     */\n    get gamma() {\n        const g = this.uniforms.gamma.value;\n        return [1 / g.x, 1 / g.y, 1 / g.z];\n    }\n    set gamma(value) {\n        const g = this.uniforms.gamma.value;\n        g.x = 1.0 / value[0];\n        g.y = 1.0 / value[1];\n        g.z = 1.0 / value[2];\n    }\n    /**\n     * @see {@link GainMapMetadata.hdrCapacityMin}\n     * @remarks Logarithmic space\n     */\n    get hdrCapacityMin() { return this._hdrCapacityMin; }\n    set hdrCapacityMin(value) {\n        this._hdrCapacityMin = value;\n        this.calculateWeight();\n    }\n    /**\n     * @see {@link GainMapMetadata.hdrCapacityMin}\n     * @remarks Logarithmic space\n     */\n    get hdrCapacityMax() { return this._hdrCapacityMax; }\n    set hdrCapacityMax(value) {\n        this._hdrCapacityMax = value;\n        this.calculateWeight();\n    }\n    /**\n     * @see {@link GainmapDecodingParameters.maxDisplayBoost}\n     * @remarks Non Logarithmic space\n     */\n    get maxDisplayBoost() { return this._maxDisplayBoost; }\n    set maxDisplayBoost(value) {\n        this._maxDisplayBoost = Math.max(1, Math.min(65504, value));\n        this.calculateWeight();\n    }\n    calculateWeight() {\n        const val = (Math.log2(this._maxDisplayBoost) - this._hdrCapacityMin) / (this._hdrCapacityMax - this._hdrCapacityMin);\n        this.uniforms.weightFactor.value = Math.max(0, Math.min(1, val));\n    }\n}\n\n/**\n * Decodes a gain map using a WebGLRenderTarget\n *\n * @category Decoding Functions\n * @group Decoding Functions\n * @example\n * import { decode } from '@monogrid/gainmap-js'\n * import {\n *   Mesh,\n *   MeshBasicMaterial,\n *   PerspectiveCamera,\n *   PlaneGeometry,\n *   Scene,\n *   TextureLoader,\n *   WebGLRenderer\n * } from 'three'\n *\n * const renderer = new WebGLRenderer()\n *\n * const textureLoader = new TextureLoader()\n *\n * // load SDR Representation\n * const sdr = await textureLoader.loadAsync('sdr.jpg')\n * // load Gain map recovery image\n * const gainMap = await textureLoader.loadAsync('gainmap.jpg')\n * // load metadata\n * const metadata = await (await fetch('metadata.json')).json()\n *\n * const result = await decode({\n *   sdr,\n *   gainMap,\n *   // this allows to use `result.renderTarget.texture` directly\n *   renderer,\n *   // this will restore the full HDR range\n *   maxDisplayBoost: Math.pow(2, metadata.hdrCapacityMax),\n *   ...metadata\n * })\n *\n * const scene = new Scene()\n * // `result` can be used to populate a Texture\n * const mesh = new Mesh(\n *   new PlaneGeometry(),\n *   new MeshBasicMaterial({ map: result.renderTarget.texture })\n * )\n * scene.add(mesh)\n * renderer.render(scene, new PerspectiveCamera())\n *\n * // result must be manually disposed\n * // when you are done using it\n * result.dispose()\n *\n * @param params\n * @returns\n * @throws {Error} if the WebGLRenderer fails to render the gain map\n */\nconst decode = (params) => {\n    const { sdr, gainMap, renderer } = params;\n    if (sdr.colorSpace !== SRGBColorSpace) {\n        console.warn('SDR Colorspace needs to be *SRGBColorSpace*, setting it automatically');\n        sdr.colorSpace = SRGBColorSpace;\n    }\n    sdr.needsUpdate = true;\n    if (gainMap.colorSpace !== LinearSRGBColorSpace) {\n        console.warn('Gainmap Colorspace needs to be *LinearSRGBColorSpace*, setting it automatically');\n        gainMap.colorSpace = LinearSRGBColorSpace;\n    }\n    gainMap.needsUpdate = true;\n    const material = new GainMapDecoderMaterial({\n        ...params,\n        sdr,\n        gainMap\n    });\n    const quadRenderer = new QuadRenderer({\n        // TODO: three types are generic, eslint complains here, see how we can solve\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-member-access\n        width: sdr.image.width,\n        // TODO: three types are generic, eslint complains here, see how we can solve\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-member-access\n        height: sdr.image.height,\n        type: HalfFloatType,\n        colorSpace: LinearSRGBColorSpace,\n        material,\n        renderer,\n        renderTargetOptions: params.renderTargetOptions\n    });\n    try {\n        quadRenderer.render();\n    }\n    catch (e) {\n        quadRenderer.disposeOnDemandRenderer();\n        throw e;\n    }\n    return quadRenderer;\n};\n\nclass GainMapNotFoundError extends Error {\n}\n\nclass XMPMetadataNotFoundError extends Error {\n}\n\nconst getAttribute = (description, name, defaultValue) => {\n    var _a;\n    let returnValue;\n    const parsedValue = (_a = description.attributes.getNamedItem(name)) === null || _a === void 0 ? void 0 : _a.nodeValue;\n    if (!parsedValue) {\n        const node = description.getElementsByTagName(name)[0];\n        if (node) {\n            const values = node.getElementsByTagName('rdf:li');\n            if (values.length === 3) {\n                returnValue = Array.from(values).map(v => v.innerHTML);\n            }\n            else {\n                throw new Error(`Gainmap metadata contains an array of items for ${name} but its length is not 3`);\n            }\n        }\n        else {\n            if (defaultValue)\n                return defaultValue;\n            else\n                throw new Error(`Can't find ${name} in gainmap metadata`);\n        }\n    }\n    else {\n        returnValue = parsedValue;\n    }\n    return returnValue;\n};\n/**\n *\n * @param input\n * @returns\n */\nconst extractXMP = (input) => {\n    var _a, _b;\n    let str;\n    // support node test environment\n    if (typeof TextDecoder !== 'undefined')\n        str = new TextDecoder().decode(input);\n    else\n        str = input.toString();\n    let start = str.indexOf('<x:xmpmeta');\n    const parser = new DOMParser();\n    while (start !== -1) {\n        const end = str.indexOf('x:xmpmeta>', start);\n        str.slice(start, end + 10);\n        const xmpBlock = str.slice(start, end + 10);\n        try {\n            const xmlDocument = parser.parseFromString(xmpBlock, 'text/xml');\n            const description = xmlDocument.getElementsByTagName('rdf:Description')[0];\n            const gainMapMin = getAttribute(description, 'hdrgm:GainMapMin', '0');\n            const gainMapMax = getAttribute(description, 'hdrgm:GainMapMax');\n            const gamma = getAttribute(description, 'hdrgm:Gamma', '1');\n            const offsetSDR = getAttribute(description, 'hdrgm:OffsetSDR', '0.015625');\n            const offsetHDR = getAttribute(description, 'hdrgm:OffsetHDR', '0.015625');\n            let hdrCapacityMin = (_a = description.attributes.getNamedItem('hdrgm:HDRCapacityMin')) === null || _a === void 0 ? void 0 : _a.nodeValue;\n            if (!hdrCapacityMin)\n                hdrCapacityMin = '0';\n            const hdrCapacityMax = (_b = description.attributes.getNamedItem('hdrgm:HDRCapacityMax')) === null || _b === void 0 ? void 0 : _b.nodeValue;\n            if (!hdrCapacityMax)\n                throw new Error('Incomplete gainmap metadata');\n            return {\n                gainMapMin: Array.isArray(gainMapMin) ? gainMapMin.map(v => parseFloat(v)) : [parseFloat(gainMapMin), parseFloat(gainMapMin), parseFloat(gainMapMin)],\n                gainMapMax: Array.isArray(gainMapMax) ? gainMapMax.map(v => parseFloat(v)) : [parseFloat(gainMapMax), parseFloat(gainMapMax), parseFloat(gainMapMax)],\n                gamma: Array.isArray(gamma) ? gamma.map(v => parseFloat(v)) : [parseFloat(gamma), parseFloat(gamma), parseFloat(gamma)],\n                offsetSdr: Array.isArray(offsetSDR) ? offsetSDR.map(v => parseFloat(v)) : [parseFloat(offsetSDR), parseFloat(offsetSDR), parseFloat(offsetSDR)],\n                offsetHdr: Array.isArray(offsetHDR) ? offsetHDR.map(v => parseFloat(v)) : [parseFloat(offsetHDR), parseFloat(offsetHDR), parseFloat(offsetHDR)],\n                hdrCapacityMin: parseFloat(hdrCapacityMin),\n                hdrCapacityMax: parseFloat(hdrCapacityMax)\n            };\n        }\n        catch (e) {\n        }\n        start = str.indexOf('<x:xmpmeta', end);\n    }\n};\n\n/**\n * MPF Extractor (Multi Picture Format Extractor)\n * By Henrik S Nilsson 2019\n *\n * Extracts images stored in images based on the MPF format (found here: https://www.cipa.jp/e/std/std-sec.html\n * under \"CIPA DC-007-Translation-2021 Multi-Picture Format\"\n *\n * Overly commented, and without intention of being complete or production ready.\n * Created to extract depth maps from iPhone images, and to learn about image metadata.\n * Kudos to: Phil Harvey (exiftool), Jaume Sanchez (android-lens-blur-depth-extractor)\n */\nclass MPFExtractor {\n    constructor(options) {\n        this.options = {\n            debug: options && options.debug !== undefined ? options.debug : false,\n            extractFII: options && options.extractFII !== undefined ? options.extractFII : true,\n            extractNonFII: options && options.extractNonFII !== undefined ? options.extractNonFII : true\n        };\n    }\n    extract(imageArrayBuffer) {\n        return new Promise((resolve, reject) => {\n            const debug = this.options.debug;\n            const dataView = new DataView(imageArrayBuffer.buffer);\n            // If you're executing this line on a big endian machine, it'll be reversed.\n            // bigEnd further down though, refers to the endianness of the image itself.\n            if (dataView.getUint16(0) !== 0xffd8) {\n                reject(new Error('Not a valid jpeg'));\n                return;\n            }\n            const length = dataView.byteLength;\n            let offset = 2;\n            let loops = 0;\n            let marker; // APP# marker\n            while (offset < length) {\n                if (++loops > 250) {\n                    reject(new Error(`Found no marker after ${loops} loops 😵`));\n                    return;\n                }\n                if (dataView.getUint8(offset) !== 0xff) {\n                    reject(new Error(`Not a valid marker at offset 0x${offset.toString(16)}, found: 0x${dataView.getUint8(offset).toString(16)}`));\n                    return;\n                }\n                marker = dataView.getUint8(offset + 1);\n                if (debug)\n                    console.log(`Marker: ${marker.toString(16)}`);\n                if (marker === 0xe2) {\n                    if (debug)\n                        console.log('Found APP2 marker (0xffe2)');\n                    // Works for iPhone 8 Plus, X, and XSMax. Or any photos of MPF format.\n                    // Great way to visualize image information in html is using Exiftool. E.g.:\n                    // ./exiftool.exe -htmldump -wantTrailer photo.jpg > photo.html\n                    const formatPt = offset + 4;\n                    /*\n                     *  Structure of the MP Format Identifier\n                     *\n                     *  Offset Addr.  | Code (Hex)  | Description\n                     *  +00             ff            Marker Prefix      <-- offset\n                     *  +01             e2            APP2\n                     *  +02             #n            APP2 Field Length\n                     *  +03             #n            APP2 Field Length\n                     *  +04             4d            'M'                <-- formatPt\n                     *  +05             50            'P'\n                     *  +06             46            'F'\n                     *  +07             00            NULL\n                     *                                                   <-- tiffOffset\n                     */\n                    if (dataView.getUint32(formatPt) === 0x4d504600) {\n                        // Found MPF tag, so we start dig out sub images\n                        const tiffOffset = formatPt + 4;\n                        let bigEnd; // Endianness from TIFF header\n                        // Test for TIFF validity and endianness\n                        // 0x4949 and 0x4D4D ('II' and 'MM') marks Little Endian and Big Endian\n                        if (dataView.getUint16(tiffOffset) === 0x4949) {\n                            bigEnd = false;\n                        }\n                        else if (dataView.getUint16(tiffOffset) === 0x4d4d) {\n                            bigEnd = true;\n                        }\n                        else {\n                            reject(new Error('No valid endianness marker found in TIFF header'));\n                            return;\n                        }\n                        if (dataView.getUint16(tiffOffset + 2, !bigEnd) !== 0x002a) {\n                            reject(new Error('Not valid TIFF data! (no 0x002A marker)'));\n                            return;\n                        }\n                        // 32 bit number stating the offset from the start of the 8 Byte MP Header\n                        // to MP Index IFD Least possible value is thus 8 (means 0 offset)\n                        const firstIFDOffset = dataView.getUint32(tiffOffset + 4, !bigEnd);\n                        if (firstIFDOffset < 0x00000008) {\n                            reject(new Error('Not valid TIFF data! (First offset less than 8)'));\n                            return;\n                        }\n                        // Move ahead to MP Index IFD\n                        // Assume we're at the first IFD, so firstIFDOffset points to\n                        // MP Index IFD and not MP Attributes IFD. (If we try extract from a sub image,\n                        // we fail silently here due to this assumption)\n                        // Count (2 Byte) | MP Index Fields a.k.a. MP Entries (count * 12 Byte) | Offset of Next IFD (4 Byte)\n                        const dirStart = tiffOffset + firstIFDOffset; // Start of IFD (Image File Directory)\n                        const count = dataView.getUint16(dirStart, !bigEnd); // Count of MPEntries (2 Byte)\n                        // Extract info from MPEntries (starting after Count)\n                        const entriesStart = dirStart + 2;\n                        let numberOfImages = 0;\n                        for (let i = entriesStart; i < entriesStart + 12 * count; i += 12) {\n                            // Each entry is 12 Bytes long\n                            // Check MP Index IFD tags, here we only take tag 0xb001 = Number of images\n                            if (dataView.getUint16(i, !bigEnd) === 0xb001) {\n                                // stored in Last 4 bytes of its 12 Byte entry.\n                                numberOfImages = dataView.getUint32(i + 8, !bigEnd);\n                            }\n                        }\n                        const nextIFDOffsetLen = 4; // 4 Byte offset field that appears after MP Index IFD tags\n                        const MPImageListValPt = dirStart + 2 + count * 12 + nextIFDOffsetLen;\n                        const images = [];\n                        for (let i = MPImageListValPt; i < MPImageListValPt + numberOfImages * 16; i += 16) {\n                            const image = {\n                                MPType: dataView.getUint32(i, !bigEnd),\n                                size: dataView.getUint32(i + 4, !bigEnd),\n                                // This offset is specified relative to the address of the MP Endian\n                                // field in the MP Header, unless the image is a First Individual Image,\n                                // in which case the value of the offset shall be NULL (0x00000000).\n                                dataOffset: dataView.getUint32(i + 8, !bigEnd),\n                                dependantImages: dataView.getUint32(i + 12, !bigEnd),\n                                start: -1,\n                                end: -1,\n                                isFII: false\n                            };\n                            if (!image.dataOffset) {\n                                // dataOffset is 0x00000000 for First Individual Image\n                                image.start = 0;\n                                image.isFII = true;\n                            }\n                            else {\n                                image.start = tiffOffset + image.dataOffset;\n                                image.isFII = false;\n                            }\n                            image.end = image.start + image.size;\n                            images.push(image);\n                        }\n                        if (this.options.extractNonFII && images.length) {\n                            const bufferBlob = new Blob([dataView]);\n                            const imgs = [];\n                            for (const image of images) {\n                                if (image.isFII && !this.options.extractFII) {\n                                    continue; // Skip FII\n                                }\n                                const imageBlob = bufferBlob.slice(image.start, image.end + 1, 'image/jpeg');\n                                // we don't need this\n                                // const imageUrl = URL.createObjectURL(imageBlob)\n                                // image.img = document.createElement('img')\n                                // image.img.src = imageUrl\n                                imgs.push(imageBlob);\n                            }\n                            resolve(imgs);\n                        }\n                    }\n                }\n                offset += 2 + dataView.getUint16(offset + 2);\n            }\n        });\n    }\n}\n\n/**\n * Extracts XMP Metadata and the gain map recovery image\n * from a single JPEG file.\n *\n * @category Decoding Functions\n * @group Decoding Functions\n * @param jpegFile an `Uint8Array` containing and encoded JPEG file\n * @returns an sdr `Uint8Array` compressed in JPEG, a gainMap `Uint8Array` compressed in JPEG and the XMP parsed XMP metadata\n * @throws Error if XMP Metadata is not found\n * @throws Error if Gain map image is not found\n * @example\n * import { FileLoader } from 'three'\n * import { extractGainmapFromJPEG } from '@monogrid/gainmap-js'\n *\n * const jpegFile = await new FileLoader()\n *  .setResponseType('arraybuffer')\n *  .loadAsync('image.jpg')\n *\n * const { sdr, gainMap, metadata } = extractGainmapFromJPEG(jpegFile)\n */\nconst extractGainmapFromJPEG = async (jpegFile) => {\n    const metadata = extractXMP(jpegFile);\n    if (!metadata)\n        throw new XMPMetadataNotFoundError('Gain map XMP metadata not found');\n    const mpfExtractor = new MPFExtractor({ extractFII: true, extractNonFII: true });\n    const images = await mpfExtractor.extract(jpegFile);\n    if (images.length !== 2)\n        throw new GainMapNotFoundError('Gain map recovery image not found');\n    return {\n        sdr: new Uint8Array(await images[0].arrayBuffer()),\n        gainMap: new Uint8Array(await images[1].arrayBuffer()),\n        metadata\n    };\n};\n\n/**\n * private function, async get image from blob\n *\n * @param blob\n * @returns\n */\nconst getHTMLImageFromBlob = (blob) => {\n    return new Promise((resolve, reject) => {\n        const img = document.createElement('img');\n        img.onload = () => { resolve(img); };\n        img.onerror = (e) => { reject(e); };\n        img.src = URL.createObjectURL(blob);\n    });\n};\n\nclass LoaderBase extends Loader {\n    /**\n     *\n     * @param renderer\n     * @param manager\n     */\n    constructor(renderer, manager) {\n        super(manager);\n        if (renderer)\n            this._renderer = renderer;\n        this._internalLoadingManager = new LoadingManager();\n    }\n    /**\n     * Specify the renderer to use when rendering the gain map\n     *\n     * @param renderer\n     * @returns\n     */\n    setRenderer(renderer) {\n        this._renderer = renderer;\n        return this;\n    }\n    /**\n     * Specify the renderTarget options to use when rendering the gain map\n     *\n     * @param options\n     * @returns\n     */\n    setRenderTargetOptions(options) {\n        this._renderTargetOptions = options;\n        return this;\n    }\n    /**\n     * @private\n     * @returns\n     */\n    prepareQuadRenderer() {\n        if (!this._renderer)\n            console.warn('WARNING: An existing WebGL Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.');\n        // temporary values\n        const material = new GainMapDecoderMaterial({\n            gainMapMax: [1, 1, 1],\n            gainMapMin: [0, 0, 0],\n            gamma: [1, 1, 1],\n            offsetHdr: [1, 1, 1],\n            offsetSdr: [1, 1, 1],\n            hdrCapacityMax: 1,\n            hdrCapacityMin: 0,\n            maxDisplayBoost: 1,\n            gainMap: new Texture(),\n            sdr: new Texture()\n        });\n        return new QuadRenderer({\n            width: 16,\n            height: 16,\n            type: HalfFloatType,\n            colorSpace: LinearSRGBColorSpace,\n            material,\n            renderer: this._renderer,\n            renderTargetOptions: this._renderTargetOptions\n        });\n    }\n    /**\n   * @private\n   * @param quadRenderer\n   * @param metadata\n   * @param sdrBuffer\n   * @param gainMapBuffer\n   */\n    async render(quadRenderer, metadata, sdrBuffer, gainMapBuffer) {\n        // this is optional, will render a black gain-map if not present\n        const gainMapBlob = gainMapBuffer ? new Blob([gainMapBuffer], { type: 'image/jpeg' }) : undefined;\n        const sdrBlob = new Blob([sdrBuffer], { type: 'image/jpeg' });\n        let sdrImage;\n        let gainMapImage;\n        let needsFlip = false;\n        if (typeof createImageBitmap === 'undefined') {\n            const res = await Promise.all([\n                gainMapBlob ? getHTMLImageFromBlob(gainMapBlob) : Promise.resolve(undefined),\n                getHTMLImageFromBlob(sdrBlob)\n            ]);\n            gainMapImage = res[0];\n            sdrImage = res[1];\n            needsFlip = true;\n        }\n        else {\n            const res = await Promise.all([\n                gainMapBlob ? createImageBitmap(gainMapBlob, { imageOrientation: 'flipY' }) : Promise.resolve(undefined),\n                createImageBitmap(sdrBlob, { imageOrientation: 'flipY' })\n            ]);\n            gainMapImage = res[0];\n            sdrImage = res[1];\n        }\n        const gainMap = new Texture(gainMapImage || new ImageData(2, 2), UVMapping, ClampToEdgeWrapping, ClampToEdgeWrapping, LinearFilter, LinearMipMapLinearFilter, RGBAFormat, UnsignedByteType, 1, LinearSRGBColorSpace);\n        gainMap.flipY = needsFlip;\n        gainMap.needsUpdate = true;\n        const sdr = new Texture(sdrImage, UVMapping, ClampToEdgeWrapping, ClampToEdgeWrapping, LinearFilter, LinearMipMapLinearFilter, RGBAFormat, UnsignedByteType, 1, SRGBColorSpace);\n        sdr.flipY = needsFlip;\n        sdr.needsUpdate = true;\n        quadRenderer.width = sdrImage.width;\n        quadRenderer.height = sdrImage.height;\n        quadRenderer.material.gainMap = gainMap;\n        quadRenderer.material.sdr = sdr;\n        quadRenderer.material.gainMapMin = metadata.gainMapMin;\n        quadRenderer.material.gainMapMax = metadata.gainMapMax;\n        quadRenderer.material.offsetHdr = metadata.offsetHdr;\n        quadRenderer.material.offsetSdr = metadata.offsetSdr;\n        quadRenderer.material.gamma = metadata.gamma;\n        quadRenderer.material.hdrCapacityMin = metadata.hdrCapacityMin;\n        quadRenderer.material.hdrCapacityMax = metadata.hdrCapacityMax;\n        quadRenderer.material.maxDisplayBoost = Math.pow(2, metadata.hdrCapacityMax);\n        quadRenderer.material.needsUpdate = true;\n        quadRenderer.render();\n    }\n}\n\n/**\n * A Three.js Loader for the gain map format.\n *\n * @category Loaders\n * @group Loaders\n *\n * @example\n * import { GainMapLoader } from '@monogrid/gainmap-js'\n * import {\n *   EquirectangularReflectionMapping,\n *   LinearFilter,\n *   Mesh,\n *   MeshBasicMaterial,\n *   PerspectiveCamera,\n *   PlaneGeometry,\n *   Scene,\n *   WebGLRenderer\n * } from 'three'\n *\n * const renderer = new WebGLRenderer()\n *\n * const loader = new GainMapLoader(renderer)\n *\n * const result = await loader.loadAsync(['sdr.jpeg', 'gainmap.jpeg', 'metadata.json'])\n * // `result` can be used to populate a Texture\n *\n * const scene = new Scene()\n * const mesh = new Mesh(\n *   new PlaneGeometry(),\n *   new MeshBasicMaterial({ map: result.renderTarget.texture })\n * )\n * scene.add(mesh)\n * renderer.render(scene, new PerspectiveCamera())\n *\n * // Starting from three.js r159\n * // `result.renderTarget.texture` can\n * // also be used as Equirectangular scene background\n * //\n * // it was previously needed to convert it\n * // to a DataTexture with `result.toDataTexture()`\n * scene.background = result.renderTarget.texture\n * scene.background.mapping = EquirectangularReflectionMapping\n *\n * // result must be manually disposed\n * // when you are done using it\n * result.dispose()\n *\n */\nclass GainMapLoader extends LoaderBase {\n    /**\n     * Loads a gainmap using separate data\n     * * sdr image\n     * * gain map image\n     * * metadata json\n     *\n     * useful for webp gain maps\n     *\n     * @param urls An array in the form of [sdr.jpg, gainmap.jpg, metadata.json]\n     * @param onLoad Load complete callback, will receive the result\n     * @param onProgress Progress callback, will receive a {@link ProgressEvent}\n     * @param onError Error callback\n     * @returns\n     */\n    load([sdrUrl, gainMapUrl, metadataUrl], onLoad, onProgress, onError) {\n        const quadRenderer = this.prepareQuadRenderer();\n        let sdr;\n        let gainMap;\n        let metadata;\n        const loadCheck = async () => {\n            if (sdr && gainMap && metadata) {\n                // solves #16\n                try {\n                    await this.render(quadRenderer, metadata, sdr, gainMap);\n                }\n                catch (error) {\n                    this.manager.itemError(sdrUrl);\n                    this.manager.itemError(gainMapUrl);\n                    this.manager.itemError(metadataUrl);\n                    if (typeof onError === 'function')\n                        onError(error);\n                    quadRenderer.disposeOnDemandRenderer();\n                    return;\n                }\n                if (typeof onLoad === 'function')\n                    onLoad(quadRenderer);\n                this.manager.itemEnd(sdrUrl);\n                this.manager.itemEnd(gainMapUrl);\n                this.manager.itemEnd(metadataUrl);\n                quadRenderer.disposeOnDemandRenderer();\n            }\n        };\n        let sdrLengthComputable = true;\n        let sdrTotal = 0;\n        let sdrLoaded = 0;\n        let gainMapLengthComputable = true;\n        let gainMapTotal = 0;\n        let gainMapLoaded = 0;\n        let metadataLengthComputable = true;\n        let metadataTotal = 0;\n        let metadataLoaded = 0;\n        const progressHandler = () => {\n            if (typeof onProgress === 'function') {\n                const total = sdrTotal + gainMapTotal + metadataTotal;\n                const loaded = sdrLoaded + gainMapLoaded + metadataLoaded;\n                const lengthComputable = sdrLengthComputable && gainMapLengthComputable && metadataLengthComputable;\n                onProgress(new ProgressEvent('progress', { lengthComputable, loaded, total }));\n            }\n        };\n        this.manager.itemStart(sdrUrl);\n        this.manager.itemStart(gainMapUrl);\n        this.manager.itemStart(metadataUrl);\n        const sdrLoader = new FileLoader(this._internalLoadingManager);\n        sdrLoader.setResponseType('arraybuffer');\n        sdrLoader.setRequestHeader(this.requestHeader);\n        sdrLoader.setPath(this.path);\n        sdrLoader.setWithCredentials(this.withCredentials);\n        sdrLoader.load(sdrUrl, async (buffer) => {\n            /* istanbul ignore if\n             this condition exists only because of three.js types + strict mode\n            */\n            if (typeof buffer === 'string')\n                throw new Error('Invalid sdr buffer');\n            sdr = buffer;\n            await loadCheck();\n        }, (e) => {\n            sdrLengthComputable = e.lengthComputable;\n            sdrLoaded = e.loaded;\n            sdrTotal = e.total;\n            progressHandler();\n        }, (error) => {\n            this.manager.itemError(sdrUrl);\n            if (typeof onError === 'function')\n                onError(error);\n        });\n        const gainMapLoader = new FileLoader(this._internalLoadingManager);\n        gainMapLoader.setResponseType('arraybuffer');\n        gainMapLoader.setRequestHeader(this.requestHeader);\n        gainMapLoader.setPath(this.path);\n        gainMapLoader.setWithCredentials(this.withCredentials);\n        gainMapLoader.load(gainMapUrl, async (buffer) => {\n            /* istanbul ignore if\n             this condition exists only because of three.js types + strict mode\n            */\n            if (typeof buffer === 'string')\n                throw new Error('Invalid gainmap buffer');\n            gainMap = buffer;\n            await loadCheck();\n        }, (e) => {\n            gainMapLengthComputable = e.lengthComputable;\n            gainMapLoaded = e.loaded;\n            gainMapTotal = e.total;\n            progressHandler();\n        }, (error) => {\n            this.manager.itemError(gainMapUrl);\n            if (typeof onError === 'function')\n                onError(error);\n        });\n        const metadataLoader = new FileLoader(this._internalLoadingManager);\n        // metadataLoader.setResponseType('json')\n        metadataLoader.setRequestHeader(this.requestHeader);\n        metadataLoader.setPath(this.path);\n        metadataLoader.setWithCredentials(this.withCredentials);\n        metadataLoader.load(metadataUrl, async (json) => {\n            /* istanbul ignore if\n             this condition exists only because of three.js types + strict mode\n            */\n            if (typeof json !== 'string')\n                throw new Error('Invalid metadata string');\n            // TODO: implement check on JSON file and remove this eslint disable\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n            metadata = JSON.parse(json);\n            await loadCheck();\n        }, (e) => {\n            metadataLengthComputable = e.lengthComputable;\n            metadataLoaded = e.loaded;\n            metadataTotal = e.total;\n            progressHandler();\n        }, (error) => {\n            this.manager.itemError(metadataUrl);\n            if (typeof onError === 'function')\n                onError(error);\n        });\n        return quadRenderer;\n    }\n}\n\n/**\n * A Three.js Loader for a JPEG with embedded gainmap metadata.\n *\n * @category Loaders\n * @group Loaders\n *\n * @example\n * import { HDRJPGLoader } from '@monogrid/gainmap-js'\n * import {\n *   EquirectangularReflectionMapping,\n *   LinearFilter,\n *   Mesh,\n *   MeshBasicMaterial,\n *   PerspectiveCamera,\n *   PlaneGeometry,\n *   Scene,\n *   WebGLRenderer\n * } from 'three'\n *\n * const renderer = new WebGLRenderer()\n *\n * const loader = new HDRJPGLoader(renderer)\n *\n * const result = await loader.loadAsync('gainmap.jpeg')\n * // `result` can be used to populate a Texture\n *\n * const scene = new Scene()\n * const mesh = new Mesh(\n *   new PlaneGeometry(),\n *   new MeshBasicMaterial({ map: result.renderTarget.texture })\n * )\n * scene.add(mesh)\n * renderer.render(scene, new PerspectiveCamera())\n *\n * // Starting from three.js r159\n * // `result.renderTarget.texture` can\n * // also be used as Equirectangular scene background\n * //\n * // it was previously needed to convert it\n * // to a DataTexture with `result.toDataTexture()`\n * scene.background = result.renderTarget.texture\n * scene.background.mapping = EquirectangularReflectionMapping\n *\n * // result must be manually disposed\n * // when you are done using it\n * result.dispose()\n *\n */\nclass HDRJPGLoader extends LoaderBase {\n    /**\n     * Loads a JPEG containing gain map metadata\n     * Renders a normal SDR image if gainmap data is not found\n     *\n     * @param url An array in the form of [sdr.jpg, gainmap.jpg, metadata.json]\n     * @param onLoad Load complete callback, will receive the result\n     * @param onProgress Progress callback, will receive a {@link ProgressEvent}\n     * @param onError Error callback\n     * @returns\n     */\n    load(url, onLoad, onProgress, onError) {\n        const quadRenderer = this.prepareQuadRenderer();\n        const loader = new FileLoader(this._internalLoadingManager);\n        loader.setResponseType('arraybuffer');\n        loader.setRequestHeader(this.requestHeader);\n        loader.setPath(this.path);\n        loader.setWithCredentials(this.withCredentials);\n        this.manager.itemStart(url);\n        loader.load(url, async (jpeg) => {\n            /* istanbul ignore if\n             this condition exists only because of three.js types + strict mode\n            */\n            if (typeof jpeg === 'string')\n                throw new Error('Invalid buffer, received [string], was expecting [ArrayBuffer]');\n            const jpegBuffer = new Uint8Array(jpeg);\n            let sdrJPEG;\n            let gainMapJPEG;\n            let metadata;\n            try {\n                const extractionResult = await extractGainmapFromJPEG(jpegBuffer);\n                // gain map is successfully reconstructed\n                sdrJPEG = extractionResult.sdr;\n                gainMapJPEG = extractionResult.gainMap;\n                metadata = extractionResult.metadata;\n            }\n            catch (e) {\n                // render the SDR version if this is not a gainmap\n                if (e instanceof XMPMetadataNotFoundError || e instanceof GainMapNotFoundError) {\n                    console.warn(`Failure to reconstruct an HDR image from ${url}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`);\n                    metadata = {\n                        gainMapMin: [0, 0, 0],\n                        gainMapMax: [1, 1, 1],\n                        gamma: [1, 1, 1],\n                        hdrCapacityMin: 0,\n                        hdrCapacityMax: 1,\n                        offsetHdr: [0, 0, 0],\n                        offsetSdr: [0, 0, 0]\n                    };\n                    sdrJPEG = jpegBuffer;\n                }\n                else {\n                    throw e;\n                }\n            }\n            // solves #16\n            try {\n                await this.render(quadRenderer, metadata, sdrJPEG, gainMapJPEG);\n            }\n            catch (error) {\n                this.manager.itemError(url);\n                if (typeof onError === 'function')\n                    onError(error);\n                quadRenderer.disposeOnDemandRenderer();\n                return;\n            }\n            if (typeof onLoad === 'function')\n                onLoad(quadRenderer);\n            this.manager.itemEnd(url);\n            quadRenderer.disposeOnDemandRenderer();\n        }, onProgress, (error) => {\n            this.manager.itemError(url);\n            if (typeof onError === 'function')\n                onError(error);\n        });\n        return quadRenderer;\n    }\n}\n\nexport { GainMapDecoderMaterial, GainMapLoader, HDRJPGLoader, HDRJPGLoader as JPEGRLoader, MPFExtractor, QuadRenderer, decode, extractGainmapFromJPEG, extractXMP };\n"],"names":["createStore","createState","state","listeners","setState","partial","replace","nextState","previousState","listener","getState","subscribeWithSelector","selector","equalityFn","currentSlice","listenerToAdd","nextSlice","previousSlice","api","isSSR","useIsomorphicLayoutEffect","useEffect","useLayoutEffect","create","useStore","forceUpdate","useReducer","c","stateRef","useRef","selectorRef","equalityFnRef","erroredRef","currentSliceRef","newStateSlice","hasNewStateSlice","stateBeforeSubscriptionRef","nextStateSlice","unsubscribe","sliceToReturn","useDebugValue","items","done","f","a","b","d","e","g","h","k","w","C","n","x","l","exports","p","q","r","t","u","v","y","z","A","B","D","E","F","G","H","I","K","L","M","N","O","P","Q","R","S","T","U","schedulerModule","require$$0","debounce","func","wait","immediate","timeout","args","context","timestamp","result","later","last","debounced","callNow","debounce_1","__defProp","__defProps","__getOwnPropDescs","__getOwnPropSymbols","__hasOwnProp","__propIsEnum","__defNormalProp","obj","key","value","__spreadValues","prop","__spreadProps","_a","_b","React.useLayoutEffect","React.useEffect","traverseFiber","fiber","ascending","child","match","wrapContext","error","message","FiberContext","React.createContext","FiberProvider","React.Component","React.createElement","useFiber","root","React.useContext","id","React.useId","React.useMemo","maybeFiber","fiber2","node","useContextMap","contextMap","React.useState","useContextBridge","Prev","props","_extends","SDFGenerator","pointOnQuadraticBezier","x0","y0","x1","y1","x2","y2","pointOut","t2","pointOnCubicBezier","x3","y3","forEachPathCommand","pathString","commandCallback","segmentRE","firstX","firstY","prevX","prevY","pathToLineSegments","segmentCallback","curvePoints","tempPoint","command","startX","startY","endX","endY","ctrl1X","ctrl1Y","ctrl2X","ctrl2Y","prevCurveX","prevCurveY","i","prevCurveX$1","prevCurveY$1","i$1","viewportQuadVertex","copyTexFragment","cache","glContextParams","withWebGLContext","glOrCanvas","callback","gl","wrapper","getExtension","name","ext","extensions","compileShader","src","type","shader","withProgram","vert","frag","programs","attributes","uniforms","program","values","len","uniformLoc","size","usage","instancingDivisor","data","attr","isWebGL2","withTexture","textureUnit","texture","textures","withTextureFramebuffer","framebuffer","framebufferStack","handleContextLoss","renderImageData","imageData","width","height","channels","ref","tex","texUnit","setUniform","setAttribute","resizeWebGLCanvasWithoutClearing","canvas","newWidth","newHeight","webglUtils","generate$2","sdfWidth","sdfHeight","path","viewBox","maxDistance","sdfExponent","textureData","viewBoxWidth","viewBoxHeight","segments","sdfX","sdfY","signedDist","findNearestSignedDistance","alpha","closestDistSq","closestDist","seg","distSq","absSquareDistanceToLineSegment","isPointInPoly","winding","intersects","generateIntoCanvas$2","channel","generateIntoFramebuffer$1","rgbaData","lineX0","lineY0","lineX1","lineY1","ldx","ldy","lengthSq","dx","dy","javascript","mainVertex","mainFragment","postFragment","viewportUVs","implicitContext","isTestingSupport","NULL_OBJECT","supportByCanvas","validateSupport","isSupported","generate$1","generateIntoFramebuffer","j","generateIntoCanvas$1","lineSegmentCoords","intermediateTexture","intermediateTextureUnit","instancingExtension","blendMinMaxExtension","supported","failReason","expectedResult","testResult","val","err","webgl","generate","generateIntoCanvas","bidiFactory","bidi","DATA","TYPES","TYPES_TO_NAMES","ISOLATE_INIT_TYPES","STRONG_TYPES","NEUTRAL_ISOLATE_TYPES","BN_LIKE_TYPES","TRAILING_TYPES","map","parseData","loop","lastCode","range","skip","step","getBidiCharType","char","getBidiCharTypeName","data$1","parseCharacterMap","encodedString","includeReverse","radix","reverseMap","prevPair","visit","entry","openToClose","closeToOpen","canonical","parse$1","openingToClosingBracket","closingToOpeningBracket","getCanonicalBracket","TYPE_L","TYPE_R","TYPE_EN","TYPE_ES","TYPE_ET","TYPE_AN","TYPE_CS","TYPE_B","TYPE_S","TYPE_ON","TYPE_BN","TYPE_NSM","TYPE_AL","TYPE_LRO","TYPE_RLO","TYPE_LRE","TYPE_RLE","TYPE_PDF","TYPE_LRI","TYPE_RLI","TYPE_FSI","TYPE_PDI","getEmbeddingLevels","string","baseDirection","MAX_DEPTH","charTypes","charTypeCounts","changeCharType","oldType","embedLevels","isolationPairs","paragraphs","paragraph","determineAutoEmbedLevel","FORMATTING_TYPES","nextEven","nextOdd","paraIdx","statusStack","stackTop","overflowIsolateCount","overflowEmbeddingCount","validIsolateCount","i$2","charType","level","level$1","level$2","isolInitIndex","levelRuns","currentRun","i$3","charType$1","lvl","isIsolInit","isPDI","isolatingRunSeqs","runIdx","run","seqRuns","pdiIndex","i$4","seqIndices","i$5","run$1","firstLevel","prevLevel","i$6","lastIndex","lastLevel","nextLevel","i$7","seqIdx","seqIndices$1","sosType","eosType","embedDirection","si","i$8","prevType","sj","si$1","i$9","sj$1","prevCharType","si$2","i$10","si$3","i$11","prevType$1","nextType","sj$2","sj$3","si$4","i$12","sj$4","si$5","i$13","sj$5","sj$6","si$6","prevStrongType","i$14","R_TYPES_FOR_N_STEPS","STRONG_TYPES_FOR_N_STEPS","bracketPairs","openerStack","si$7","oppositeBracket","stackIdx","stackChar","pairIdx","ref$1","openSeqIdx","closeSeqIdx","foundStrongType","useStrongType","si$8","i$15","lr","si$9","i$16","lr$1","si$10","si$11","si$12","niRunStart","niRunEnd","prevType$2","si2","nextType$1","si2$1","sj$7","i$17","level$3","type$1","j$1","start","isFSI","pdi","indexOfMatchingPDI","isolateStart","isolationLevel","mirrorMap","parse","getMirroredCharacter","getMirroredCharactersMap","embeddingLevels","end","strLen","mirror","getReorderSegments","embeddingLevelsResult","lineStart","lineEnd","lineLevels","maxLevel","minOddLevel","segStart","getReorderedString","embedLevelsResult","indices","getReorderedIndices","chars","charIndex","slice","getBufferForType","out","UnsignedByteType","HalfFloatType","UnsignedIntType","ByteType","ShortType","IntType","FloatType","_canReadPixelsResult","canReadPixels","renderer","camera","renderTargetOptions","testRT","WebGLRenderTarget","mesh","Mesh","PlaneGeometry","MeshBasicMaterial","QuadRenderer","options","_c","_d","_e","_f","_g","_h","_j","_k","_l","_m","_o","_p","_q","_r","rtOptions","RGBAFormat","LinearFilter","ClampToEdgeWrapping","Scene","OrthographicCamera","alternativeType","UVMapping","WebGLRenderer","returnValue","DataTexture","LinearSRGBColorSpace","disposeRenderTarget","ShaderMaterial","Texture","vertexShader","fragmentShader","GainMapDecoderMaterial","gamma","offsetHdr","offsetSdr","gainMapMin","gainMapMax","maxDisplayBoost","hdrCapacityMin","hdrCapacityMax","sdr","gainMap","Vector3","NoBlending","GainMapNotFoundError","XMPMetadataNotFoundError","getAttribute","description","defaultValue","parsedValue","extractXMP","input","str","parser","xmpBlock","offsetSDR","offsetHDR","MPFExtractor","imageArrayBuffer","resolve","reject","debug","dataView","length","offset","loops","marker","formatPt","tiffOffset","bigEnd","firstIFDOffset","dirStart","count","entriesStart","numberOfImages","MPImageListValPt","images","image","bufferBlob","imgs","imageBlob","extractGainmapFromJPEG","jpegFile","metadata","getHTMLImageFromBlob","blob","img","LoaderBase","Loader","manager","LoadingManager","material","quadRenderer","sdrBuffer","gainMapBuffer","gainMapBlob","sdrBlob","sdrImage","gainMapImage","needsFlip","res","LinearMipMapLinearFilter","SRGBColorSpace","GainMapLoader","sdrUrl","gainMapUrl","metadataUrl","onLoad","onProgress","onError","loadCheck","sdrLengthComputable","sdrTotal","sdrLoaded","gainMapLengthComputable","gainMapTotal","gainMapLoaded","metadataLengthComputable","metadataTotal","metadataLoaded","progressHandler","total","loaded","lengthComputable","sdrLoader","FileLoader","buffer","gainMapLoader","metadataLoader","json","HDRJPGLoader","url","loader","jpeg","jpegBuffer","sdrJPEG","gainMapJPEG","extractionResult"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6,7,8,9]}